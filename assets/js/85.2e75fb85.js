(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{838:function(t,a,s){"use strict";s.r(a);var i=s(22),m=Object(i.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1-generation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-generation"}},[t._v("#")]),t._v(" 1. Generation")]),t._v(" "),s("h3",{attrs:{id:"_1-1-network-as-generator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-network-as-generator"}},[t._v("#")]),t._v(" 1.1 Network as Generator")]),t._v(" "),s("p",[t._v("今天要讲的主题是 "),s("strong",[t._v("Generation")]),t._v(" 这件事情。")]),t._v(" "),s("p",[t._v("之前学的 Network 都是一个 function，给一个 input x 得到一个 output y。而所要学的新的主题是把 network 当做一个 generator 来使用。"),s("strong",[t._v("特别之处在于现在 network 的输入会加上一个 random 的 variable，即加一个 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"z"}})],1)],1)],1),t._v("，而这个 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"z"}})],1)],1)],1),t._v(" 是从一个 distribution 中 sample 出来的")],1),t._v("。所以现在的 network 可以看成同时从 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"x"}})],1)],1)],1),t._v(" 和 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"z"}})],1)],1)],1),t._v(" 中得到输出 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1)],1)],1),t._v("。")],1),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417180213822.png",alt:"image-20220417180213822"}}),t._v(" "),s("p",[t._v("这个 network 怎样同时看 x 和 z 呢？可以直接拼接起来，也可以相加作为 input …")]),t._v(" "),s("p",[s("strong",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"z"}})],1)],1)],1),t._v(" 特别的地方是，它不是固定的")],1),t._v("。每次 z 都从一个 distribution 中 sample 一个出来。"),s("strong",[t._v("这个 distribution 有一个限制：它必须够简单")]),t._v("，这样我们可以知道它的 formulation 并从中 sample。它可以是 uniform distribution，够简单就行了。")]),t._v(" "),s("p",[t._v("每次一个 x 进来时，都从 distribution 中 sample 一个 z，来得到 y，这样随着 sample 的 z 不同，y 也就不同。也就是说，"),s("strong",[t._v("同样的 x 作为输入，随着 sample 到的 z 不同，经过一个复杂的 network 转换后就变成了一个复杂的 distribution")]),t._v("。图示：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417201241473.png",alt:"image-20220417201241473"}}),t._v(" "),s("p",[s("strong",[t._v("这种可以输出一个 distribution 的 network，我们就叫它")]),t._v(" "),s("mark",[t._v("generator")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_1-2-why-distribution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-why-distribution"}},[t._v("#")]),t._v(" 1.2 Why distribution?")]),t._v(" "),s("p",[t._v("为什么我们需要 generator 的输出是一个 distribution？比如在 video prediction 中，给你的 network 过去的游戏画面，然后它的输出是新的游戏画面。这时候，在训练资料里面，同样的输入再面对转角时，有时候小精灵往左转，有时候往右转，这两种可能性同时存在于训练资料里面，Network 要两面讨好，处理这个问题的一种可能性就是让机器的输出是有几率的：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417202232845.png",alt:"image-20220417202232845"}}),t._v(" "),s("p",[s("strong",[t._v("当我们的任务需要一点创造力的时候")]),t._v("，更具体说就是我们想要找一个 function，"),s("strong",[t._v("同样的输入有多种输出，而且这些不同的输出都是对的，就需要 generator 的 model")]),t._v("。")]),t._v(" "),s("p",[t._v("比如画图这件事就需要一点创造力：")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417202657185.png",alt:"image-20220417202657185"}}),t._v(" "),s("p",[t._v("还比如对话这种事：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417202814659.png",alt:"image-20220417202814659"}}),t._v(" "),s("ul",[s("li",[t._v("我们问机器说辉夜是谁，其实每个人可能都有不同的答案，这时候就需要 generative 的 model。")])]),t._v(" "),s("h2",{attrs:{id:"_2-gan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-gan"}},[t._v("#")]),t._v(" 2. GAN")]),t._v(" "),s("p",[t._v("generative 的 model 中，有一个非常知名，它就是 "),s("mark",[t._v("Generative Adversarial Network")]),t._v("（"),s("strong",[t._v("GAN")]),t._v("），我们主要就是介绍它，发音就是 gàn。")]),t._v(" "),s("p",[t._v("它有很多很多的变形，在 GitHub 上可以找到一个 GAN 的 zoo：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417203337948.png",alt:"image-20220417203337948"}}),t._v(" "),s("h3",{attrs:{id:"_2-1-example-anime-face-generation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-example-anime-face-generation"}},[t._v("#")]),t._v(" 2.1 Example：Anime Face Generation")]),t._v(" "),s("p",[t._v("我们举一个让机器生成二次元人物的脸的例子，它是一个 "),s("strong",[t._v("unconditional generation")]),t._v("，就是我们这边先把 x 拿掉：")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417203540867.png",alt:"image-20220417203540867"}}),t._v(" "),s("p",[t._v("之后讲到 conditional generation 的时候会再把 x 加回来。拿掉 x 后，generator 的输入就是 z 了。"),s("u",[t._v("之后我们都假设 z 是一个从 normal distribution 中 sample 出来的一个 vector")]),t._v("，这个 vector 通常是一个 low-dimensional 的 vector，它的维度是你自己决定的。")]),t._v(" "),s("p",[t._v("一张图片就是一个非常高维的向量，所以 generator 实际上做的事情就是產生一个非常高维的向量，比如 64 × 64 × 3 的 tensor 表示 image。")]),t._v(" "),s("p",[t._v("当从 distribution 中 sample 出不同的 z，输出的 y 都不一样。那我们希望不管这边 sample 到怎样的 z，输出都是动画人物的脸：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417204041070.png",alt:"image-20220417204041070"}}),t._v(" "),s("blockquote",[s("p",[t._v("为什么是 normal distribution 呢？也可以是别的，但经验是"),s("strong",[t._v("不同的 distribution 之间的差异，可能并没有真的非常大")]),t._v("。只要是一个够简单的 distribution 就可以了，network 会对应到一个复杂的 distribution 中。")])]),t._v(" "),s("h3",{attrs:{id:"_2-2-discriminator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-discriminator"}},[t._v("#")]),t._v(" 2.2 Discriminator")]),t._v(" "),s("p",[s("strong",[t._v("在 GAN 中，一个特别的地方是，除了 generator 外，我们还要训练另外一个东西，叫做")]),t._v(" "),s("mark",[t._v("discriminator")]),t._v("。它的作用是，它会拿一张图片作为 input，其 output 是一个数值，这个 discriminator 本身也是一个 neural network，是一个 function：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417210543264.png",alt:"image-20220417210543264"}}),t._v(" "),s("p",[t._v("它输出的 scalar 越大，表示输入的 image 越像真的二次元人物的图像。举例来说：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417210639865.png",alt:"image-20220417210639865"}}),t._v(" "),s("p",[s("strong",[t._v("至于 generator 和 discriminator 的架构长什么样子，你完全可以自己设计，只要有你要的输入输出就可以了")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-3-basic-idea-of-gan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-basic-idea-of-gan"}},[t._v("#")]),t._v(" 2.3 Basic idea of GAN")]),t._v(" "),s("p",[t._v("为什么要多一个 disciminator，这要讲一个故事：")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417210935981.png",alt:"image-20220417210935981"}}),t._v(" "),s("ul",[s("li",[t._v("物竞天择之下，蝴蝶越来越像树叶，以免别天敌吃掉。而比比鸟为了吃掉蝴蝶，也逐渐进化越来越不容易被骗过。最终完成了从蝴蝶到枯叶蝶的进化。")]),t._v(" "),s("li",[t._v("在这个过程中，蝴蝶就是 generator，比比鸟就是 discriminator。")])]),t._v(" "),s("p",[t._v("现在回到 generator 要画出二次元的人物，disciriminator 就是要去分辨出 generator 的输出和真正的图片：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417211343582.png",alt:"image-20220417211343582"}}),t._v(" "),s("ul",[s("li",[t._v("一开始 generator 会乱画，这时 discriminator 很容易地根据是否有两个黑眼睛就能分别出真假；之后 generator 调整参数进化了，它为了骗过 discriminator 就画出了眼睛，而后 discriminator 也会进化，开始从嘴巴进行分辨 ……")])]),t._v(" "),s("p",[t._v("generator 与 discriminator 之间有一个对抗的关系，就用了 "),s("mark",[t._v("adversarial")]),t._v(" 这个字眼，这只是一个拟人化的说法而已。")]),t._v(" "),s("h3",{attrs:{id:"_2-4-algorithm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-algorithm"}},[t._v("#")]),t._v(" 2.4 Algorithm")]),t._v(" "),s("p",[t._v("下面正式讲一下这个演算法长什么样子。network 训练之前，要"),s("strong",[t._v("先初始化 generator 和 discriminator 的参数")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"step-1-fix-generator-g-and-update-discriminator-d"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-1-fix-generator-g-and-update-discriminator-d"}},[t._v("#")]),t._v(" step 1：Fix generator G, and update discriminator D")]),t._v(" "),s("p",[t._v("初始化完参数以后，接下来训练的第一步是定住你的 generator，只 train 你的 discriminator。")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417212119550.png",alt:"image-20220417212119550"}}),t._v(" "),s("ul",[s("li",[t._v("discriminator 训练的目标是要分辨真正的二次元人物和 generator 產生出来的二次元人物")])]),t._v(" "),s("p",[t._v("这种分辨可能是把真正的人物标 1，generator 产生的人物标 2，这就成了一个分类或者 regression 的问题了。具体怎么做，看你喽。")]),t._v(" "),s("h4",{attrs:{id:"step-2-fix-discriminator-d-and-update-generator-g"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-2-fix-discriminator-d-and-update-generator-g"}},[t._v("#")]),t._v(" step 2：Fix discriminator D, and update generator G")]),t._v(" "),s("p",[t._v("我们训练完 discriminator 以后，接下来定住 discriminator 改成训练 generator。如何训练呢？"),s("strong",[t._v("拟人化的讲法就是让 generator 想办法去骗过 discriminator")]),t._v("。")]),t._v(" "),s("p",[t._v("实际上的操作方法是：从 distribution 中 sample 出一个 vector 输给 generator，产生一个图片，把它丢给 discriminator，discriminator 会给这个图片一个分数，而 generator 的训练目标就是让这个 discriminator 输出高分，这就意味着 generator 骗过了 discriminator。图示如下：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417214115031.png",alt:"image-20220417214115031"}}),t._v(" "),s("p",[t._v("更具体一点，我们可以将 generator 和 discriminator 两个 network 直接接起来当成一个大的 network 来看待，其中某一层的输出代表一张图片：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417215040532.png",alt:"image-20220417215040532"}}),t._v(" "),s("p",[t._v("至于怎么调 network 的参数，这根训练一般的 network 没什么不同。所以现在讲了两个步骤：")]),t._v(" "),s("ul",[s("li",[t._v("step 1：Fix generator G, and update discriminator D")]),t._v(" "),s("li",[t._v("step 2：Fix discriminator D, and update generator G")])]),t._v(" "),s("p",[t._v("接下来就是反复地训练两个 network：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417220759991.png",alt:"image-20220417220759991"}}),t._v(" "),s("h3",{attrs:{id:"_2-5-示例-anime-face-generation-的结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-示例-anime-face-generation-的结果"}},[t._v("#")]),t._v(" 2.5 示例 Anime Face Generation 的结果")]),t._v(" "),s("p",[t._v("生成二次元人脸的任务，到底可以做到什么样的程度呢？")]),t._v(" "),s("p",[t._v("2000 次的结果如下：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221310946.png",alt:"image-20220417221310946"}}),t._v(" "),s("p",[t._v("五万次的结果如下：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221240299.png",alt:"image-20220417221240299"}}),t._v(" "),s("p",[t._v("使用 StyleGAN 可以做到下面这个样子："),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221359408.png",alt:"image-20220417221359408"}})]),t._v(" "),s("p",[t._v("除此之外还有一个 "),s("strong",[t._v("progressive GAN")]),t._v(" 可以产生真是人脸：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221441996.png",alt:"image-20220417221441996"}}),t._v(" "),s("p",[t._v("在两个向量之间做内插 interpolation，可以看到这两个向量对应的图片中间的逐渐变化过程：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221545459.png",alt:"image-20220417221545459"}}),t._v(" "),s("p",[t._v("用 BigGAN 甚至可以做到产生下面的图片：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221632458.png",alt:"image-20220417221632458"}}),t._v(" "),s("p",[t._v("还产生了奇怪的网球狗："),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220417221714205.png",alt:"image-20220417221714205"}})]),t._v(" "),s("h2",{attrs:{id:"_3-theory-behind-gan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-theory-behind-gan"}},[t._v("#")]),t._v(" 3. Theory behind GAN")]),t._v(" "),s("p",[t._v("接下来我们告诉你，为什么 Generator 和 Discriminator 的互动可以让 Generator 产生像是真正人脸的图片。")]),t._v(" "),s("h3",{attrs:{id:"_3-1-our-objective"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-our-objective"}},[t._v("#")]),t._v(" 3.1 Our objective")]),t._v(" "),s("p",[t._v("先搞清楚我们的"),s("strong",[t._v("目标是什么")]),t._v("。在训练 network 时，我们先定一个 loss function，然后用 gradient descent 去调参，最终 minimize 那个 loss 就结束了。我们在 Generation 问题中，要 minimize 的东西是这个样子：")]),t._v(" "),s("ul",[s("li",[t._v("给它一堆从 distribution 中 sample 出来的 vector")]),t._v(" "),s("li",[t._v("丢进 Generator 后，会产生一个比较复杂的 distribution，称之为 "),s("mark",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1)],1)]),t._v(" "),s("li",[t._v("我们还有另一堆 data，这个真正的 data 也形成了另外一个 distribution，称之为 "),s("mark",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1)],1)])]),t._v(" "),s("p",[s("strong",[t._v("我们期待的是 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 与 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 越接近越好")],1),t._v("。以一维的状况为例：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220418210550749.png",alt:"image-20220418210550749"}}),t._v(" "),s("ul",[s("li",[t._v("Generator 的 input、output 和 真正的 data 都是一维 vector")])]),t._v(" "),s("p",[t._v("我们期待的是绿色和蓝色的分布越接近越好，写成式子就是：")]),t._v(" "),s("p"),s("p",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML",display:"true"}},[s("mjx-math",{staticClass:" MJX-TEX",attrs:{display:"true"}},[s("mjx-msup",[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"G"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"0.413em"}},[s("mjx-mo",{staticClass:"mjx-n",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"2217"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"="}})],1),s("mjx-mi",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"a"}}),s("mjx-c",{attrs:{c:"r"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-munder",{attrs:{space:"2"}},[s("mjx-row",[s("mjx-base",[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"m"}}),s("mjx-c",{attrs:{c:"i"}}),s("mjx-c",{attrs:{c:"n"}})],1)],1)],1),s("mjx-row",[s("mjx-under",{staticStyle:{"padding-top":"0.167em","padding-left":"0.556em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1),s("mjx-mstyle",{staticStyle:{color:"blue"},attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"i"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"v"}})],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1)],1),s("p"),t._v(" "),s("ul",[s("li",[t._v("Div 是 "),s("mark",[t._v("Divergence")]),t._v("（"),s("strong",[t._v("散度")]),t._v("），可以理解成两个 distribution 之间的某种距离。散度越小，就代表两个 distribution 越像。")])]),t._v(" "),s("p",[t._v("这样其实我们就是找一个 Generator 里面的参数，使得这个 Generator 产生出来的 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 跟 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 之间的 Divergence 越小越好。")],1),t._v(" "),s("p",[t._v("但我们遇到一个问题："),s("strong",[t._v("用在这种 continues 的 distribution 上面的 Divergence 是很难算的")]),t._v("。我们算不出这个 Divergence，那有如何去找 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msup",[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"G"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"0.363em"}},[s("mjx-mo",{staticClass:"mjx-n",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"2217"}})],1)],1)],1)],1)],1),t._v(" 呢？这就是我们在 train 这种 generator 时会遇到的问题。而 "),s("strong",[t._v("GAN 有一个神奇的做法，它可以突破“我们不知道怎么计算 Divergence”的限制")]),t._v("。")],1),t._v(" "),s("h3",{attrs:{id:"_3-2-sampling-is-good-enough"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-sampling-is-good-enough"}},[t._v("#")]),t._v(" 3.2 Sampling is good enough …")]),t._v(" "),s("p",[t._v("现在我们的问题是不知道怎样计算 Divergence，而 "),s("strong",[t._v("GAN 告诉我们，你不需要知道 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 和 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 实际上的 formulation 长什么样子，而只要能从他们这两个 distribution 中 sample 东西出来，就有办法计算 Divergence")],1),t._v("。")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420202334209.png",alt:"image-20220420202334209"}}),t._v(" "),s("ul",[s("li",[t._v("从图库中随机 sample 出来一些图片，就得到 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" sample 的结果")],1),t._v(" "),s("li",[t._v("从 simple distribution 中 sample 出一些 vector，丢进 Generator 中，产生出来的图片就是从 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 中 sample 的结果")],1)]),t._v(" "),s("h3",{attrs:{id:"_3-3-discriminator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-discriminator"}},[t._v("#")]),t._v(" 3.3 Discriminator")]),t._v(" "),s("p",[t._v("靠 "),s("strong",[t._v("Discriminator")]),t._v(" 的力量，GAN 可以在只做 sample 的前提下去估测出 Divergence。")]),t._v(" "),s("p",[t._v("现在有了下面两种数据去训练 discriminator：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420203735077.png",alt:"image-20220420203735077"}}),t._v(" "),s("p",[t._v("它的"),s("strong",[t._v("训练目标")]),t._v("是：看到 real data 就给高分，看到 generative data 就给低分。这个过程可以当成一个 optimazation 的问题，写成如下的式子：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420203952082.png",alt:"image-20220420203952082"}}),t._v(" "),s("ul",[s("li",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"E"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"223C"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"["}})],1),s("mjx-mi",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"l"}}),s("mjx-c",{attrs:{c:"o"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"2"}},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"]"}})],1)],1)],1),t._v(" 表示一堆 y 是从 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 中 sample 出来，即他们是真正的 image，把他们丢进 D 里得到一个分数，再取 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"l"}}),s("mjx-c",{attrs:{c:"o"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"2"}},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1)],1),t._v(" "),s("li",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"E"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"223C"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"["}})],1),s("mjx-mi",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"l"}}),s("mjx-c",{attrs:{c:"o"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-mrow",[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mn",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"1"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"2212"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"]"}})],1)],1)],1),t._v(" 表示另一部分 y 是从 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 经 Generator 产生出来的，这些图片丢进 Discriminator 里得到一个分数，再取 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"l"}}),s("mjx-c",{attrs:{c:"o"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-mrow",[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mn",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"1"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"2212"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"y"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1)],1)]),t._v(" "),s("p",[t._v("在这里，Discriminator 想要 maximize 的 function 称为 "),s("mark",[t._v("Objective Function")]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("我们要 maximize 的 function 叫 "),s("strong",[t._v("Objective Function")]),t._v("，要 minimize 的 function 叫 "),s("strong",[t._v("Loss Function")]),t._v("。")])]),t._v(" "),s("p",[t._v("我们希望这个 objective func "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"V"}})],1)],1)],1),t._v(" 越大越好。就是希望：")],1),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420210420848.png",alt:"image-20220420210420848"}}),t._v(" "),s("p",[t._v("这个 objective func 不一定非要写成这样，当初写成这个样子是为了与 binary classification 扯上关系，因为这个 func 就是 Cross Entropy 乘以一个负号，所以这相当于我们想 minimize Cross Entropy，也就等于在训练一个 classifier：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420210727037.png",alt:"image-20220420210727037"}}),t._v(" "),s("p",[t._v("最神奇的是："),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420210834571.png",alt:"image-20220420210834571"}}),t._v("，也就是这个 objective func 的最大值是跟 Divergence 有关的，"),s("strong",[t._v("因此我们不知道怎么算 Divergence 没关係，train 我们的 Discriminator，train 完之后，看看它的 Objective Function 可以到多大，那个值就跟 Divergence 有关")]),t._v("。")]),t._v(" "),s("p",[t._v("我们不再证明 objective func 为什么跟 Divergence 有关，但直观上看一下：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420211243465.png",alt:"image-20220420211243465"}}),t._v(" "),s("ul",[s("li",[t._v("假设 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 和 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 之间的 Divergence 很小，也就是两者很像，这时很难分开他们，这个问题也就很难，在解这个 Optimization Problem 时，就没有办法让这个 objective func 的值很大")],1),t._v(" "),s("li",[t._v("如果两者很不像，那很轻易将其分开，这个 Objective Function 就可以冲得很大。")])]),t._v(" "),s("p",[t._v("所以既然这个 objective func 的最大值跟 Divergence 有关，即：")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420212426438.png",alt:"image-20220420212426438"}})]),t._v(" "),s("p",[t._v("那我们可以直接把我们不会算的 Div 换成红框框的部分，于是就有了")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420212534770.png",alt:"image-20220420212534770"}})]),t._v(" "),s("ul",[s("li",[t._v("我们要找一个 Generator "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msup",[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"G"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"0.363em"}},[s("mjx-mo",{staticClass:"mjx-n",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"2217"}})],1)],1)],1)],1)],1),t._v("，去 minimize 红色框框里面的")],1),t._v(" "),s("li",[t._v("而红色框框中的这件事，又是另外一个 Optimization Problem，它是在给定 Generator 的情况下，去找一个 Discriminator，这个 Discriminator 可以让 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"V"}})],1)],1)],1),t._v(" 这个 objective func 越大越好")],1)]),t._v(" "),s("p",[t._v("之前我们讲的 Generator 跟 Discriminator 互动、互相欺骗的过程，其实就是想解这个问题：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420213147540.png",alt:"image-20220420213147540"}}),t._v(" "),s("p",[t._v("那你可能问，为什么用 JS Divergence 而不是别的 Divergence 呢？完全可以，只要改了 objective func 就可以量各式各样的 Divergence：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220420213345950.png",alt:"image-20220420213345950"}}),t._v(" "),s("p",[t._v("但实际上，GAN 还是很不好 train 的，所以俗话说，No Pain, No Gan。")]),t._v(" "),s("h2",{attrs:{id:"_4-tips-for-gan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-tips-for-gan"}},[t._v("#")]),t._v(" 4. Tips for GAN")]),t._v(" "),s("p",[t._v("接下来我们就要讲一些 GAN 训练的小技巧。我们只挑最知名的来讲，即 "),s("mark",[t._v("WGAN")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_4-1-js-divergence-is-not-suitable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-js-divergence-is-not-suitable"}},[t._v("#")]),t._v(" 4.1 JS divergence is not suitable")]),t._v(" "),s("p",[t._v("我们讲讲 JS Divergence 有什么问题。")]),t._v(" "),s("p",[s("strong",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 和 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 有一个关键特性：他们的重叠部分往往非常少")],1),t._v("。这有两个理由：")]),t._v(" "),s("ol",[s("li",[t._v("第一个理由是来自于 data 本身的特性："),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421200108228.png",alt:"image-20220421200108228"}})]),t._v(" "),s("li",[t._v("其实我们从来不知道 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 和 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 长什么样子，我们对他们的分布的理解其实来源于 sample："),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421200227138.png",alt:"image-20220421200227138"}})],1)]),t._v(" "),s("p",[t._v("而"),s("strong",[t._v("两个没有重叠的分布，JS Divergence 算出来永远都是 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"l"}}),s("mjx-c",{attrs:{c:"o"}}),s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"2061"}})],1),s("mjx-mn",{staticClass:"mjx-n",attrs:{space:"2"}},[s("mjx-c",{attrs:{c:"2"}})],1)],1)],1)],1),t._v("。这导致了如下情况：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421200434196.png",alt:"image-20220421200434196"}}),t._v(" "),s("ul",[s("li",[t._v("左边两个 equally bad")])]),t._v(" "),s("p",[t._v("而且在实际中用 JS Divergence 时，会发现 train 完后 classifier 的正确率几乎都是 100%，因为 sample 的图片根本就没几张。这样训练完的 loss 根本就没有什么意义。")]),t._v(" "),s("p",[t._v("所以 WGAN 出现之前，train GAN 就像巫术。既然是 JS Divergence 的问题，那我们换一个衡量两个 Distribution 的相似程度的方式，即换一个 Divergence 就可以了，于是出现了使用 "),s("strong",[t._v("Wasserstein Distance")]),t._v(" 的想法。")]),t._v(" "),s("h3",{attrs:{id:"_4-2-wasserstein-distance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-wasserstein-distance"}},[t._v("#")]),t._v(" 4.2 Wasserstein Distance")]),t._v(" "),s("p",[s("mark",[t._v("Wasserstein Distance")]),t._v(" 的想法是这样：假设有两个 distribution，一个叫 P，另一个叫 Q：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421201909841.png",alt:"image-20220421201909841"}}),t._v(" "),s("ul",[s("li",[t._v("推土机把 P 这边的土，挪到 Q 所移动的平均距离就是 Wasserstein Distance。")])]),t._v(" "),s("p",[t._v("比如下面例子里：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421203938741.png",alt:"image-20220421203938741"}}),t._v(" "),s("p",[t._v("因为这里用到推土机（Earth Mover），所以也称 Wasserstein Distance 为 "),s("mark",[t._v("Earth Mover Distance")]),t._v("。")]),t._v(" "),s("p",[t._v("但是如果是更复杂的 Distribution，那算 Wasserstein Distance 就困难了：")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421204144689.png",alt:"image-20220421204144689"}})]),t._v(" "),s("p",[t._v("计算这个 distance 居然也要解一个 optimization 的问题。先假设我们能够计算 Wasserstein Distance，那会给我们带来怎样的好处呢？：")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"75%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421204413110.png",alt:"image-20220421204413110"}})]),t._v(" "),s("ul",[s("li",[t._v("由左向右的时候，Wasserstein Distance 是越来越小的。")])]),t._v(" "),s("p",[t._v("所以我们换一种计算 Divergence 的方式，所以我们就可以解决 JS Divergence 带来的问题。就像人类的进化，是一步一步慢慢进化出来的，JS Divergence 相当于从这一步直接跳到另一步，而 W Distance 相当于每次稍微把 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 往 "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v(" 挪近一点，这样才有办法 train 你的 Generator。")],1),t._v(" "),s("p",[t._v("当你用 Wasserstein Distance 来取代 JS Divergence 的时候，这个 GAN 就叫做 "),s("mark",[t._v("WGAN")]),t._v("。"),s("strong",[t._v("那 Wasserstein Distance 怎么算呢")]),t._v("？直接上结果，解下面这个 optimization problem 得到的值就是 Wasserstein Distance：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220421221511855.png",alt:"image-20220421221511855"}}),t._v(" "),s("ul",[s("li",[t._v("y 如果 from "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"d"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1)],1)],1)],1)],1)],1),t._v("，那我们计算它 D(y) 的期望值；如果 from "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"P"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"G"}})],1)],1)],1)],1)],1),t._v(" 就计算期望后再加一符号")],1),t._v(" "),s("li",[s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:" MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"D"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"2208"}})],1),s("mjx-mn",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"1"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"2212"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"L"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"i"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"p"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"s"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"c"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"h"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"i"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"z"}})],1)],1)],1),t._v(" 限制 D 必须是一个足够平滑的 function。")],1)]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("为什么要足够平滑？")]),t._v(" "),s("p",[t._v("如果没有这个限制，在 real data 和 generated data 没有重叠时，Discriminator 会尝试给 real data 无限大的正值，给 generated data 一个无限大的负值：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220422200409985.png",alt:"image-20220422200409985"}})]),t._v(" "),s("p",[t._v("如何做到这个限制呢？最早使用 WGAN 的 paper 使用了一个比较粗糙的方法：train network 时要求训练的参数必须在 C 和 -C 之间，gradient descent update 后超过 C 就设为 C，小于 -C 就直接设为 -C。")]),t._v(" "),s("p",[t._v("但这个方法还不够好，有另一个想法叫 Gradient Penalty，在 "),s("a",{attrs:{href:"https://arxiv.org/abs/1704.00028",target:"_blank",rel:"noopener noreferrer"}},[t._v("Improved WGAN"),s("OutboundLink")],1),t._v(" 中提出。")]),t._v(" "),s("p",[t._v("现在有一种方法叫 "),s("strong",[t._v("Spectral Normalization")]),t._v("，使得真的让 D 符合 1-Lipschitz Function 的限制，在 "),s("a",{attrs:{href:"%5Bhttps://arxiv.org/abs/1802.05957"}},[t._v("Spectral Normalization for Generative Adversarial Networks")]),t._v(" 中提出。如果你要 train 真的非常好的 GAN，可能就会需要 Spectral Normalizaion，这就是 "),s("mark",[t._v("SNGAN")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_4-3-gan-is-still-challenging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-gan-is-still-challenging"}},[t._v("#")]),t._v(" 4.3 GAN is still challenging ...")]),t._v(" "),s("p",[t._v("虽然说已经有 WGAN，GAN 仍然是很难 train 的。它有一个本质上困难的地方，Generator 跟 Discriminator 是互相砥砺才能互相成长，只要其中一者发生什么问题而停止训练，那另一者也会跟着停下训练。如果 Generator 一下子没有 train 好而失去了进步的目标，那 Generator 就没有办法再进步了，那么接着 Discriminator 就没有办法再跟着进步了。")]),t._v(" "),s("p",[t._v("大家都知道我们没有办法保证在 train network 时 loss 就一定会下降，你往往需要调一下 hyperparameter 才有可能把它 train 起来。但今天这个 Generator 和 Discriminator 的互动的过程是自动的，因为我们不会在中间每一次 train discriminator 的时候都换一下 hyperparameter，所以只能祈祷每次 train discriminator 的时候，它的 loss 都是有下降的，那"),s("strong",[t._v("如果有一次 loss 没有下降，那整个 training 就很有可能就会惨掉")]),t._v("，整个 discriminator 和 generator 彼此砥砺的过程就可能会停下来。所以"),s("u",[t._v("今天 generator 和 discriminator 在 train 的时候必须要棋逢对手，任何一个人放弃了这一场比赛，另外一个人也就玩不下去了")]),t._v("。")]),t._v(" "),s("p",[t._v("所以 GAN 本质上它的 training 仍然不是一件容易的事情，当然它是一个非常重要的技术。跟 Train GAN 的诀窍有关的文献列在这里供参考：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/soumith/ganhacks",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tips from Soumith"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://arxiv.org/abs/1511.06434",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tips in DCGAN: Guideline for network architecture design for image generation"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://arxiv.org/abs/1606.03498",target:"_blank",rel:"noopener noreferrer"}},[t._v("Improved techniques for training GANs"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://arxiv.org/abs/1809.11096",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tips from BigGAN"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"_4-4-gan-for-sequence-generation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-gan-for-sequence-generation"}},[t._v("#")]),t._v(" 4.4 GAN for Sequence Generation")]),t._v(" "),s("p",[t._v("Train GAN 最难的其实是要拿 GAN 来生成文字。如果你要用 GAN 来生成一段文字，那你可能会有一个 seq2seq 的 model，你有一个可以产生文字的 Decoder，现在在 GAN 里面，它就扮演了 generator 的角色，负责产生我们要它产生的东西，比如说一段文字。")])],1)}),[],!1,null,null,null);a.default=m.exports}}]);