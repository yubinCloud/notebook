(window.webpackJsonp=window.webpackJsonp||[]).push([[258],{1013:function(t,a,s){"use strict";s.r(a);var e=s(22),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("有时候我们用 requests 得到的页面和我们在浏览器中所看到的不一样，这是因为 requests 获取的都是原始的 HTML 文档，而浏览器中的页面是 JavaScript 处理数据之后生成的结果，这些数据有多种来源，可能是通过 Ajax 加载的，也可能是包含在 HTML 文档中的，还可能是经过 JS 和特定算法生成的。")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#_1-ajax"}},[t._v("1. Ajax")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-1-什么是-ajax"}},[t._v("1.1 什么是 Ajax")])]),s("li",[s("a",{attrs:{href:"#_1-2-ajax-分析方法"}},[t._v("1.2 Ajax 分析方法")])])])]),s("li",[s("a",{attrs:{href:"#_2-selenium-的使用"}},[t._v("2. Selenium 的使用")])]),s("li",[s("a",{attrs:{href:"#_3-pyppeteer"}},[t._v("3. Pyppeteer")])]),s("li",[s("a",{attrs:{href:"#_4-playwright-的使用"}},[t._v("4. Playwright 的使用")]),s("ul",[s("li",[s("a",{attrs:{href:"#_4-1-特点"}},[t._v("4.1 特点")])]),s("li",[s("a",{attrs:{href:"#_4-2-安装"}},[t._v("4.2 安装")])]),s("li",[s("a",{attrs:{href:"#_4-3-基本使用"}},[t._v("4.3 基本使用")])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"_1-ajax"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ajax"}},[t._v("#")]),t._v(" 1. Ajax")]),t._v(" "),s("p",[t._v("当页面数据是通过 Ajax 请求获得的时候，需要分析请求接口，并对请求接口进行抓取来获得数据。")]),t._v(" "),s("h3",{attrs:{id:"_1-1-什么是-ajax"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是-ajax"}},[t._v("#")]),t._v(" 1.1 什么是 Ajax")]),t._v(" "),s("p",[t._v("Ajax 允许通过与场景后面的 Web 服务器交换数据来异步更新网页。这意味着可以更新网页的部分，而不需要重新加载整个页面。")]),t._v(" "),s("p",[t._v("以微博 "),s("code",[t._v("https://m.weibo.cn/u/2830678474")]),t._v(" 为例，可以一直下滑查看更多微博，但始终未发生页面 URL 的变化，这后面刷新出来的数据就是 Ajax 请求得到的。")]),t._v(" "),s("h4",{attrs:{id:"基本原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[t._v("#")]),t._v(" 基本原理")]),t._v(" "),s("p",[t._v("JavaScript 实现 Ajax 请求的代码如下：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XMLHttpRequest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    xhttp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// code for IE6, IE5")]),t._v("\n     xhttp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ActiveXObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Microsoft.XMLHTTP"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/test-api"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("ul",[s("li",[t._v("整个过程就是先新建一个 XMLHttpRequest 对象 xhttp，然后调用 onreadystatechange 属性设置监听，最后调用 open 和 send 方法向某个连接发送请求。")])]),t._v(" "),s("p",[t._v("真实的网页数据其实就是一次次向服务器发送 Ajax 请求得到的，要想抓取这些数据，需要知道 Ajax 请求到底是怎么发送的、发往哪里、发了哪些参数。我们知道了这些信息后，便可以用 Python 来模拟发送请求来获取数据。")]),t._v(" "),s("h3",{attrs:{id:"_1-2-ajax-分析方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ajax-分析方法"}},[t._v("#")]),t._v(" 1.2 Ajax 分析方法")]),t._v(" "),s("p",[t._v("仍然以 "),s("code",[t._v("https://m.weibo.cn/u/2830678474")]),t._v(" 为例，打开页面后在浏览器中打开开发者工具的 Network 部分，可以看到所有网络请求。"),s("strong",[t._v("Ajax 有其特殊的请求类型，叫做 xhr")]),t._v("，也可以利用筛选功能筛选出 XHR 的请求：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220113001424349.png",alt:"image-20220113001424349"}})]),t._v(" "),s("p",[t._v("点击该请求可以看到详细信息，其中在 Request Headers 中有一个信息为 "),s("code",[t._v("X-Requested-With: XMLHttpRequest")]),t._v("，这就标记了此请求是 Ajax 请求。")]),t._v(" "),s("p",[t._v("随后单击一下 Preview 或者 Response 选项卡就可以看到返回的数据。")]),t._v(" "),s("h2",{attrs:{id:"_2-selenium-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-selenium-的使用"}},[t._v("#")]),t._v(" 2. Selenium 的使用")]),t._v(" "),s("h2",{attrs:{id:"_3-pyppeteer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-pyppeteer"}},[t._v("#")]),t._v(" 3. Pyppeteer")]),t._v(" "),s("h2",{attrs:{id:"_4-playwright-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-playwright-的使用"}},[t._v("#")]),t._v(" 4. Playwright 的使用")]),t._v(" "),s("p",[t._v("Playwright 是微软在 2020 年初开源的新一代自动化测试工具，它的功能类似于 Selenium、Pyppeteer 等，都可以驱动浏览器进行各种自动化操作。它的功能也非常强大，对市面上的主流浏览器都提供了支持，API 功能简洁又强大。虽然诞生比较晚，但是现在发展得非常火热。")]),t._v(" "),s("h3",{attrs:{id:"_4-1-特点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-特点"}},[t._v("#")]),t._v(" 4.1 特点")]),t._v(" "),s("ul",[s("li",[t._v("Playwright 支持当前所有主流浏览器，包括 Chrome 和 Edge（基于 Chromium）、Firefox、Safari（基于 WebKit） ，提供完善的自动化控制的 API。")]),t._v(" "),s("li",[t._v("Playwright 支持移动端页面测试，使用设备模拟技术可以使我们在移动 Web 浏览器中测试响应式 Web 应用程序。")]),t._v(" "),s("li",[t._v("Playwright 支持所有浏览器的 Headless 模式和非 Headless 模式的测试。")]),t._v(" "),s("li",[t._v("Playwright 的安装和配置非常简单，安装过程中会自动安装对应的浏览器和驱动，不需要额外配置 WebDriver 等。")]),t._v(" "),s("li",[t._v("Playwright 提供了自动等待相关的 API，当页面加载的时候会自动等待对应的节点加载，大大简化了 API 编写复杂度。")])]),t._v(" "),s("h3",{attrs:{id:"_4-2-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-安装"}},[t._v("#")]),t._v(" 4.2 安装")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("Playwright-python 的安装")]),t._v(" "),s("p",[s("code",[t._v("pip install playwright -i https://mirrors.aliyun.com/pypi/simple/")]),t._v(" 使用阿里源，下载速度快一点。")]),t._v(" "),s("p",[s("code",[t._v("python -m playwright install")]),t._v(" 安装chromium、frefox、"),s("a",{attrs:{href:"https://so.csdn.net/so/search?q=webkit",target:"_blank",rel:"noopener noreferrer"}},[t._v("webkit"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("使用时用 "),s("code",[t._v("python -m playwright [commands]")]),t._v(" 即可。")])]),t._v(" "),s("h3",{attrs:{id:"_4-3-基本使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-基本使用"}},[t._v("#")]),t._v(" 4.3 基本使用")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://cuiqingcai.com/36045.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("新兴爬虫利器 Playwright 的基本用法"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/451405689?utm_source=qq&utm_medium=social&utm_oi=938396026793680896",target:"_blank",rel:"noopener noreferrer"}},[t._v("Scrapy 对接 Playwright"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=n.exports}}]);