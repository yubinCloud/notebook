---
title: Structured Learning
date: 2022-11-13 15:42:09
permalink: /pages/ml/lhy/structured-learning/
categories:
  - AI
  - 机器学习
  - 李宏毅-机器学习（2017）
tags:
  - 
---

## 1. Structured Learning

### 1.1 什么是 Structured Learning

We need a more powerful function $f$：

+ input and output are both objects with structures.
+ Object: sequence, list, tree, bounding box …

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113154545607.png" alt="image-20221113154545607" style="zoom:67%;" /></center>

### 1.2 Example Application

+ Speech recognition
  + X: Speech signal (sequence) –>  Y: text (sequence)
+ Translation
  + X: Mandarin sentence (sequence)  –>  Y: English sentence (sequence)
+ Syntactic Parsing
  + X: Sentence –> Y: parsing tree (tree structure)
+ Object Detection
  + X: image –> Y: bounding box
+ Summarization
  + X: long document  –> Y: summary (short paragraph)
+ Retrieval
  + X: keyword  –>  Y: search result (a list of webpage)

## 2. Unified Framework

### 2.1 Structured Learning 的 Unified Framework

Structured Learning 的做法听上去可能很难，但他有一个 unified framework：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113155350356.png" alt="image-20221113155350356" style="zoom:75%;" /></center>

**<u>在 training 阶段</u>**，我们首先要找一个大小的 F，它的 input 是 x 与 y，它的 output 就是一个 real number，F 做得事情就是衡量两个 structured object $x$ 与 $y$ 有多匹配，越匹配的话，output 的值越大。

**<u>在 inference 阶段</u>**，给一个新的 x，我们要穷举所有可能的 y，然后代入 F 中，看看哪个 y 的 F(x, y) 最大，让 F 值最大的 y 就记作 $\tilde{y}$，这个 $\tilde{y}$ 就是我们 model 最终要辨识的结果 $f(x)$，即：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113160207740.png" alt="image-20221113160207740" style="zoom:67%;" /></center>

### 2.2 Example - Object Detection

*Task description*:

+ Using a bounding box to highlight the position of a certain object in an image.
+ E.g. A detector of Haruhi

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113160623377.png" alt="image-20221113160623377" style="zoom:67%;" /></center>

#### 1）Training 阶段

这个 Object Detection 该怎么做呢？在 training 阶段：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113160806007.png" alt="image-20221113160806007" style="zoom:80%;" /></center>

那这里的 F(x, y) 所做的就是去说这张 image 与这个 bounding box 有多匹配，如下图所示：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113160946701.png" alt="image-20221113160946701" style="zoom:67%;" /></center>

+ bounding box 框在了凉宫春日上的话，得分就很高，越偏离，得分就越低。

#### 2）Inference 阶段

比如我们 input 下面一张 image：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113161657659.png" alt="image-20221113161657659" style="zoom:75%;" /></center>

然后我们穷举所有的 bounding box $y$，得到不同的得分：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113161854633.png" alt="image-20221113161854633" style="zoom:67%;" /></center>

那我们最终的 output $\tilde{y}$ 就是得分最高的那一个。

### 2.3 Unified Framework 到底在搞什么？

第一次听这个 Unified Framework 也许不知道在搞什么，也许感觉这个 F 很怪，但换一个说法也许就可以接受了：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20221113163002952.png" alt="image-20221113163002952" style="zoom:80%;" /></center>

+ Training 阶段，我们就 estimate 一个 x 和 y 的 joint probability $P(x, y)$
+ Inference 阶段，给我们一个 object $x$，我们就计算 $P(y|x)$ 这个几率，哪个 y 的概率最大，哪个就是最终答案。而计算哪个 $P(y|x)$ 最大就等价于计算哪个 joint probability $P(x, y)$ 最大

所以刚刚 Unified Framework 中说的 F 所计算 x 与 y 有多相容，其实就是在说计算 x 与 y 的 joint probability，因为其实这个几率 $P$ 本身也是一个 function，它的 output 是一个介于 0-1 之间的值。

概率图模型（Graphical Model）就是 structured learning 的一种，完全可以套进来。像 Markov Random Field 等，它们都是去找一个 evaluation 的 function $F$，只不过这些 evaluation function 是一个几率 $P$。

**用概率 $P$ 来作为 evaluation 的 function 有什么缺点**：

+ *Probability cannot explain everything.* 比如在 Retrieval 的任务中，input x​ 是查询词 keyword，y 是搜寻的结果 webpage，而衡量这个 keyword 与 webpage 共同出现的几率，会让人觉得很怪；
+ *0-1 constraint is not necessary*. x 和 y 都是 structured object，它们的取值空间都是一个很大的 space，而做这个几率就需要 normalize 成一个 0-1 的东西，而这个 normalization 就需要你花很大的时间

**用概率也有好处的**：

+ *Meaningful*. 用几率是比较容易让你去想象

structured learning 也有人同时提出另一种叫法：<mark>Energy-based Model</mark>，可以参考 http://www.cs.nyu.edu/~yann/research/ebm/

## 3. Three Problem

具体做这个 Unified Framework，你就是要去解三个 problem：

// TODO