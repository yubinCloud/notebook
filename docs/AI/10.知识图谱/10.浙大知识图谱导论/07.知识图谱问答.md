---
title: 知识图谱问答
date: 2023-01-12 23:11:51
permalink: /pages/40192b/
categories:
  - AI
  - 知识图谱
  - 浙大知识图谱导论
tags:
  - 
---

## 1. 智能问答概述

### 1.1 智能问答的发展历史

#### 1.1.1 特定领域的问答系统

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230112231845296.png" alt="image-20230112231845296" style="zoom:80%;" /></center>

+ BaseBall 和 LUNAR 大量依靠人类撰写的规则模板，实现从自然语言到结构化查询语句的转化
+ MYCIN 系统通过一个由 600 多条的规则组成的知识库和一个推理引擎，为用户提供抗生素的问答服务，这类系统要求像人一样具有丰富的知识，并通过知识和推理来回答人类的问题

可以看出，解决人机交互问答问题，有两个重要的手段：自然语言理解和知识表示与推理。

#### 1.1.2 开放领域的问答系统

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230112232403338.png" alt="image-20230112232403338" style="zoom:80%;" /></center>

### 1.2 智能问答分类

#### 1.2.1 按答案来源分

+ 知识图谱问答：以结构化的知识库作为问答的语料
+ 表格问答：主要针对表格和列表数据进行问答（比如给定一个 Excel）
+ 文本问答：要求机器能够从一段文字中精确识别一个问题的答案（类似于英语阅读理解）
+ 社区问答：以问答对的形式（如知乎）
+ 视觉问答：要求针对图片或视频中的内容进行问答

#### 1.2.2 按问句类型分

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230112233246886.png" alt="image-20230112233246886" style="zoom: 67%;" />

这里的主题是知识图谱问答，相比于文本，结构化的 KG 能够提供更为精准的答案，并且能依赖 KG 中的实体关联关系，非常方便地扩展相关的答案。

### 1.3 各种类型的 QA

#### 1.3.1 KBQA

一种实现 KBQA 的方式是，将一个自然语句解析成一个结构化的查询语句，再对知识图谱进行查询匹配，或者直接依据问句的特征，对知识图谱中的候选实体进行打分排序。具体的技术在后面介绍。

#### 1.3.2 Textual QA

文本问答，要求给定一段自然语言文本，并从文本中准确地定义答案。例如 Stanford SQuAD 就要求从文本中提取答案：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230112233813985.png" alt="image-20230112233813985" style="zoom:80%;" /></center>

这也许是 QA 的理想形式，具体实现方式上，这里分成了两派：

+ 一派认为通过语言预训练的模型，可以学习出文本中的知识并用于智能问答
+ 另外一派则认为必须要构建结构化的知识图谱，才能支持智能问答的实现

其实这两者并非替代关系，而是都要用到的技术手段。但本章将不再介绍 Textual QA 的相关技术。

#### 1.3.3 Table QA

表格也是一种常见的结构化数据的组织形式，很多数据无需组织为 graph，相比之下 table 的形式更加简洁明了，同时 table 的处理也相比 graph 更加简单，处理效率也更高。因此，Table QA 也是很多问答系统的重要模块。

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230112234854510.png" alt="image-20230112234854510" style="zoom: 60%;" /></center>

该任务又细分为表格检索和答案生成两步，前者从表格集合中找出与输入问题最相关的表格，后者负责基于检索回来的表格生成答案。

#### 1.3.4 Community QA

社区问答主要以“问答对”的形式组织数据，通常这些问答对都是从问答社区（如知乎）获取的问答对的数据集合。

由于这些问答对数据实际上是由人工众包获取的专家经验型知识，这类知识通常比较难于直接从文本中自动抽取获得，因此对于构建智能问答系统有重要的价值。

基于问答对的社区问答实现，在形式上也比较简洁，我们可以直接训练一个模型来计算问句和答案之间的语义相似性就可以了。当然，问答对的形式也可以和知识图谱问答模型、文本问答模型混合起来使用以提升问答的效果。

#### 1.3.5 Visual QA

它也是一种 QA 的终极形式，要求机器能够正确理解图片或视频中的语义内容，才能完成复杂的问句问答。

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113000241940.png" alt="image-20230113000241940" style="zoom: 67%;" /></center>

有时，为了实现 Visual QA，也需要引入外部的知识作为辅助。

#### 1.3.6 文本问答 + 知识图谱问答

> Question Answering on Knowledge Bases and Text using Universal Schema and Memory Networks. ACL2017

KG 问答也经常用于提升文本问答和 Visual QA 的效果。比如下面的工作，将结构化的知识与文本中的实体与关系描述先进行对齐，然后将 KG 与文本一同作为 model 训练的输入。文本的好处是答案的覆盖面广，语料容易获得；KG 的好处是能够提供精准的答案，但通常对答案的覆盖面不够。通过两者的结合可以提升问答的效果。

#### 1.3.7 Visual QA + KBQA

可以先对 image 中的实体做识别，然后与外部的 KG 进行链接，这样就可以利用外部 KG 的实体关系来进一步拓展 Visual QA 的效果。

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113002038497.png" alt="image-20230113002038497" style="zoom: 67%;" />

后续将主要介绍与知识图谱问答有关的技术。

### 1.4 实现 KBQA 的主要技术方法

KBQA 的设定是给定自然语言问句，要求从知识图谱中寻找答案。

+ 一种思路是将输入的自然语言问句解析成结构化的逻辑查询语句，然后直接对 KG 进行查询并获取答案。这个解析的过程有两种实现思路：1. 人工定义问句模板 2. 训练一个语义解析器
+ 一种思路是采用类似信息检索的方法，我们把查询问答问题转换为对 KG 中候选答案实体进行匹配和排序的问题。随着 DL 的崛起，基于 Neural Network 的方法也被广泛用来实现知识图谱的问答。

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113002816956.png" alt="image-20230113002816956" style="zoom:90%;" /></center>

可以看到，NN 的方法主要用来改进语义解析技术和重构检索排序，后面将分别对这些技术进行介绍。

### 1.5 问句解析 VS 检索排序

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113004413752.png" alt="image-20230113004413752" style="zoom:67%;" /></center>

+ **语义解析方法**的核心是实现一个 Semantic Parser，它将 Question 转化为一个在 KG 上的 Structured Query，但问题是实现一个通用的 Semantic Parser 并不容易，这往往需要依赖人工模板实现解析，因而可复用性不太好。

+ **基于检索排序的方法**通常首先对问句进行实体和关系的识别，然后锁定问题的主题实体（Topic Entity），进而在 KG 中以这个 topic entity 出发，寻找候选实体，最后通过一个排序机制来对候选实体进行排序。这种方法不依赖于人工模板，可复用性好，但这由于对问题的语义理解不够深入，通常不容易获得精准的答案。

### 1.6 知识图谱问答测评数据集

#### 1.6.1 QALD

**QALD**：Question Answering over Linked Data

ESWC 上开展，旨在建立一个统一的知识图谱测评基准。每年 100 个问题左右，从 2011 年开始。数据来源包括 Dbpedia 、 YAGO 和 MusicBrainz。主要任务有三类：

+ 多语种问答，基于 Dbpedia
+ 基于链接数据（interlinked data）的跨数据集问答
+ 融合文本数据的 Hybrid QA，基于 RDF and free text data

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113004812758.png" alt="image-20230113004812758" style="zoom:100%;" />

#### 1.6.2 WebQuestions

**WebQuestions** 也是用于对 KG 问答进行基准测试的常用数据集，面向的是**通用领域的问答**。该数据集包含 6642 个问答对，问题主要围绕单个命名实体，每个问题都有为一个的 ID，基于 Freebase 的答案进行问题标注。

![image-20230113005050650](https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113005050650.png)

> https://github.com/brmson/dataset-factoid-webquestions

#### 1.6.3 SimpleQuestions

**SimpleQuestions** 是一个对简单知识图谱问答进行基准测试的常用数据集。数据集总共包含 108,442 个自然问题，每个问题都与一个对应的事实配对，对应了知识图谱中的一个三元组，训练集、验证集、测试集的比例是 7:1:2 。

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113005325196.png" alt="image-20230113005325196" style="zoom:80%;" />

> https://research.fb.com/downloads/babi/

#### 1.6.4 MetaQA

**MetaQA** 是一个针对垂直电影领域的知识图谱问答进行基准测试的常用数据集。其知识图谱包含电影领域中的演员、导演、编剧、电影及其类型等内容，总计包含超过 40 万个问题，问题的形式包含文本形式和语音形式。典型特点是关注多跳问答， 1 跳、 2 跳、 3 跳的样本大致是 1:1:1。

> https://github.com/yuyuz/MetaQA

#### 1.6.5 More

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113005823375.png" alt="image-20230113005823375" style="zoom: 50%;" />

::: warning 小结

+ 目前常见的智能问答技术包括文本问答、知识图谱问答、社区问答（问答对）、表格问答、视觉问答等多种形式，其中，知识图谱问答是起到各类问答核心桥梁作用的问答形式，通常会与文本、视觉、社区等问答形式混合搭配起来使用。
+ 实现人与机器之间更为自然的交互方式也是人工智能追求的终极目标之一，这涉及怎样让机器理解人的自然语言，以及怎样让机器获取和表示知识两个方面的问题。这两个问题的解决仍然面临很多挑战需要解决。

:::

## 2. 基于问句模板的 KBQA

基于问句模板的方法虽然很笨，但却能够提供非常精准的语义解析，在实际工业落地中仍然被广泛应用。

### 2.1 KBQA 的主要挑战

两个核心挑战：

1. 怎样表示问句，并正确理解问句中的语义
2. 怎样将问句的语义与 KG 中的 entity 和 relation 进行匹配

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113010452666.png" alt="image-20230113010452666" style="zoom:80%;" />

### 2.2 模板方法的一般流程

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113010614315.png" alt="image-20230113010614315" style="zoom:80%;" /></center>

+ 定义模板
+ 通过问句与 KB 的映射完成模板的实例化
+ 对实例化的所有可能查询进行排序
+ 选择最好的查询，并对 KG 进行查询操作获得结果

### 2.3 问句模板实现举例：TBSL

> TBSL (Unger et al., 2012)

TBSL 是通过模板的方法，将自然语言问句转化为一个 SPARQL 查询，进而从 SPARQL 从 KG 中寻找答案。

#### 2.3.1 TBSL 基本思路

+ **词的理解**：通常是 KG-Dependent
  + Abranham Lincoln  -> res:AbranhamLincoln
  + died in -> dbo:deathPlace
+ **问句的语义结构**：通常是 KG-Independent
  + who -> `SELECT ?x WHERE {...}`
  + the most N -> `ORDER BY DESC(COUNT(?N)) LIMIT 1`
  + more than i N -> `HAVING COUNT(?N) > i`

#### 2.3.2 TBSL 核心步骤

目标：将问句的语义结构分析和词语向 KG 的映射结合起来

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113014106223.png" alt="image-20230113014106223" style="zoom:80%;" />

一个示例：问句“Who produced the most films?”可以进行如下转换：

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113014310157.png" alt="image-20230113014310157" style="zoom: 50%;" />

接下来，我们一步步介绍具体的实现过程。

#### Step 1：Template Generation

结合KG 的结构和问句的句式，进行模板定义，通常没有统一的标准或格式。

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113014804169.png" alt="image-20230113014804169" style="zoom: 50%;" /></center>

这里举个例子，如下图，对一个句子，通过分析它的词，可以将其对应到一个 SPARQL 模板上：

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113014944217.png" alt="image-20230113014944217" style="zoom:80%;" />

可以看出，一个问题可能有多个查询模板。

#### Step 2：Template Instantiation

这一步就是将 SPARQL 模板实例化，也就是将自然语言问句与 KG 中的本体概念相映射。

+ 对于 Resources 和 Classes：
  + 可用 WordNet 获取知识图谱中对应标签的同义词，然后计算字符串相似度获得映射关系
  + 最高排位的概念将作为填充查询槽位的候选
+ 对于 Property
  + 还需要与模式库中的自然语言表示进行比较，有可能会需要将单个 Property 分解为多个谓词
    的组合描述

如下面这个例子，这里 films 和 produced 可以被映射到 KG 上多个可能的类或关系上：

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113015618370.png" alt="image-20230113015618370" style="zoom:80%;" />

从这里也可以看出，一个查询模板，也可能生成多个查询实例。再加上前面说的一个问题可能有多个查询模板，因此一个问题最终可能产生很多个查询实例。

#### Step 3：查询排序与答案选择

模板实例化会产生很多可以直接执行的查询语句，哪个查询获得的答案最好呢？因此还需要一些方法对查询语句句进行排序以获取最优答案。

一般的做法如下：

+ 每个匹配的 Resource（Class, Property, Entity）根据 String Similarity 和 Prominence 获得一个打分
+ 一个查询模板实例的分值根据替换相应 Slots 的多个资源的平均打分。
+ 利用类型检查排除掉不正确的匹配：例如需要检查 property 的 domain/range 是否与 \<class\> 一致
+ 对于全部的查询集合，仅返回打分最高的。

如下图的例子，我们依据模板与 KG 映射的匹配程度来对实例化的模板进行打分，得分最高的被认为是最正确的问句解析结构，将被用来在 KG 中查询获取最终的答案。

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230113021308833.png" alt="image-20230113021308833" style="zoom:67%;" /></center>

### 2.4 模板是否可以自动生成？

模板的定义耗费人力，且需要不断根据新的问句而增加新的模板，那么模板是否可以通过更加自动化的方式来自动生成呢？

// TODO