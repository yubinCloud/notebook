---
title: 实操篇（下）
date: 2022-02-14 16:57:22
permalink: /pages/edf6d9/
categories:
  - 运维
  - Linux
  - 韩顺平 2021 Linux 课程笔记
tags:
  - 
---
## 1. 网络配置

### 1.1 Linux 网络配置原理

假设我们的物理主机在一个教室的局域网内：

 ![image-20220214170223466](https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220214170223466.png)

+ Linux 虚拟机和  vmnet8 在一个子网内形成一个网络，可以互通（ping 通）
+ 本机电脑的无线网卡与教室局域网的网管互通，vmnet8 又和无线网卡互通

### 1.2 查看网络 IP 和网关

#### 1.2.1 查看虚拟机 IP

在 Linux 中的 `ifconfig` 可以看到本机的 IP：

```bash {3}
$ ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.220.134  netmask 255.255.255.0  broadcast 192.168.220.255
        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (Ethernet)
        RX packets 142  bytes 14858 (14.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 130  bytes 17101 (16.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

可以看到 Linux 虚拟机的 IP 为 192.168.220.134。

#### 1.2.2 查看网络编辑器和网关

在 VMware 的**虚拟网络编辑器**中，可以看到 NAT 连接方式下本机的子网 IP：

<img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220214171502174.png" alt="image-20220214171502174" style="zoom: 72%;" />

然后在点击 `NAT 设置` 可以看到网关：

![image-20220214171709983](https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220214171709983.png)

#### 1.2.3 查看 Windows 环境中的 VMnet8 网络配置

使用 `ipconfig` 命令：

```powershell
> ipconfig
...
以太网适配器 VMware Network Adapter VMnet8:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::c823:6a37:c475:ed49%24
   IPv4 地址 . . . . . . . . . . . . : 192.168.220.1
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . :
...
```

### 1.3 ping 测试连通性

`ping 目的主机`：测试当前服务器是否可以连接目的主机

> 测试是否可以连接百度：`ping www.baidu.com`

### 1.4 Linux 网络环境配置

#### 1.4.1 第一种方法：自动获取

登录后，通过界面来设置自动获取 IP。特点：Linux 启动后会自动获取 IP，但**每次自动获取的 IP 地址可能不一样**。

![image-20220214174016538](https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220214174016538.png)

#### 1.4.2 第二种方法：指定 IP :star:

直接修改配置文件来指定 IP，并可以连接到外网（程序员推荐）。

配置文件根据网卡不同名字有所区别，但文件路径一致：/etc/sysconfig/network-scripts/，常见的配置文件名有 ifcfg-eth0 或者 ifcfg-ens33，可以通过 ifconfig 查看后缀。

以 ifcfg-ens33 为例，使用 vim 修改此文件 `vim /etc/sysconfig/network-scripts/ifcfg-ens33 `：

```diff
YPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
- BOOTPROTO="dhcp"
+ BOOTPROTO="static"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="ens33"
UUID="1af88ac9-573c-49da-993c-9ab4e6c73159"
DEVICE="ens33"
ONBOOT="yes"
+ IPADDR=192.168.200.130 # 本机 IP 地址
+ NETMASK=255.255.255.0 # 子网掩码
+ GATEWAY=192.168.200.2 # 默认网关
+ DNS1=192.168.200.2 # 域名解析器
```

修改好后并保存。然后进入 VMware 的虚拟网络编辑器，将 NAT 配置中的子网 IP 改为 `192.168.200.0`，将网关 IP 改为 `192.168.200.2`。修改位置可见本文的 1.2.2 节所示。

完成以上操作后，重启网络服务或重启系统生效：

`service network restart`、`reboot`

以上这些操作就是将本文 1.1 节图中的 Linux 虚拟机和 vmnet8 的地址分别改成了 `192.168.200.130` 和 `192.168.200.1`。这时在虚拟机中使用 `ifconfig` 命令可以看到：

```bash {3}
$ ifconfig
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.200.130  netmask 255.255.255.0  broadcast 192.168.200.255
        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (Ethernet)
        RX packets 792  bytes 825124 (805.7 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 456  bytes 33428 (32.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

+ 本机 IP 已经成功改为了 192.168.200.130。

### 1.5 设置主机名和 hosts 映射

#### 1.5.1 设置主机名

为了方便记忆，可以**给 Linux 系统设置主机名**，也可以根据需要修改主机名。

指令 `hostname`：查看主机名

修改文件在 /etc/hostname 指定。修改后重启生效。

#### 1.5.2 设置 hosts 映射

思考：如何通过主机名能够找到（比如 ping）某个 Linux 系统？

**Hosts**：一个记录 IP 和 hostname 之间映射关系的文本文件。

:pencil2: Windows 中，在 `C:\Windows\System32\drivers\etc\hosts` 文件指定即可。

> 案例：`192.168.200.130 hspEdu100`
>
> + 前半部分是 IP 地址，后半部分是其对应的主机名
>
> PS：还有一个常见的案例是 `127.0.0.1 localhost`

:pencil2: Linux 中，在 `/etc/hosts` 文件指定即可。

> 案例：`192.168.200.1 ThinkPad-PC`

### 1.6 应用实例：浏览器解析 `www.baidu.com` 的过程

1. 浏览器**先检查浏览器中有没有该域名解析 IP**，有就先调用这个 IP 完成解析。如果没有，就**再检查 DNS 解析器缓存**，如果有就直接返回 IP 完成解析。这两个缓存可以理解为**本地解析器缓存**。
2. 一般来说，当电脑第一次成功访问某一个网站后，在一定时间内浏览器或 OS 会缓存它的 DNS 解析记录。

```
ipconfig /displaydns  // 查看 DNS 域名解析缓存
ipconfig /flushdns    // 手动清理 DNS 缓存
```

3. 如果本地解析器缓存没有找到对应的映射，就**检查系统中 hosts 文件**中有没有对应的域名 IP 映射，有则完成解析并返回。
4. 如果本地 DNS 解析器缓存和 hosts 文件都没能解析出对应的 IP，则到域名服务 DNS 进行解析域。

## 2. 进程管理

// TODO