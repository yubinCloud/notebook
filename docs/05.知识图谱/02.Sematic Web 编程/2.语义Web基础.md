语义 Web 程序设计涵盖了两个基本方面：知识表示和应用程序集成。本部分重点在于知识表示——使用资源描述框架（RDF）、数据模型、本体（OWL）、查询、规则和推理来实现知识的表示和操作。

[[toc]]

# chapter 3 信息建模

在语义 Web 上，信息建模主要借助于一个互补的语言集合——**RDF**（资源描述框架）、**RDFS**（RDF Scheme）和 **OWL** Web 本体语言。本章主要介绍 RDF，它定义了底层的数据模型。

## 3.1 软件中的信息建模

语义 Web 技术的信息模型的设计目标是为了使数据共享和交互操作更加便捷。

### 3.1.1 共享信息：语法和语义

系统之间共享数据的问题可以分解为——语法共享问题（选媒介）和语义共享问题（选语言或编码方式）。

有以下三种信息表示方式来表达共享数据的含义：

1. <u>序列化对象</u>：最简单直接，但要求接收者对发送者的数据结构十分了解；
2. <u>关系数据库</u>：虽然有了标准的 API（如 ODBC、JDBC）和 SQL 语句，但也面临驱动程序版本等不同的问题，比如接收者不知道发送者使用的是 Oracle 还是 SQL Server；
3. <u>可扩展标记语言（XML）</u>：虽然流行且灵活，但缺乏保留字，且其元素和属性本身没有含义，因此标签的顺序改变或术语变化都会给开发者带来大量工作。

实际上，数据共享语义层问题的进展源自与这样的感悟：数据和元数据之间的差异其实是一种错觉。

### 3.1.2 信息共享中的元数据和数据

**数据**是数值，是信息的个体原子；**元数据**描述了这些原子和其他数据之间的关系。比如数据库中的记录是数据，而表格的模式是元数据。

为了使计算机能够自动共享信息，就应当将数据和元数据归为一类。从某种意义上说，没有元数据就没有了谈话的主题，而没有数据就没有了要说的内容。<u>将元数据和数据组合在一起</u>便于信息的移植，极大减少了信息共享的问题，另外这种做法还提供了更大的灵活度，<u>因为已有的信息可以通过额外的元数据来进行扩展</u>。

## 3.2 语义 Web 信息模型：RDF

在语义 Web 上，信息被表示成陈述（Statement）的集合。

**陈述**由主语、谓语和宾语组成，也成为**三元组**（triple），比如 `Andrew knows Matt`。

![image-20220103113501677](https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220103113501677.png)

+ 我们约定：资源用椭圆表示，文字用矩形表示。

### 3.2.1 节点：资源或文字

RDF 图的节点有两种类型：资源（resource）和文字（liberal）。

+ **资源**可以表示任何可以被命名的东西，如一个概念、某一本书、这个网页等；
+ **文字**是具体的数据值，如数字或者字符串。文字不能作为陈述的主语。

资源采用国际化资源标识符（**IRI**）的形式。IRI 是统一资源定位符（URI）的一种扩展，考虑到 IRI 和 URI 之间的相似性，往往两者可以混用。IRI 的<u>一般形式</u>：

$$schema://authority/path?query\#fragment$$

比如 `http://www.baidu.com:80/index.html`、`ftp://server.example.com/foo` 等。IRI 是一个在全世界范围内**唯一**的名称，精确地描述了某个特定资源，它既可以是实体对象，也可以是抽象概念。这样 IRI 在任何上下文环境中都是合法的，因此也便于移植。

### 3.2.2 边：谓语

**谓语**也称作属性，用来描述资源之间的关联。谓语本身也是资源，也使用 IRI 来表示。

> 由于完整的 IRI 会使图显得混乱，因此我们一般使用带前缀的形式。

**rdf:type** 是 RDF 定义的一种特殊谓语，它用于将谓语归为一类。比如 `p:Andrew rdf:type foaf:Person` 表达了 Andrew 是一个人，这样也就为其赋予了一个类型。注意，<u>一个资源可以不只有一个类型，也可以没有类型</u>。

## 3.3 RDF 的序列化

我们可以将 RDF 陈述视作抽象三维空间上的一个点，坐标为 (s, p, o)。每个点是一个信息原子，这些点的集合表示成了一个 RDF 图。通过这种方式来考虑陈述可以看出这种表达方式为数据共享带来的一些好处：

+ **便于合并**：两个点集可以相互重叠，因此由多条陈述构成的两个图也可以合并成一个更为丰富的一个图。
+ **无序**：陈述是相互独立的，这意味着它们之间不存在次序上的先后问题。
+ **无重复**：如果两个陈述有相同的主谓宾，则它们是<u>相同</u>的。向一个集合中加入一个重复的陈述不会为整个集合贡献新的信息。

**序列化**提供了一种将抽象数据转换为具体格式（如文件或字节流）的方法，使其在不同程序间进行信息交换。有多种不同的序列化方式：

### 3.3.1 RDF/XML

**RDF/XML** 是一种表示 RDF 的 XML 语法，它是 RDF 序列化的官方标准（因为XML常用）。但遗憾的是，有了 RDF 基准格式却没有 RDF/XML 的标准表示，这使得同一个 RDF 图用不同的工具序列化而产生的结果也有所不同。

```xml
<rdf:RDF
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:foaf="http://xmlns.com/foaf/0.1/"
    xmlns:people="http://semwebprogramming.net/people#"
    xmlns:ext="http://semwebprogramming.net/2008/06/ont/foaf-extension#">
    
    <!-- This is a comment. -->
    
    <rdf:Description rdf:about="http://sem../people#Ryan">
        <rdf:type rdf:resource="http://xmlns.com/foaf/0.1/Person" />
        <foaf:knows rdf:resource="http://sem../people#John"/>
        <foaf:name>Ryan Blace</foaf:name>
        <ext:year 
            rdf:datatype="http://www.w3.org/2001/XMLSchema#int">28</ext:year>
        <foaf:givenname xml:lang="en">Ryan</foaf:givenname>
    </rdf:Description>
</rdf:RDF>
```

+ **整体结构**：所有 RDF 内容都包含在一个 rdf:RDF 标签中，该标签中又包含一系列 rdf:Description 元素。
+ 各名称空间（前缀）是在 rdf:RDF 标签的一开始声明的。
  + `http://www.w3.org/1999/02/22-rdf-syntax-ns` 该名称空间按照标准简写为 rdf，不论在哪种序列化方式中都是如此。

+ **注释**：与 XML 相同
+ **陈述**：被分组到 `<rdf:Description>` 中，每个描述的 `rdf:about` 属性指定了<u>主语</u>，后续的描述定义了陈述的谓语和宾语。内部的标签表示一个<u>谓语</u>。对<u>宾语</u>的表述对资源和文字略有区别，可见上例。
+ **资源**：主语的资源通过 `<rdf:Description>` 的 `rdf:about`  属性指定；宾语出现在谓语标签的 `rdf:resource` 中。
+ **文字**：作为谓语元素的文本内容出现。
  + 文字可以被赋予一个标准的 XML Schema 数据类型（XSD），由 `rdf:datatype` 指明如何处理文字值；
  + 字符串文字可以使用语言进行标记，由 `xml:lang` 指明文本所使用的语言。合法的语言标签集合是有限制的，必须小写且每种语言编码都是通过 RFC3066 来确定的。可见上例。

**简写**：为资源指定类型时可以简写：`<type rdf:about="resource" />`，例如

```xml
<rdf:Description rdf:about="#Ryan">
        <rdf:type rdf:resource="http://xmlns.com/foaf/0.1/Person" />
</rdf:Description>
```

等价于

```xml
<foaf:Person rdf:ID="#Ryan" />
```

### 3.3.2 Turtle

Turtle 的可读性更好，专门为 RDF 设计。

```turtle
@prefix foaf: <http://xmlns.com/foaf/0.1/>
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
@prefix ...

# This is a comment.

people:Ryan ext:workWith people:John .
people:Andrw
    foaf:depiction <http://sem.org/semweb.jpg> ;
	foaf:surname "Perez-Lopez"@en ;
	foaf:knows people:Matt, people:Ryan, people:John ;
    ext:year "4"^^<http://www.w3.org/2001/XMLSchema#int>
    
```

+ **注释**：用 `#` 表示
+ **陈述**：一条主谓宾用空格隔开，以一个句点结尾。
  + 同一主语的多条陈述可以简写，见上例的 `people:Andrw`，中间的每条陈述以冒号结尾。
  + 当多条陈述有相同的主语和谓语时，不同宾语用逗号隔开，例子见 `foaf:knows`。
+ **资源**：两种写法：用 `<>` 封闭起来的 URI 或预先定义好的前缀形式。
+ **文字**：被封闭在双引号中，内部可以使用 `\` 来转义引号。含断行符的字符串可以使用三引号。
  + <u>数据类型</u>通过向文字结尾处附加 `^^<datatype URI>` 表示；
  + <u>语言</u>由文字结尾处附加 `@language` 来说明。

**简写**：<u>字母 a 可以指代繁琐的 rdf:type 标记</u>，如 `:Ryan a foaf:Person` 等价于 `:Ryan rdf:type foaf:Person`。

### 3.3.3 N-Triples

是 Turtle 的一种简化版本，它在注释、URI 和 文字值上都是用了与 Turtle 相同的语法，但不支持“@prefix”、“;” 以及 “,” 的陈述简写，使用一个包含主谓宾的行来陈述，单个陈述无法跨行。

### 3.3.4 格式转换

使用 Java 语言借由 Jena 可以实现不同格式的转换，但往往 Python 更易操作，可以使用 rdflib 库来完成：

```python
from rdflib import Graph

g = Graph()
g.parse("<文件名>")
g.serialize(format="turtle", destination="<文件名>")
```

具体可见 [rdflib官网](https://rdflib.readthedocs.io/en/stable/intro_to_parsing.html)。

## 3.4 更多内容

### 3.4.1 空白节点

并非所有资源都指定了全球性名称空间中的 URI，有些资源从概念上讲根本没有名称，称作**空白节点**。比如你可以说“我的另一半一定是长得帅、性格耐心”，这里的“另一半”是一个存在变量，并没有真正描述任何单个实体，而是一个实体的抽象模板，用 RDF 描述说就是

```
我 期望的 另一半
另一半 长得 帅
另一半 性格是 耐心
```

这里的“另一半”就可以用一个空白节点表示。

比如我们想表达生活在某个州、某个城市的某个人，那就无法用一条陈述将一个资源既关联到城市，又关联到州。虽然可以用两个陈述，但无法解决一个人有多个住址的情况，用空白节点可以表示为：

```turtle
# 第一个文件
sw:Bob sw:hasResidence _:residence .
_:residence sw:isInCity "Arlington" ;
            sw:isInState "VA" .

# 第二个文件
sw:Bob sw:hasResidence _:bobhouse .
_:bobhouse sw:isInCity "Arlington" ;
           sw:isInState "VA" .
```

这两个文件合并后将得到的结果是：

```turtle
sw:Bob sw:hasResidence _:node .
_:node sw:isInCity "Arlington" ;
       sw:isInState "VA" .
```

如果不适用空白节点的话，那这里只能用一个具体的 URI 来代替空白节点，这样两个文件合并后若表达住址的 URI 不完全相同的话，会产生两个住址的不被期望的结果。

**在 Turtle 中为空白节点保留了一个特殊前缀**：`_:`，例如 `_:blanknode`、`_:placeholder`、`_:p3` 等都是合法的空白节点。在单个 RDF 文档范围内，每个空白节点 ID 都是唯一的，比如 `_:blanknode`、`_:placeholder`是不同的空白节点，多个 `_:blanknode` 是指同一个空白节点。

**对空白节点，Turtle 也提供了简写方式**：用 `[]` 来定义一个空白节点，比如上例可以简写为：

```turtle
sw:Bob sw:hasResidence [
            sw:isInCity "Arlington" ;
            sw:isInState "VA"
].
```

空白节点也带来了**问题**：

+ 查询结果中若出现了空白节点，则赋给结果集的空白节点仅在该查询结果集中合法，无法在后继查询中直接引用该空白节点；
+ 使 RDF 图的合并变得复杂，为了保证合并后的文档中空白节点的唯一性，需要使处理过程变得复杂。

### 3.4.2 具体化（Reification）

RDF 的陈述可以描述另一条陈述——即**关于陈述的陈述**。

+ 用特殊类型 `rdf:Statement` 指派一个资源是一个陈述。
+ 谓语 `rdf:subject`、`rdf:predicate`、`rdf:object` 用于定义准备注释的陈述。

比如要表达“Matt 说 John 认识 Ryan”：

``` turtle
:Matt  :asserts  _:stmt .
_:stmt  a  rdf:Statement ;
       rdf:subject :John ;
       rdf:predicate foaf:knows ;
       rdf:object  :Ryan .
```

这个例子使用一个空白节点来表示陈述资源，虽然也可以用完整 URI 来表示。

### 3.4.3 RDF 容器和列表

RDF 容器和列表用于为信息分组。

#### RDF 容器

有三种资源类型，表示资源的集合：

+ **rdf:Bag**：无序的资源分组
+ **rdf:Seq**：有序的集合
+ **rdf:Alt**：也是无序集合，但它在描述一个等价可替换值的集合时使用（用户仅可选择这些值的其中之一）

示例：

```turtle
ex:Authors a rdf:Bag ;
           rdf:_1 people:Ryan ;
           rdf:_2 people:Matt ;
           rdf:_3 people:Andrew .

ex:Chapters a rdf:Seq ;
            rdf:_1 ex:ChapterOne;
            rdf:_2 ex:ChapterTwo;
            rdf:_3 ex:ChapterThree.

ex:HomePages a rdf:Alt ;
             rdf:_1 <http://www.example.net>
             rdf:_2 <http://www.example.org>
```

特殊的谓语集合`rdf:_1`、`rdf:_2`、`rdf:_3`.... `rdf:_n`关联了容器和资源。除了 rdf:Seq 外，n 的具体值可以忽略。也可以使用 `rdf:li` 来代替 `rdf:_n`，这样便不需要自己去维护 n 的数值。当使用 rdf:li 时，分组的第一个资源会变成 `rdf:_1` 、第二个变成 `rdf:_2` ...

#### RDF 列表

采用 `rdf:_n` 在合并时会出现 n 值的连续性问题，因此 RDF 提供了 **rdf:List 构造**的方式

```turtle
ex:Authors  a rdf:List ;
            rdf:first people:Ryan ;
			rdf:rest  _:r1 .
      _:r1  a rdf:List ;
            rdf:first people:Matt ;
            rdf:rest  _:r2 .
      _:r2  a rdf:List ;
            rdf:first people:Andrew ;
            rdf:rest  rdf:nil .
```

列表是由两个谓语创建的，**rdf:first** 引出其中一个列表的第一个元素，**rdf:rest** 引出另一个列表。而其自身的 rdf:first 支持整个列表的第二个元素，依次递归进行下去，知道列表的 rdf:rest 为 **rdf:nil** 为止。<u>这样合并时列表的内容和次序就不会变了</u>。

尽管上面的构造方式有效，但表达出来十分晦涩，Turtle 提供了简洁的方式来表示 RDF 列表：

```turtle
ex:Book ex:writtenBy (people:Ryan people:Matt people:Andrew) .
```

即使用圆括号表示列表，各资源之间用空格分开，这种简写形式与上面的 rdf:List 方式等价。