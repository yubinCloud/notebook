---
title: 分布式系统架构的本质
date: 2023-01-22 16:11:20
permalink: /pages/a81161/
categories:
  - 开发
  - 软件设计与架构
  - 专栏：左耳听风
tags:
  - 
---

> 参考：
>
> + [21 分布式系统架构的冰与火 | 极客时间](https://time.geekbang.org/column/article/1411)
> + [22 从亚马逊的实践，谈分布式系统的难点 | 极客时间](https://time.geekbang.org/column/article/1505)

## 1. 分布式系统架构的冰与火

### 1.1 为什么需要分布式系统

首先，我们需要阐述一下为什么需要分布式系统，而不是传统的单体架构。使用分布式系统主要有两方面原因：

+ **增大系统容量**。单台机器的性能无法满足了，需要垂直或水平拆分业务系统，让其变成分布式的架构。
+ **加强系统可用**。通过分布式架构来冗余系统以消除单点故障，从而提高系统的可用性。

当然，分布式系统还有一些其他优势，比如模块化、扩展性。但这个世界上不存在完美的技术方案，都存在一种 trade-off，下面这个表格比较了单体应用和分布式架构的优缺点：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230122205557493.png" alt="image-20230122205557493" style="zoom:80%;" /></center>

分布式系统架构的难点在于系统设计，以及管理和运维，这需要我们不断地用各式各样的技术和手段来解决这些问题。

### 1.2 分布式系统的发展

起初随着编程的发展，很自然演化出 SOA —— 基于服务的架构，它将应用程序功能作为服务发送给最终用户或者其他服务。它采用开放标准与软件资源进行交互，并采用标准的表示方式。

但 IBM 搞出来的 SOA 非常重，因此对 SOA 的裁剪和优化从来没有停过，最终改成了 RESTful 和 JSON 这样的方式，而 ESB（Enterprise Service Bus，企业服务总线）这样非常重要的东西也被简化成了 Pub/Sub 的消息服务 ……  如今，SOA 的思想也一直延续着，到了今天的分布式服务架构。

下面是一个 SOA 架构的演化图：

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20230122210028392.png" alt="image-20230122210028392" style="zoom:90%;" /></center>

我们可以看到，SOA 有以下三个阶段：

+ 20 世纪 90 年代前，是单体架构，软件模块高度耦合。
+ 2000 年左右出现了比较松耦合的 SOA 架构，这个架构需要一个标准的协议或是中间件来联动其它相关联的服务（如 ESB）。服务间不直接依赖，而是通过中间件或通讯框架来实现相互依赖，**这其实是 IOC（控制反转）和 DIP（依赖倒置原则）设计思想在架构中的实践**。
+ 2010 年后，出现了微服务架构，这个架构更为松耦合。它和传统 SOA 的差别在于，服务间的整合需要一个服务编排或是服务整合的引擎来将这些微服务来组织起来。

一般来说，这个编排和组织引擎可以是工作流引擎，也可以是网关。当然还需要像 K8s 这样容器化调度的技术。

微服务的技术需要一套比较好的微服务 PaaS 平台，比如像 Spring Cloud 一样需要提供各种配置服务、服务发现、智能路由、控制总线等功能，还有像 K8s 提供的各式各样的部署和调度方式。没有这些 PaaS 层的支撑，微服务也是很难被管理和运维的。

## 2. 从亚马逊的实践，谈分布式系统的难点

