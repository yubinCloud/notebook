<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>YAML、Pod、Job、CronJob、ConfigMap、Secret | notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/notebook/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="学习笔记">
    <meta name="keywords" content="全栈学习笔记">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.1b58b254.css" as="style"><link rel="preload" href="/notebook/assets/js/app.2bf3b6c1.js" as="script"><link rel="preload" href="/notebook/assets/js/2.0ad58009.js" as="script"><link rel="preload" href="/notebook/assets/js/336.cf000555.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.99522837.js"><link rel="prefetch" href="/notebook/assets/js/100.e3b56889.js"><link rel="prefetch" href="/notebook/assets/js/101.6ea1d00b.js"><link rel="prefetch" href="/notebook/assets/js/102.eca9dfbd.js"><link rel="prefetch" href="/notebook/assets/js/103.6ea477d4.js"><link rel="prefetch" href="/notebook/assets/js/104.ac820d2b.js"><link rel="prefetch" href="/notebook/assets/js/105.58b259a8.js"><link rel="prefetch" href="/notebook/assets/js/106.a86005d0.js"><link rel="prefetch" href="/notebook/assets/js/107.7a79d36f.js"><link rel="prefetch" href="/notebook/assets/js/108.64404e25.js"><link rel="prefetch" href="/notebook/assets/js/109.75f12c0a.js"><link rel="prefetch" href="/notebook/assets/js/11.d26d59e4.js"><link rel="prefetch" href="/notebook/assets/js/110.1155fe36.js"><link rel="prefetch" href="/notebook/assets/js/111.bf8b5871.js"><link rel="prefetch" href="/notebook/assets/js/112.22833ceb.js"><link rel="prefetch" href="/notebook/assets/js/113.6a080233.js"><link rel="prefetch" href="/notebook/assets/js/114.35de9701.js"><link rel="prefetch" href="/notebook/assets/js/115.f598d8c2.js"><link rel="prefetch" href="/notebook/assets/js/116.e3bd29ce.js"><link rel="prefetch" href="/notebook/assets/js/117.c3c02abc.js"><link rel="prefetch" href="/notebook/assets/js/118.136a552a.js"><link rel="prefetch" href="/notebook/assets/js/119.c124f3f8.js"><link rel="prefetch" href="/notebook/assets/js/12.dc66c4f2.js"><link rel="prefetch" href="/notebook/assets/js/120.f835d124.js"><link rel="prefetch" href="/notebook/assets/js/121.367716ae.js"><link rel="prefetch" href="/notebook/assets/js/122.752b0493.js"><link rel="prefetch" href="/notebook/assets/js/123.9f8d6026.js"><link rel="prefetch" href="/notebook/assets/js/124.e8eb61b6.js"><link rel="prefetch" href="/notebook/assets/js/125.cb081200.js"><link rel="prefetch" href="/notebook/assets/js/126.ab87d911.js"><link rel="prefetch" href="/notebook/assets/js/127.ffdbe74d.js"><link rel="prefetch" href="/notebook/assets/js/128.ec526e42.js"><link rel="prefetch" href="/notebook/assets/js/129.71839012.js"><link rel="prefetch" href="/notebook/assets/js/13.32e95b42.js"><link rel="prefetch" href="/notebook/assets/js/130.2bc0bb4d.js"><link rel="prefetch" href="/notebook/assets/js/131.5595b49b.js"><link rel="prefetch" href="/notebook/assets/js/132.4963c5c4.js"><link rel="prefetch" href="/notebook/assets/js/133.44f48cfd.js"><link rel="prefetch" href="/notebook/assets/js/134.cf25626c.js"><link rel="prefetch" href="/notebook/assets/js/135.5ee30fa9.js"><link rel="prefetch" href="/notebook/assets/js/136.bc43f8e6.js"><link rel="prefetch" href="/notebook/assets/js/137.9ab5beac.js"><link rel="prefetch" href="/notebook/assets/js/138.692a33e6.js"><link rel="prefetch" href="/notebook/assets/js/139.08e7c98d.js"><link rel="prefetch" href="/notebook/assets/js/14.c418d170.js"><link rel="prefetch" href="/notebook/assets/js/140.39a861db.js"><link rel="prefetch" href="/notebook/assets/js/141.46678413.js"><link rel="prefetch" href="/notebook/assets/js/142.f7ef5eac.js"><link rel="prefetch" href="/notebook/assets/js/143.c92cbac1.js"><link rel="prefetch" href="/notebook/assets/js/144.d9c61437.js"><link rel="prefetch" href="/notebook/assets/js/145.9f603b31.js"><link rel="prefetch" href="/notebook/assets/js/146.b875f045.js"><link rel="prefetch" href="/notebook/assets/js/147.55e7c4f8.js"><link rel="prefetch" href="/notebook/assets/js/148.4410c365.js"><link rel="prefetch" href="/notebook/assets/js/149.6096ed98.js"><link rel="prefetch" href="/notebook/assets/js/15.e0e7392a.js"><link rel="prefetch" href="/notebook/assets/js/150.24451f07.js"><link rel="prefetch" href="/notebook/assets/js/151.7cff301c.js"><link rel="prefetch" href="/notebook/assets/js/152.035fee1f.js"><link rel="prefetch" href="/notebook/assets/js/153.c61f8ec3.js"><link rel="prefetch" href="/notebook/assets/js/154.7bb549d0.js"><link rel="prefetch" href="/notebook/assets/js/155.1dc494db.js"><link rel="prefetch" href="/notebook/assets/js/156.b87eaf39.js"><link rel="prefetch" href="/notebook/assets/js/157.e3f5a5c0.js"><link rel="prefetch" href="/notebook/assets/js/158.c565c699.js"><link rel="prefetch" href="/notebook/assets/js/159.a22609ef.js"><link rel="prefetch" href="/notebook/assets/js/16.d1aef4ee.js"><link rel="prefetch" href="/notebook/assets/js/160.b29e761c.js"><link rel="prefetch" href="/notebook/assets/js/161.bee1e522.js"><link rel="prefetch" href="/notebook/assets/js/162.c49fca62.js"><link rel="prefetch" href="/notebook/assets/js/163.2cb4d37d.js"><link rel="prefetch" href="/notebook/assets/js/164.4a0dbc64.js"><link rel="prefetch" href="/notebook/assets/js/165.490d05b3.js"><link rel="prefetch" href="/notebook/assets/js/166.df5d2527.js"><link rel="prefetch" href="/notebook/assets/js/167.89a81814.js"><link rel="prefetch" href="/notebook/assets/js/168.9991702e.js"><link rel="prefetch" href="/notebook/assets/js/169.2f9a5dce.js"><link rel="prefetch" href="/notebook/assets/js/17.88ae5445.js"><link rel="prefetch" href="/notebook/assets/js/170.5f23eb3c.js"><link rel="prefetch" href="/notebook/assets/js/171.c521aaa8.js"><link rel="prefetch" href="/notebook/assets/js/172.42110b0a.js"><link rel="prefetch" href="/notebook/assets/js/173.5e36f1bf.js"><link rel="prefetch" href="/notebook/assets/js/174.f48e078a.js"><link rel="prefetch" href="/notebook/assets/js/175.775da6a5.js"><link rel="prefetch" href="/notebook/assets/js/176.9c3c55ea.js"><link rel="prefetch" href="/notebook/assets/js/177.b54d1cff.js"><link rel="prefetch" href="/notebook/assets/js/178.ff08b7f5.js"><link rel="prefetch" href="/notebook/assets/js/179.c6a1af32.js"><link rel="prefetch" href="/notebook/assets/js/18.dcb78196.js"><link rel="prefetch" href="/notebook/assets/js/180.25dd9eba.js"><link rel="prefetch" href="/notebook/assets/js/181.13e6ec84.js"><link rel="prefetch" href="/notebook/assets/js/182.f6849f0d.js"><link rel="prefetch" href="/notebook/assets/js/183.7e664874.js"><link rel="prefetch" href="/notebook/assets/js/184.e6aba86f.js"><link rel="prefetch" href="/notebook/assets/js/185.df07b919.js"><link rel="prefetch" href="/notebook/assets/js/186.02c77e75.js"><link rel="prefetch" href="/notebook/assets/js/187.e8380ed4.js"><link rel="prefetch" href="/notebook/assets/js/188.eddc8bee.js"><link rel="prefetch" href="/notebook/assets/js/189.fbc1840f.js"><link rel="prefetch" href="/notebook/assets/js/19.5997a514.js"><link rel="prefetch" href="/notebook/assets/js/190.a37bfe4c.js"><link rel="prefetch" href="/notebook/assets/js/191.e53a3d4b.js"><link rel="prefetch" href="/notebook/assets/js/192.2f5be408.js"><link rel="prefetch" href="/notebook/assets/js/193.4ca6de49.js"><link rel="prefetch" href="/notebook/assets/js/194.b8e51d9d.js"><link rel="prefetch" href="/notebook/assets/js/195.70e6b23a.js"><link rel="prefetch" href="/notebook/assets/js/196.5d5fbf2d.js"><link rel="prefetch" href="/notebook/assets/js/197.78456dab.js"><link rel="prefetch" href="/notebook/assets/js/198.4308331c.js"><link rel="prefetch" href="/notebook/assets/js/199.2e537849.js"><link rel="prefetch" href="/notebook/assets/js/20.fc057fd7.js"><link rel="prefetch" href="/notebook/assets/js/200.b3309bbf.js"><link rel="prefetch" href="/notebook/assets/js/201.4723461c.js"><link rel="prefetch" href="/notebook/assets/js/202.b15b5177.js"><link rel="prefetch" href="/notebook/assets/js/203.22c50e61.js"><link rel="prefetch" href="/notebook/assets/js/204.5b8b3b00.js"><link rel="prefetch" href="/notebook/assets/js/205.54ee7630.js"><link rel="prefetch" href="/notebook/assets/js/206.f3f20f94.js"><link rel="prefetch" href="/notebook/assets/js/207.a9608973.js"><link rel="prefetch" href="/notebook/assets/js/208.1a80a593.js"><link rel="prefetch" href="/notebook/assets/js/209.586fd293.js"><link rel="prefetch" href="/notebook/assets/js/21.cb4205ee.js"><link rel="prefetch" href="/notebook/assets/js/210.7829dd53.js"><link rel="prefetch" href="/notebook/assets/js/211.3ce139ab.js"><link rel="prefetch" href="/notebook/assets/js/212.84738a64.js"><link rel="prefetch" href="/notebook/assets/js/213.a631830d.js"><link rel="prefetch" href="/notebook/assets/js/214.9d64cf85.js"><link rel="prefetch" href="/notebook/assets/js/215.87030b6b.js"><link rel="prefetch" href="/notebook/assets/js/216.ddbe1944.js"><link rel="prefetch" href="/notebook/assets/js/217.16ae7e40.js"><link rel="prefetch" href="/notebook/assets/js/218.e7780d65.js"><link rel="prefetch" href="/notebook/assets/js/219.abae5e09.js"><link rel="prefetch" href="/notebook/assets/js/22.256014b4.js"><link rel="prefetch" href="/notebook/assets/js/220.8e3a8702.js"><link rel="prefetch" href="/notebook/assets/js/221.4c279d74.js"><link rel="prefetch" href="/notebook/assets/js/222.6c9b2595.js"><link rel="prefetch" href="/notebook/assets/js/223.cc072424.js"><link rel="prefetch" href="/notebook/assets/js/224.c663b40f.js"><link rel="prefetch" href="/notebook/assets/js/225.f3e52654.js"><link rel="prefetch" href="/notebook/assets/js/226.5e00402c.js"><link rel="prefetch" href="/notebook/assets/js/227.1c28ce97.js"><link rel="prefetch" href="/notebook/assets/js/228.42b8c305.js"><link rel="prefetch" href="/notebook/assets/js/229.df9760ec.js"><link rel="prefetch" href="/notebook/assets/js/23.a3d7d66a.js"><link rel="prefetch" href="/notebook/assets/js/230.cfe18f05.js"><link rel="prefetch" href="/notebook/assets/js/231.3a664a46.js"><link rel="prefetch" href="/notebook/assets/js/232.966ce9dc.js"><link rel="prefetch" href="/notebook/assets/js/233.fc06cb57.js"><link rel="prefetch" href="/notebook/assets/js/234.7bb9b7d4.js"><link rel="prefetch" href="/notebook/assets/js/235.b336116e.js"><link rel="prefetch" href="/notebook/assets/js/236.03a38f77.js"><link rel="prefetch" href="/notebook/assets/js/237.0dbda856.js"><link rel="prefetch" href="/notebook/assets/js/238.c1c19749.js"><link rel="prefetch" href="/notebook/assets/js/239.046875c1.js"><link rel="prefetch" href="/notebook/assets/js/24.8e5e267e.js"><link rel="prefetch" href="/notebook/assets/js/240.4bd9cdc0.js"><link rel="prefetch" href="/notebook/assets/js/241.c3dc5804.js"><link rel="prefetch" href="/notebook/assets/js/242.db0b1a91.js"><link rel="prefetch" href="/notebook/assets/js/243.4d9bd61d.js"><link rel="prefetch" href="/notebook/assets/js/244.ee57770b.js"><link rel="prefetch" href="/notebook/assets/js/245.02aab1c1.js"><link rel="prefetch" href="/notebook/assets/js/246.b76a18bb.js"><link rel="prefetch" href="/notebook/assets/js/247.75a673db.js"><link rel="prefetch" href="/notebook/assets/js/248.ad93f81d.js"><link rel="prefetch" href="/notebook/assets/js/249.fb75a938.js"><link rel="prefetch" href="/notebook/assets/js/25.b12f24fe.js"><link rel="prefetch" href="/notebook/assets/js/250.8395c0b6.js"><link rel="prefetch" href="/notebook/assets/js/251.16a6d2a4.js"><link rel="prefetch" href="/notebook/assets/js/252.ef3ee05e.js"><link rel="prefetch" href="/notebook/assets/js/253.78e3471e.js"><link rel="prefetch" href="/notebook/assets/js/254.a5783e07.js"><link rel="prefetch" href="/notebook/assets/js/255.2ab853f6.js"><link rel="prefetch" href="/notebook/assets/js/256.5430831b.js"><link rel="prefetch" href="/notebook/assets/js/257.99c8a0a4.js"><link rel="prefetch" href="/notebook/assets/js/258.4496955b.js"><link rel="prefetch" href="/notebook/assets/js/259.9152b1d2.js"><link rel="prefetch" href="/notebook/assets/js/26.0fce5172.js"><link rel="prefetch" href="/notebook/assets/js/260.072f65e6.js"><link rel="prefetch" href="/notebook/assets/js/261.0bca81af.js"><link rel="prefetch" href="/notebook/assets/js/262.9c9c5337.js"><link rel="prefetch" href="/notebook/assets/js/263.42470957.js"><link rel="prefetch" href="/notebook/assets/js/264.64b5f4fb.js"><link rel="prefetch" href="/notebook/assets/js/265.836a69c5.js"><link rel="prefetch" href="/notebook/assets/js/266.a00cdeb1.js"><link rel="prefetch" href="/notebook/assets/js/267.09dc5ae4.js"><link rel="prefetch" href="/notebook/assets/js/268.6fa6603e.js"><link rel="prefetch" href="/notebook/assets/js/269.3963ce5e.js"><link rel="prefetch" href="/notebook/assets/js/27.47ba3886.js"><link rel="prefetch" href="/notebook/assets/js/270.2826382d.js"><link rel="prefetch" href="/notebook/assets/js/271.3c746c23.js"><link rel="prefetch" href="/notebook/assets/js/272.30698dda.js"><link rel="prefetch" href="/notebook/assets/js/273.b06e3fd2.js"><link rel="prefetch" href="/notebook/assets/js/274.2016c7fa.js"><link rel="prefetch" href="/notebook/assets/js/275.f4aff624.js"><link rel="prefetch" href="/notebook/assets/js/276.e682aa74.js"><link rel="prefetch" href="/notebook/assets/js/277.0c3f41db.js"><link rel="prefetch" href="/notebook/assets/js/278.3c2d5251.js"><link rel="prefetch" href="/notebook/assets/js/279.a9af5703.js"><link rel="prefetch" href="/notebook/assets/js/28.6bac56c6.js"><link rel="prefetch" href="/notebook/assets/js/280.a5da28a3.js"><link rel="prefetch" href="/notebook/assets/js/281.8cc5a3ba.js"><link rel="prefetch" href="/notebook/assets/js/282.55227ff2.js"><link rel="prefetch" href="/notebook/assets/js/283.13f54ae9.js"><link rel="prefetch" href="/notebook/assets/js/284.88644dec.js"><link rel="prefetch" href="/notebook/assets/js/285.0670211f.js"><link rel="prefetch" href="/notebook/assets/js/286.afa43d34.js"><link rel="prefetch" href="/notebook/assets/js/287.9e98e933.js"><link rel="prefetch" href="/notebook/assets/js/288.175a8a9b.js"><link rel="prefetch" href="/notebook/assets/js/289.0d712953.js"><link rel="prefetch" href="/notebook/assets/js/29.3476ca1f.js"><link rel="prefetch" href="/notebook/assets/js/290.4b258761.js"><link rel="prefetch" href="/notebook/assets/js/291.e7ded33e.js"><link rel="prefetch" href="/notebook/assets/js/292.fcfca63e.js"><link rel="prefetch" href="/notebook/assets/js/293.4d6c0f7d.js"><link rel="prefetch" href="/notebook/assets/js/294.59b7e2de.js"><link rel="prefetch" href="/notebook/assets/js/295.0b8dc8f3.js"><link rel="prefetch" href="/notebook/assets/js/296.65434eb0.js"><link rel="prefetch" href="/notebook/assets/js/297.957ba4a7.js"><link rel="prefetch" href="/notebook/assets/js/298.dd81e487.js"><link rel="prefetch" href="/notebook/assets/js/299.eba0d36a.js"><link rel="prefetch" href="/notebook/assets/js/3.a80649d1.js"><link rel="prefetch" href="/notebook/assets/js/30.51a26022.js"><link rel="prefetch" href="/notebook/assets/js/300.23a6a024.js"><link rel="prefetch" href="/notebook/assets/js/301.eb4276c9.js"><link rel="prefetch" href="/notebook/assets/js/302.2c696c44.js"><link rel="prefetch" href="/notebook/assets/js/303.a748a576.js"><link rel="prefetch" href="/notebook/assets/js/304.95020a99.js"><link rel="prefetch" href="/notebook/assets/js/305.c4bc6072.js"><link rel="prefetch" href="/notebook/assets/js/306.74133b05.js"><link rel="prefetch" href="/notebook/assets/js/307.6ea724f3.js"><link rel="prefetch" href="/notebook/assets/js/308.fc7b065c.js"><link rel="prefetch" href="/notebook/assets/js/309.56497801.js"><link rel="prefetch" href="/notebook/assets/js/31.c351e10d.js"><link rel="prefetch" href="/notebook/assets/js/310.692379f9.js"><link rel="prefetch" href="/notebook/assets/js/311.b7393f95.js"><link rel="prefetch" href="/notebook/assets/js/312.f3eec1e1.js"><link rel="prefetch" href="/notebook/assets/js/313.9227351c.js"><link rel="prefetch" href="/notebook/assets/js/314.6960877d.js"><link rel="prefetch" href="/notebook/assets/js/315.f55a1979.js"><link rel="prefetch" href="/notebook/assets/js/316.6121039c.js"><link rel="prefetch" href="/notebook/assets/js/317.7ba118c8.js"><link rel="prefetch" href="/notebook/assets/js/318.2b71444c.js"><link rel="prefetch" href="/notebook/assets/js/319.bc0d5ccf.js"><link rel="prefetch" href="/notebook/assets/js/32.8a802a22.js"><link rel="prefetch" href="/notebook/assets/js/320.79f13ae1.js"><link rel="prefetch" href="/notebook/assets/js/321.21d3b0cf.js"><link rel="prefetch" href="/notebook/assets/js/322.87e4c143.js"><link rel="prefetch" href="/notebook/assets/js/323.4dee2eb7.js"><link rel="prefetch" href="/notebook/assets/js/324.f8c64322.js"><link rel="prefetch" href="/notebook/assets/js/325.c82057d6.js"><link rel="prefetch" href="/notebook/assets/js/326.3ea0d22b.js"><link rel="prefetch" href="/notebook/assets/js/327.90b878d9.js"><link rel="prefetch" href="/notebook/assets/js/328.59e55f0a.js"><link rel="prefetch" href="/notebook/assets/js/329.95fb2ef0.js"><link rel="prefetch" href="/notebook/assets/js/33.18cd7b09.js"><link rel="prefetch" href="/notebook/assets/js/330.ed1fb0e9.js"><link rel="prefetch" href="/notebook/assets/js/331.b84d88a9.js"><link rel="prefetch" href="/notebook/assets/js/332.20dffd14.js"><link rel="prefetch" href="/notebook/assets/js/333.d625fbd2.js"><link rel="prefetch" href="/notebook/assets/js/334.4fedc08a.js"><link rel="prefetch" href="/notebook/assets/js/335.c3b6c886.js"><link rel="prefetch" href="/notebook/assets/js/337.891a7e6c.js"><link rel="prefetch" href="/notebook/assets/js/338.23da071e.js"><link rel="prefetch" href="/notebook/assets/js/339.92d07729.js"><link rel="prefetch" href="/notebook/assets/js/34.f39f39b2.js"><link rel="prefetch" href="/notebook/assets/js/340.09cb4417.js"><link rel="prefetch" href="/notebook/assets/js/341.3591e649.js"><link rel="prefetch" href="/notebook/assets/js/342.568a9320.js"><link rel="prefetch" href="/notebook/assets/js/343.e61b523f.js"><link rel="prefetch" href="/notebook/assets/js/344.61bb135b.js"><link rel="prefetch" href="/notebook/assets/js/345.f861e5aa.js"><link rel="prefetch" href="/notebook/assets/js/346.c5c70e0f.js"><link rel="prefetch" href="/notebook/assets/js/347.9b389847.js"><link rel="prefetch" href="/notebook/assets/js/348.eb62b86e.js"><link rel="prefetch" href="/notebook/assets/js/349.d4852195.js"><link rel="prefetch" href="/notebook/assets/js/35.c31fd7ed.js"><link rel="prefetch" href="/notebook/assets/js/350.f1db6bfd.js"><link rel="prefetch" href="/notebook/assets/js/351.4d86adaf.js"><link rel="prefetch" href="/notebook/assets/js/36.624192b1.js"><link rel="prefetch" href="/notebook/assets/js/37.680f8e12.js"><link rel="prefetch" href="/notebook/assets/js/38.f9ecec66.js"><link rel="prefetch" href="/notebook/assets/js/39.afab4ce6.js"><link rel="prefetch" href="/notebook/assets/js/4.03ba6111.js"><link rel="prefetch" href="/notebook/assets/js/40.f66ecac0.js"><link rel="prefetch" href="/notebook/assets/js/41.87cdca0e.js"><link rel="prefetch" href="/notebook/assets/js/42.08461558.js"><link rel="prefetch" href="/notebook/assets/js/43.ad5cf182.js"><link rel="prefetch" href="/notebook/assets/js/44.0bb6ad3f.js"><link rel="prefetch" href="/notebook/assets/js/45.5d2af6d4.js"><link rel="prefetch" href="/notebook/assets/js/46.8a06257e.js"><link rel="prefetch" href="/notebook/assets/js/47.3e37541c.js"><link rel="prefetch" href="/notebook/assets/js/48.024eda4c.js"><link rel="prefetch" href="/notebook/assets/js/49.a0685cf7.js"><link rel="prefetch" href="/notebook/assets/js/5.1071c8dd.js"><link rel="prefetch" href="/notebook/assets/js/50.130eaac4.js"><link rel="prefetch" href="/notebook/assets/js/51.0fe4dbd0.js"><link rel="prefetch" href="/notebook/assets/js/52.9d0ae64a.js"><link rel="prefetch" href="/notebook/assets/js/53.1ca09933.js"><link rel="prefetch" href="/notebook/assets/js/54.679cd78c.js"><link rel="prefetch" href="/notebook/assets/js/55.95cbe3a2.js"><link rel="prefetch" href="/notebook/assets/js/56.a58ec2af.js"><link rel="prefetch" href="/notebook/assets/js/57.0e59339a.js"><link rel="prefetch" href="/notebook/assets/js/58.487f643f.js"><link rel="prefetch" href="/notebook/assets/js/59.a8e9a1e3.js"><link rel="prefetch" href="/notebook/assets/js/6.707a1f11.js"><link rel="prefetch" href="/notebook/assets/js/60.c3080f7a.js"><link rel="prefetch" href="/notebook/assets/js/61.7f77e449.js"><link rel="prefetch" href="/notebook/assets/js/62.a5528e33.js"><link rel="prefetch" href="/notebook/assets/js/63.a787a8ee.js"><link rel="prefetch" href="/notebook/assets/js/64.7d3edfda.js"><link rel="prefetch" href="/notebook/assets/js/65.80e083e6.js"><link rel="prefetch" href="/notebook/assets/js/66.4076f29c.js"><link rel="prefetch" href="/notebook/assets/js/67.cf46f254.js"><link rel="prefetch" href="/notebook/assets/js/68.6fc8b1fd.js"><link rel="prefetch" href="/notebook/assets/js/69.4a344d72.js"><link rel="prefetch" href="/notebook/assets/js/7.c507c0e3.js"><link rel="prefetch" href="/notebook/assets/js/70.b13eef1a.js"><link rel="prefetch" href="/notebook/assets/js/71.20ad9776.js"><link rel="prefetch" href="/notebook/assets/js/72.30f44ef6.js"><link rel="prefetch" href="/notebook/assets/js/73.857a629d.js"><link rel="prefetch" href="/notebook/assets/js/74.a2b5a703.js"><link rel="prefetch" href="/notebook/assets/js/75.252e6fc0.js"><link rel="prefetch" href="/notebook/assets/js/76.d64e4a53.js"><link rel="prefetch" href="/notebook/assets/js/77.40db9cc6.js"><link rel="prefetch" href="/notebook/assets/js/78.7a635d12.js"><link rel="prefetch" href="/notebook/assets/js/79.b2249421.js"><link rel="prefetch" href="/notebook/assets/js/8.a5f34392.js"><link rel="prefetch" href="/notebook/assets/js/80.d325f684.js"><link rel="prefetch" href="/notebook/assets/js/81.2e8d667e.js"><link rel="prefetch" href="/notebook/assets/js/82.885af8d1.js"><link rel="prefetch" href="/notebook/assets/js/83.b601bf2e.js"><link rel="prefetch" href="/notebook/assets/js/84.758d5dba.js"><link rel="prefetch" href="/notebook/assets/js/85.2e75fb85.js"><link rel="prefetch" href="/notebook/assets/js/86.6c68d815.js"><link rel="prefetch" href="/notebook/assets/js/87.8fba1553.js"><link rel="prefetch" href="/notebook/assets/js/88.e30608d9.js"><link rel="prefetch" href="/notebook/assets/js/89.be2f87c8.js"><link rel="prefetch" href="/notebook/assets/js/9.1c775f56.js"><link rel="prefetch" href="/notebook/assets/js/90.88dd69c4.js"><link rel="prefetch" href="/notebook/assets/js/91.59a69041.js"><link rel="prefetch" href="/notebook/assets/js/92.b46ca339.js"><link rel="prefetch" href="/notebook/assets/js/93.aeaec51d.js"><link rel="prefetch" href="/notebook/assets/js/94.5a852633.js"><link rel="prefetch" href="/notebook/assets/js/95.4f445663.js"><link rel="prefetch" href="/notebook/assets/js/96.6299f802.js"><link rel="prefetch" href="/notebook/assets/js/97.6cf3ba23.js"><link rel="prefetch" href="/notebook/assets/js/98.b48d73e6.js"><link rel="prefetch" href="/notebook/assets/js/99.f61a2e23.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.1b58b254.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/img/logo.png" alt="notebook" class="logo"> <span class="site-name can-hide">notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/notebook/computer-system/" class="nav-link">计算机系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-structure/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/notebook/major/" class="nav-link">计算机专业课</a></li><li class="dropdown-item"><!----> <a href="/notebook/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><!----> <span class="title" style="display:;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yubincloud.github.io/notebook-front/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/notebook/java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/" class="nav-link">Python 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/golang/" class="nav-link">Golang 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notebook/software-architecture/" class="nav-link">软件设计与架构</a></li><li class="dropdown-item"><!----> <a href="/notebook/distributed-system/" class="nav-link">大数据与分布式系统</a></li><li class="dropdown-item"><h4>常见开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据科学" class="dropdown-title"><!----> <span class="title" style="display:;">数据科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/data-science/spider/" class="nav-link">爬虫</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-science/py-data-analysis/" class="nav-link">Python 数据分析</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-warehouse/" class="nav-link">数据仓库</a></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/notebook/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notebook/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-subitem"><a href="/notebook/kafka/" class="nav-link">Kafka</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><!----> <span class="title" style="display:;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/deep-learning/" class="nav-link">深度学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/machine-learning/" class="nav-link">机器学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/kg/" class="nav-link">知识图谱</a></li><li class="dropdown-item"><!----> <a href="/notebook/gnn/" class="nav-link">图神经网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><!----> <span class="title" style="display:;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/security/application-security/" class="nav-link">应用安全</a></li><li class="dropdown-item"><!----> <a href="/notebook/security/penetration/" class="nav-link">渗透测试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/cloud-native/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><a href="/notebook/pages/interview/index/" class="nav-link">面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><!----> <span class="title" style="display:;">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/pages/my/favorite/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/notebook/pages/my/good-sentence/" class="nav-link">paper 好句</a></li></ul></div></div> <a href="https://github.com/yubincloud/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/head.jpg"> <div class="blogger-info"><h3>学习笔记</h3> <span>啦啦啦，向太阳~</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/notebook/computer-system/" class="nav-link">计算机系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-structure/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/notebook/major/" class="nav-link">计算机专业课</a></li><li class="dropdown-item"><!----> <a href="/notebook/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><!----> <span class="title" style="display:;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yubincloud.github.io/notebook-front/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/notebook/java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/" class="nav-link">Python 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/golang/" class="nav-link">Golang 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notebook/software-architecture/" class="nav-link">软件设计与架构</a></li><li class="dropdown-item"><!----> <a href="/notebook/distributed-system/" class="nav-link">大数据与分布式系统</a></li><li class="dropdown-item"><h4>常见开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据科学" class="dropdown-title"><!----> <span class="title" style="display:;">数据科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/data-science/spider/" class="nav-link">爬虫</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-science/py-data-analysis/" class="nav-link">Python 数据分析</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-warehouse/" class="nav-link">数据仓库</a></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/notebook/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notebook/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-subitem"><a href="/notebook/kafka/" class="nav-link">Kafka</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><!----> <span class="title" style="display:;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/deep-learning/" class="nav-link">深度学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/machine-learning/" class="nav-link">机器学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/kg/" class="nav-link">知识图谱</a></li><li class="dropdown-item"><!----> <a href="/notebook/gnn/" class="nav-link">图神经网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><!----> <span class="title" style="display:;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/security/application-security/" class="nav-link">应用安全</a></li><li class="dropdown-item"><!----> <a href="/notebook/security/penetration/" class="nav-link">渗透测试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/cloud-native/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><a href="/notebook/pages/interview/index/" class="nav-link">面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><!----> <span class="title" style="display:;">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/pages/my/favorite/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/notebook/pages/my/good-sentence/" class="nav-link">paper 好句</a></li></ul></div></div> <a href="https://github.com/yubincloud/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>云原生</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>专栏-深入容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Kubernetes入门实战课-罗剑锋</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/cloud-native/k8s-practice/container-start/" class="sidebar-link">初识容器</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/k8s-install/" class="sidebar-link">Kubernetes 的安装与基本架构</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/" aria-current="page" class="active sidebar-link">YAML、Pod、Job、CronJob、ConfigMap、Secret</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-yaml-kubernetes-世界里的通用语" class="sidebar-link">1. YAML：Kubernetes 世界里的通用语</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-1-声明式与命令式" class="sidebar-link">1.1 声明式与命令式</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-2-什么是-yaml" class="sidebar-link">1.2 什么是 YAML</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-3-什么是-api-对象" class="sidebar-link">1.3 什么是 API 对象</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-4-如何描述-api-对象" class="sidebar-link">1.4 如何描述 API 对象</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-5-如何编写-yaml" class="sidebar-link">1.5 如何编写 YAML</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_1-6-课外小贴士" class="sidebar-link">1.6 课外小贴士</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-pod-kubernetes-里最核心的概念" class="sidebar-link">2. Pod：Kubernetes 里最核心的概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-1-为什么要有-pod" class="sidebar-link">2.1 为什么要有 Pod？</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-2-为什么-pod-是-kubernetes-的核心对象" class="sidebar-link">2.2 为什么 Pod 是 Kubernetes 的核心对象</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-3-如何使用-yaml-描述-pod" class="sidebar-link">2.3 如何使用 YAML 描述 Pod？</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-4-如何使用-kubectl-来操作-pod" class="sidebar-link">2.4 如何使用 kubectl 来操作 Pod</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_2-5-小结" class="sidebar-link">2.5 小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-job-cronjob-为什么不直接用-pod-来处理业务" class="sidebar-link">3. Job/CronJob：为什么不直接用 Pod 来处理业务？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-1-为什么不直接使用-pod" class="sidebar-link">3.1 为什么不直接使用 Pod</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-2-为什么要有-job-cronjob" class="sidebar-link">3.2 为什么要有 Job/CronJob</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-3-job" class="sidebar-link">3.3 Job</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-4-cronjob" class="sidebar-link">3.4 CronJob</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_3-5-小结" class="sidebar-link">3.5 小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_4-configmap-secret-怎样配置、定制我的应用" class="sidebar-link">4. ConfigMap/Secret：怎样配置、定制我的应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_4-1-configmap" class="sidebar-link">4.1 ConfigMap</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_4-2-secret" class="sidebar-link">4.2 Secret</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_4-3-使用-configmap-secret" class="sidebar-link">4.3 使用 ConfigMap/Secret</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/#_4-4-小结" class="sidebar-link">4.4 小结</a></li></ul></li></ul></li><li><a href="/notebook/pages/cloud-native/k8s-practice/deployment-and-other/" class="sidebar-link">Deployment、Daemonset、Service、Ingress</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/persistentvolume-and-other/" class="sidebar-link">PV、PVC、StorageClass、Provisioner、StatefulSet</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/" class="sidebar-link">滚动更新、应用保障、集群管理</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/metricssever-and-other/" class="sidebar-link">MetricsServer、Prometheus、CNI</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>深入剖析 Kubernetes-张磊</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/notebook/categories/?category=%E8%BF%90%E7%BB%B4" title="分类" data-v-06225672>运维</a></li><li data-v-06225672><a href="/notebook/categories/?category=%E4%BA%91%E5%8E%9F%E7%94%9F" title="分类" data-v-06225672>云原生</a></li><li data-v-06225672><a href="/notebook/categories/?category=Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B" title="分类" data-v-06225672>Kubernetes入门实战课-罗剑锋</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/yubincloud" target="_blank" title="作者" class="beLink" data-v-06225672>yubin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-04-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">YAML、Pod、Job、CronJob、ConfigMap、Secret<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><blockquote><p>参考：<a href="https://time.geekbang.org/column/intro/100114501?tab=catalog" target="_blank" rel="noopener noreferrer">Kubernetes 入门实战课 | 极客时间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 第 11-16 讲</p></blockquote> <h2 id="_1-yaml-kubernetes-世界里的通用语"><a href="#_1-yaml-kubernetes-世界里的通用语" class="header-anchor">#</a> 1. YAML：Kubernetes 世界里的通用语</h2> <h3 id="_1-1-声明式与命令式"><a href="#_1-1-声明式与命令式" class="header-anchor">#</a> 1.1 声明式与命令式</h3> <p>Dockerfile 属于<strong>命令式</strong>（imperative），告诉了计算机每步怎么做，而 Kubernetes 的 YAML 属于<strong>声明式</strong>（declarative），它告诉了计算机一个目标状态，并让计算机想办法去完成任务。</p> <h3 id="_1-2-什么是-yaml"><a href="#_1-2-什么是-yaml" class="header-anchor">#</a> 1.2 什么是 YAML</h3> <p>YAML 是 JSON 的超集，即任何合法的 JSON 文档也都是 YAML 文档。但 YAML 语法更简单紧凑：</p> <ul><li>使用空白与缩进表示层次（有点类似Python），可以不使用花括号和方括号。</li> <li>可以使用 <code>#</code> 书写注释，比起JSON是很大的改进。</li> <li>对象（字典）的格式与JSON基本相同，但Key不需要使用双引号。</li> <li>数组（列表）是使用 <code>-</code> 开头的清单形式（有点类似MarkDown）。</li> <li>表示对象的 <code>:</code> 和表示数组的 <code>-</code> 后面都必须要有空格。</li> <li>可以使用 <code>---</code> 在一个文件里分隔多个YAML对象。</li></ul> <p>关于 YAML 的知识整理如下图：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230422215537.png" alt="20230422215537" style="zoom:75%;"></center> <h3 id="_1-3-什么是-api-对象"><a href="#_1-3-什么是-api-对象" class="header-anchor">#</a> 1.3 什么是 API 对象</h3> <p>我们需要在 YAML 中声明哪些东西呢？Kubernetes 在理论层面抽象出了很多个概念用来描述系统的管理运维工作，这些概念就叫做 <mark>API 对象</mark>，之前提到的组件 apiserver 的名字也是来源于它。</p> <blockquote><p>因为apiserver是Kubernetes系统的唯一入口，外部用户和内部组件都必须和它通信，而它采用了HTTP协议的URL资源理念，API风格也用RESTful的GET/POST/DELETE等等，所以，这些概念很自然地就被称为是“API对象”了。</p></blockquote> <p>有哪些 API 对象呢？可以使用命令 <code>kubectl api-resources</code> 查看当前 k8s 支持的所有对象：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230422215922.png" alt="20230422215922" style="zoom:75%;"></center> <p>在输出的“NAME”一栏，就是对象的名字，比如ConfigMap、Pod、Service等等，第二栏“SHORTNAMES”则是这种资源的简写，在我们使用kubectl命令的时候很有用，可以少敲几次键盘，比如Pod可以简写成po，Service可以简写成svc。</p> <p>在使用kubectl命令的时候，你还可以加上一个参数 <code>--v=9</code>，它会显示出详细的命令执行过程，清楚地看到发出的HTTP请求，比如：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230422220054.png" alt="20230422220054" style="zoom:75%;"></center> <p>从截图里可以看到，<strong>kubectl 客户端等价于调用了 curl</strong>，向 8443 端口发送了 HTTP GET 请求，URL 是 <code>/api/v1/namespaces/default/pods</code>。</p> <p>目前的Kubernetes 1.23版本有50多种API对象，全面地描述了集群的节点、应用、配置、服务、账号等等信息，apiserver会把它们都存储在数据库etcd里，然后kubelet、scheduler、controller-manager等组件通过apiserver来操作它们，就在API对象这个抽象层次实现了对整个集群的管理。</p> <h3 id="_1-4-如何描述-api-对象"><a href="#_1-4-如何描述-api-对象" class="header-anchor">#</a> 1.4 如何描述 API 对象</h3> <p>之前我们使用 kubectl 运行 nginx 的命令用的是命令式的 <code>kubectl run</code>：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl run ngx --image<span class="token operator">=</span>nginx:alpine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面看一下如何以 YAML 语言来声明式地在 k8s 中描述并创建 API 对象。在 YAML 中，我们需要说清楚我们的目标状态，让 Kubernetes 自己去决定如何拉取镜像并运行：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>pod
  labels<span class="token punctuation">:</span>
    env<span class="token punctuation">:</span> demo
    owner<span class="token punctuation">:</span> chrono

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx
    ports<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>可以看出，这里是创建一个 pod，要使用 nginx:alpine 的 image 来创建一个 container，并开放 80 端口，而其他部分就是 k8s 对 API 对象强制的格式要求了。</p> <p>因为API对象采用标准的 HTTP 协议，为了方便理解，我们可以借鉴一下 HTTP 的报文格式，把 API 对象的描述分成“header”和“body”两部分。</p> <p>header 包含的是 API 对象的基本信息，有三个字段：</p> <ul><li><strong>apiVersion</strong>：表示操作这种资源的 API 版本号，由于 Kubernetes 的迭代速度很快，不同的版本创建的对象会有差异，为了区分这些版本就需要使用 apiVersion 这个字段，比如 v1、v1alpha1、v1beta1 等等。</li> <li><strong>kind</strong>：表示资源对象的类型，比如 Pod、Node、Job、Service 等。</li> <li><strong>metadata</strong>：表示的是资源的一些元信息，也就是用来标记对象，方便 Kubernetes 管理的一些信息。在上面的示例中有两个元信息：
<ul><li>name：给 pod 起了个名字</li> <li>labels：给 pod 贴上一些便于查找的标签，分别是 <code>env</code> 和 <code>owner</code>。</li></ul></li></ul> <p>以上信息都被 kubectl 用于生成 HTTP 请求发给 apiserver，你可以用 <code>--v=9</code> 参数在请求的 URL 里看到它们，比如：</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>https://192.168.49.2:8443/api/v1/namespaces/default/pods/ngx-pod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>header 中的 apiVersion、kind、metadata 这三个字段都是任何对象都必须有的</strong>，而 body 部分则会与对象特定相关，每种对象会有不同的规格定义，在 YAML 里就表现为 <code>spec</code> 字段（即 specification），表示我们对对象的“期望状态”（desired status）。</p> <p>还是来看这个 Pod，它的 spec 里就是一个 <code>containers</code> 数组，里面的每个元素又是一个对象，指定了名字、镜像、端口等信息：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx
    ports<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>现在把这些字段综合起来，我们就能够看出，这份 YAML 文档完整地描述了一个类型是 Pod 的 API 对象，要求使用 v1 版本的 API 接口去管理，其他更具体的名称、标签、状态等细节都记录在了 metadata 和 spec 字段等里。</p> <p>使用 <code>kubectl apply</code>、 <code>kubectl delete</code>，再加上参数 <code>-f</code>，你就可以使用这个 YAML 文件，创建或者删除对象了：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f ngx-pod.yml    <span class="token comment"># 创建 API 对象</span>
kubectl delete -f ngx-pod.yml   <span class="token comment"># 删除 API 对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Kubernetes 收到这份“声明式”的数据，再根据 HTTP 请求里的 POST/DELETE 等方法，就会自动操作这个资源对象，至于对象在哪个节点上、怎么创建、怎么删除完全不用我们操心。</p> <h3 id="_1-5-如何编写-yaml"><a href="#_1-5-如何编写-yaml" class="header-anchor">#</a> 1.5 如何编写 YAML</h3> <p>这么多字段，我们怎样才能编写正确的 YAML 呢？</p> <p>这个问题的最权威的答案自然是 k8s 的<a href="https://kubernetes.io/docs/reference/kubernetes-api/" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，API 对象的所有字段都可以在里面找到。但这内容太多，下面介绍一些实用的小技巧。</p> <p><strong>第一个技巧</strong>其实前面已经说过了，就是 <code>kubectl api-resources</code> 命令，它会显示出资源对象相应的API版本和类型，比如Pod的版本是“v1”，Ingress的版本是“networking.k8s.io/v1”，照着它写绝对不会错。</p> <p><strong>第二个技巧</strong>，是命令 <code>kubectl explain</code>，它相当于是Kubernetes自带的API文档，会给出对象字段的详细说明，这样我们就不必去网上查找了。比如想要看Pod里的字段该怎么写，就可以这样：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl explain pod
kubectl explain pod.metadata
kubectl explain pod.spec
kubectl explain pod.spec.containers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用前两个技巧编写 YAML 就基本上没有难度了。</p> <p>⭐️ <strong>第三个技巧</strong>就是kubectl的两个特殊参数 <code>--dry-run=client</code> 和 <code>-o yaml</code>，前者是空运行，后者是生成YAML格式，<strong>结合起来使用就会让 kubectl 不会有实际的创建动作，而只生成 YAML 文件</strong>。例如，想要生成一个Pod的YAML样板示例，可以在 <code>kubectl run</code> 后面加上这两个参数：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl run ngx --image<span class="token operator">=</span>nginx:alpine --dry-run<span class="token operator">=</span>client -o yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就会生成一个绝对正确的 YAML 文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  creationTimestamp<span class="token punctuation">:</span> <span class="token null important">null</span>
  labels<span class="token punctuation">:</span>
    run<span class="token punctuation">:</span> ngx
  name<span class="token punctuation">:</span> ngx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx
    resources<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  dnsPolicy<span class="token punctuation">:</span> ClusterFirst
  restartPolicy<span class="token punctuation">:</span> Always
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>接下来你要做的，就是查阅对象的说明文档，添加或者删除字段来定制这个 YAML 了。</p> <p>这个小技巧还可以再进化一下，把这段参数定义成Shell变量（名字任意，比如<code>$do</code>/<code>$go</code>，这里用的是 <code>$out</code>），用起来会更省事，比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">out</span><span class="token operator">=</span><span class="token string">&quot;--dry-run=client -o yaml&quot;</span>
kubectl run ngx --image<span class="token operator">=</span>nginx:alpine <span class="token variable">$out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>今后除了一些特殊情况，我们都不会再使用 <code>kubectl run</code> 这样的命令去直接创建 Pod，而是会编写 YAML，用“声明式”来描述对象，再用 <code>kubectl apply</code> 去发布 YAML 来创建对象。</p> <h3 id="_1-6-课外小贴士"><a href="#_1-6-课外小贴士" class="header-anchor">#</a> 1.6 课外小贴士</h3> <ul><li>Kubernetes 的 AP 版本命名有明确规范，正式版本(GA，Generally available) 是 v1 这样的纯数字，试验性质、不稳定的是 alpha,比较稳定、即将发布的是 beta。</li> <li>因为 Kubernetes 的开发语言是 Go，所以 API 对象字段用的都是 Go 语法规范，例如字段命名遵循“Camel Case”，类型是 boolean、string、[]Object 等。</li></ul> <h2 id="_2-pod-kubernetes-里最核心的概念"><a href="#_2-pod-kubernetes-里最核心的概念" class="header-anchor">#</a> 2. Pod：Kubernetes 里最核心的概念</h2> <p>为什么 Kubernetes 不直接使用 container，而是还是再抽象出一个 Pod 对象？</p> <h3 id="_2-1-为什么要有-pod"><a href="#_2-1-为什么要有-pod" class="header-anchor">#</a> 2.1 为什么要有 Pod？</h3> <p>Pod 原意是“豌豆荚”，看一下下面这个图片，每一颗豌豆就像一个容器，Pod 就是包含了很多成员的一种结构：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230422224207.png" alt="20230422224207" style="zoom:55%;"></center> <p>容器让进程运行在一个沙盒环境里，但当进入生产环境时，这种隔离性带来了不少麻烦，因为大多数任务都是需要多个进程相互协作来完成。而容器的理念又希望每个 container 里只运行一个进程。为了解决这样多应用联合运行的问题，同时还要不破坏容器的隔离，就需要在容器外面再建立一个“收纳舱”，这就是 Pod 概念的提出。容器正是“豆荚”里那些小小的“豌豆”，你可以在Pod的YAML里看到，“spec.containers”字段其实是一个数组，里面允许定义多个容器。</p> <h3 id="_2-2-为什么-pod-是-kubernetes-的核心对象"><a href="#_2-2-为什么-pod-是-kubernetes-的核心对象" class="header-anchor">#</a> 2.2 为什么 Pod 是 Kubernetes 的核心对象</h3> <p>Pod 是对容器的打包，里面的容器是一个整体，总是能够一起调度、一起运行，绝不会出现分离的情况。Kubernetes 让 Pod 去编排处理容器，并<strong>把 Pod 作为应用调度部署的最小单位</strong>，因此它也成了 Kubernetes 世界里的“原子”，基于 Pod 就可以构建出更多更复杂的业务形态了。</p> <p>下面的这张图显示了从 Pod 开始，扩展出了Kubernetes里的一些重要API对象，比如配置信息ConfigMap、离线作业Job、多实例部署Deployment等等，它们都分别对应到现实中的各种实际运维需求：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423193402.png" alt="20230423193402" style="zoom:75%;"></center> <blockquote><p>尽管这张图很经典，但随着 Kubernetes 的多年发展，它已经不能全面描述 Kubernetes 的资源对象了。</p></blockquote> <p>基于此，我（专栏作者）又重画了一份以 Pod 为中心的 Kubernetes 资源对象关系图，下面的介绍将基于此图来探索各项功能。</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423193615.png" alt="20230423193615" style="zoom:75%;"></center> <p>由此可以看出，Kubernetes 的资源都直接或间接地依附在 Pod 之上，所有的 Kubernetes 功能都必须通过 Pod 来实现，所以 Pod 理所当然地成为了 Kubernetes 的核心对象。</p> <h3 id="_2-3-如何使用-yaml-描述-pod"><a href="#_2-3-如何使用-yaml-描述-pod" class="header-anchor">#</a> 2.3 如何使用 YAML 描述 Pod？</h3> <p>这里只介绍一些 YAML 中的常用字段，详细说明可以通过 <code>kubectl explain</code> 来查看。</p> <p>因为 Pod 也是 API 对象，所以也必然具有 apiVersion、kind、metadata 和 spec 四个基本组成部分：</p> <ul><li><strong>apiVersion</strong>：固定 <code>v1</code></li> <li><strong>kind</strong>：固定 <code>Pod</code></li> <li><strong>metadata</strong>：一般由 name 和 labels 两个字段
<ul><li>name：给 Pod 起一个名字（必须），本课程为了与其他资源区分，Pod 的名字均加了一个 -pod 后缀。</li> <li>labels：可以添加任意数量的 key-value，给 Pod 贴上归类的标签，结合 name 就更方便识别和管理了。</li></ul></li></ul> <blockquote><p>在 labels 中，我们可以根据运行环境，使用 label <code>env=dev/test/prod</code>，根据所在的数据中心，使用 label <code>region=north/south</code>，根据应用在系统中的层次，使用 <code>tier=front/middle/back</code> 等待。</p></blockquote> <p>下面这段 YAML 就描述了一个简单的 Pod：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> busy<span class="token punctuation">-</span>pod
  labels<span class="token punctuation">:</span>
    owner<span class="token punctuation">:</span> chrono
    env<span class="token punctuation">:</span> demo
    region<span class="token punctuation">:</span> north
    tier<span class="token punctuation">:</span> back
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>spec 字段</strong>由于需要管理、维护 Pod 这 Kubernetes 的基本调度单元，里面有非常多的关键信息，今天只介绍最重要的 containers 字段部分，其余的 hostname、restartPolicy 等字段可以查阅相关文档。</p> <p>“containers”是一个数组，里面的每一个元素又是一个 container 对象，也就是容器。</p> <p><strong>一个 container 对象必须也要有个 name 表示名字，有个 image 表示使用的镜像</strong>，这两个是必须要有的，其余的字段与 docker 的差不多了：</p> <ul><li>ports：列出容器对外暴露的端口，和Docker的 <code>-p</code> 参数有点像。</li> <li>imagePullPolicy：指定镜像的拉取策略，可以是Always/Never/IfNotPresent，一般默认是IfNotPresent，也就是说只有本地不存在才会远程拉取镜像，可以减少网络消耗。</li> <li>env：定义Pod的环境变量，和Dockerfile里的 <code>ENV</code> 指令有点类似，但它是运行时指定的，更加灵活可配置。</li> <li>command：定义容器启动时要执行的命令，相当于Dockerfile里的 <code>ENTRYPOINT</code> 指令。</li> <li>args：它是command运行时的参数，相当于Dockerfile里的 <code>CMD</code> 指令，这两个命令和Docker的含义不同，要特别注意。</li></ul> <p>下面是 busy-pod 的 spec 部分：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span>latest
    name<span class="token punctuation">:</span> busy
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    env<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> os
        value<span class="token punctuation">:</span> <span class="token string">&quot;ubuntu&quot;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> debug
        value<span class="token punctuation">:</span> <span class="token string">&quot;on&quot;</span>
    command<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /bin/echo
    args<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;$(os), $(debug)&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里我为Pod指定使用镜像busybox:latest，拉取策略是 <code>IfNotPresent</code> ，然后定义了 <code>os</code> 和 <code>debug</code> 两个环境变量，启动命令是 <code>/bin/echo</code>，参数里输出刚才定义的环境变量。</p> <p>可以看到这份 YAML 文件把容器的运行状态描述地很清晰，比 docker run 的命令行要清晰地多。</p> <h3 id="_2-4-如何使用-kubectl-来操作-pod"><a href="#_2-4-如何使用-kubectl-来操作-pod" class="header-anchor">#</a> 2.4 如何使用 kubectl 来操作 Pod</h3> <ul><li>指定 YAML 文件来创建 Pod：<code>kubectl apply -f busy-pod.yml</code></li> <li>指定 YAML 文件来删除 Pod：<code>kubectl delete -f busy-pod.yml</code></li> <li>根据 Pod 的 name 来删除：<code>kubectl delete pod busy-pod</code></li></ul> <p>由于 Kubernetes 的 Pod 不会在前台运行，只能后台运行，如果想看日志，可以使用命令 <code>kubectl logs &lt;pod-name&gt;</code>。</p> <ul><li>查看 Pod 列表和运行状态：<code>kubectl get pod</code></li> <li>查看某个 Pod 的详细状态（用于调试排错）：<code>kubectl describe pod busy-pod</code></li></ul> <p>在使用 kubectl describe 时，通常只需要关注末尾的 “Events” 部分，它显示的是Pod运行过程中的一些关键节点事件：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423201704.png" alt="20230423201704" style="zoom:75%;"></center> <p>kubectl 也提供了类似 docker 的 cp 与 exec 命令：</p> <ul><li><code>kubectl cp</code>：把本地文件拷贝进 Pod</li> <li><code>kubectl exec</code>：进入 Pod 内部执行 shell 命令，用法也差不多</li></ul> <details class="custom-block details"><summary>cp 与 exec 的使用示例</summary> <p>比如我有一个“a.txt”文件，那么就可以使用 <code>kubectl cp</code> 拷贝进Pod的“/tmp”目录里：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">'aaa'</span> <span class="token operator">&gt;</span> a.txt
kubectl <span class="token function">cp</span> a.txt ngx-pod:/tmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>不过 <code>kubectl exec</code> 的命令格式与Docker有一点小差异，需要在Pod后面加上 <code>--</code>，把kubectl的命令与Shell命令分隔开，你在用的时候需要小心一些：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it ngx-pod -- <span class="token function">sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></details> <p>准确地说，kubectl cp 和 kubectl exec 操作的应该是 Pod 里的容器，需要用“-c”参数指定容器名，不过<strong>因为大多数 Pod 里只有一个容器</strong>，所以就省略了。</p> <h3 id="_2-5-小结"><a href="#_2-5-小结" class="header-anchor">#</a> 2.5 小结</h3> <p>相比于 container 的“细粒度”，VM 的”粗粒度“，Pod 可以说是”中粒度“，灵活又轻便，非常适合在云计算领域作为应用调度的基本单元。</p> <p>虽然 Pod 是 Kubernetes 的核心概念，非常重要，但事实上在 Kubernetes 里通常并不会直接创建 Pod，因为它只是对容器做了简单的包装，比较脆弱，离复杂的业务需求还有些距离，需要 Job、CronJob、Deployment 等其他对象增添更多的功能才能投入生产使用。</p> <p>课外小贴士：</p> <ul><li>Pod 内部有一个名为 infra 的容器，它实际上代表了Pod，维护着 Pod 内多容器共享的主机名、网络和存储。infra 容器的镜像叫“pause”，非常小，只有不到 500KB。</li> <li>对于确实不需要重启的 Pod，可以配置字段 “re-startPolicy: Never“</li> <li>准确地说，“kubectl cp”“kubectl exec”操作的应该是 Pod 里的容器，需要用“-c”参数指定容器名，不过因为大多数 Pod 里只有一个容器，所以就省略了。</li></ul> <h2 id="_3-job-cronjob-为什么不直接用-pod-来处理业务"><a href="#_3-job-cronjob-为什么不直接用-pod-来处理业务" class="header-anchor">#</a> 3. Job/CronJob：为什么不直接用 Pod 来处理业务？</h2> <h3 id="_3-1-为什么不直接使用-pod"><a href="#_3-1-为什么不直接使用-pod" class="header-anchor">#</a> 3.1 为什么不直接使用 Pod</h3> <p>现在你应该知道，Kubernetes 使用的是 RESTful API，把集群中的各种业务都抽象为 HTTP 资源对象，那么在这个层次之上，我们就可以使用面向对象的方式来考虑问题。</p> <p>虽然面向对象的设计思想多用于软件开发，但它放到Kubernetes里却意外地合适。<strong>因为Kubernetes使用YAML来描述资源，把业务简化成了一个个的对象，内部有属性，外部有联系，也需要互相协作</strong>，只不过我们不需要编程，完全由Kubernetes自动处理。</p> <p>面向对象的设计有许多基本原则，其中有两条我认为比较恰当地描述了Kubernetes对象设计思路，一个是<strong>单一职责</strong>，另一个是<strong>组合优于继承</strong>：</p> <ul><li>单一职责：对象应该只专注于做好一件事情，不要贪大求全，保持足够小的粒度才更方便复用和管理。</li> <li>组合优于继承：尽量让对象在运行时产生联系，保持松耦合，而不要用硬编码的方式固定对象的关系。</li></ul> <p>应用这两条原则，我们再来看Kubernetes的资源对象就会很清晰了。因为Pod已经是一个相对完善的对象，专门负责管理容器，那么我们就不应该再“画蛇添足”地盲目为它扩充功能，而是要保持它的独立性，容器之外的功能就需要定义其他的对象，把Pod作为它的一个成员“组合”进去。</p> <p>这样每种Kubernetes对象就可以只关注自己的业务领域，只做自己最擅长的事情，其他的工作交给其他对象来处理，既不“缺位”也不“越位”，既有分工又有协作，从而以最小成本实现最大收益。</p> <h3 id="_3-2-为什么要有-job-cronjob"><a href="#_3-2-为什么要有-job-cronjob" class="header-anchor">#</a> 3.2 为什么要有 Job/CronJob</h3> <p>现在学习两个新对象：Job 和 CronJob，他们组合了 Pod，实现了对离线业务的处理。</p> <p>Kubernetes 里有两大类业务：</p> <ul><li><strong>在线业务</strong>：像 Nginx、MySQL 一样，一旦运行基本不会停止</li> <li><strong>离线业务</strong>：比如日志分析、视频转码等任务，虽然具有一些计算量，但也只会运行一段时间，必定会退出。所以它的调度策略也就与“在线业务”存在很大的不同，需要考虑运行超时、状态检查、失败重试、获取计算结果等管理事项。</li></ul> <p>离线业务也可以分为两种，一种是<strong>临时任务</strong>，跑完就完事了；一种是<strong>定时任务</strong>，可以按时按点周期运行，不需要过多干预。</p> <p>在 Kubernetes 中，临时任务就是 API 对象 <strong>Job</strong>，定时任务就是 API 对象 <strong>CronJob</strong>，使用这两个对象你就能够在 Kubernetes 里调度管理任意的离线业务了。</p> <h3 id="_3-3-job"><a href="#_3-3-job" class="header-anchor">#</a> 3.3 Job</h3> <h4 id="_3-3-1-如何使用-yaml-描述-job"><a href="#_3-3-1-如何使用-yaml-描述-job" class="header-anchor">#</a> 3.3.1 如何使用 YAML 描述 Job？</h4> <p>Job 的 YAML 开头部分还是那几个必备字段：</p> <ul><li>apiVersion不是 <code>v1</code>，而是 <code>batch/v1</code>。</li> <li>kind是 <code>Job</code>，这个和对象的名字是一致的。</li> <li>metadata里仍然要有 <code>name</code> 标记名字，也可以用 <code>labels</code> 添加任意的标签。</li></ul> <blockquote><p>注意如果想生成 YAML 模板，就不能使用 kubectl run 了，因为它只能创建 Pod，想要创建 Pod 以外的其他对象的话，可以使用命令 <code>kubectl create &lt;对象名&gt;</code></p></blockquote> <p>比如用 busybox 创建一个“echo-job”，命令就是这样的：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">out</span><span class="token operator">=</span><span class="token string">&quot;--dry-run=client -o yaml&quot;</span>              <span class="token comment"># 定义Shell变量</span>
kubectl create job echo-job --image<span class="token operator">=</span>busybox <span class="token variable">$out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>会生成一个基本的YAML文件，保存之后做点修改，就有了一个Job对象：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> echo<span class="token punctuation">-</span>job

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  template<span class="token punctuation">:</span>
    spec<span class="token punctuation">:</span>
      restartPolicy<span class="token punctuation">:</span> OnFailure
      containers<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        name<span class="token punctuation">:</span> echo<span class="token punctuation">-</span>job
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        command<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/echo&quot;</span><span class="token punctuation">]</span>
        args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>你会注意到Job的描述与Pod很像，但又有些不一样，主要的区别就在“spec”字段里，<strong>多了一个 <code>template</code> 字段</strong>，然后又是一个“spec”，显得有点怪。</p> <p>如果你理解了刚才说的面向对象设计思想，就会明白这种做法的道理。它其实就是在Job对象里应用了组合模式， <code>template</code> 字段定义了一个“ <strong>应用模板</strong>”，里面嵌入了一个Pod，这样Job就可以从这个模板来创建出Pod。</p> <p>而这个Pod因为受Job的管理控制，不直接和apiserver打交道，也就没必要重复apiVersion等“头字段”，只需要定义好关键的 <code>spec</code>，描述清楚容器相关的信息就可以了，可以说是一个“无头”的Pod对象。</p> <p>为了辅助你理解，我把 Job 对象重新组织了一下，用不同的颜色来区分字段，这样你就能够很容易看出来，其实这个“echo-job”里并没有太多额外的功能，只是把 Pod 做了个简单的包装：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423211247.png" alt="20230423211247" style="zoom:75%;"></center> <p>因为 Job 业务的特殊性，所以<strong>我们还要在 <code>spec</code> 里多加一个字段 <code>restartPolicy</code>，确定 Pod 运行失败时的策略</strong>， <code>OnFailure</code> 是失败原地重启容器，而 <code>Never</code> 则是不重启容器，让 Job 去重新调度生成一个新的 Pod。</p> <h4 id="_3-3-2-如何在-kubernetes-里操作-job"><a href="#_3-3-2-如何在-kubernetes-里操作-job" class="header-anchor">#</a> 3.3.2 如何在 Kubernetes 里操作 Job？</h4> <p>运行这个离线作业的命令还是 kubectl apply：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f job.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建之后 Kubernetes 就会从 YAML 的模板定义中提取 Pod，在 Job 的控制下运行 Pod，你可以用 <code>kubectl get job</code>、 <code>kubectl get pod</code> 来分别查看 Job 和 Pod 的状态：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl get job
NAME       COMPLETIONS   DURATION   AGE
echo-job   <span class="token number">1</span>/1           18s        33s

$ kubectl get pod
NAME             READY   STATUS      RESTARTS   AGE
echo-job-bz69d   <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          59s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到，因为Pod被Job管理，它就不会反复重启报错了，而是会显示为 <code>Completed</code> 表示任务完成，而Job里也会列出运行成功的作业数量，这里只有一个作业，所以就是 <code>1/1</code>。</p> <p>你还可以看到，<strong>Pod 被自动关联了一个名字，用的是Job的名字（echo-job）再加上一个随机字符串（pb5gh）</strong>，这当然也是Job管理的“功劳”，免去了我们手工定义的麻烦，这样我们就可以使用命令 <code>kubectl logs</code> 来获取Pod的运行结果：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl logs echo-job-bz69d
hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Kubernetes 支持在 Job 级别上添加更多字段来控制离线作业，其他更详细的可以参考 Job 文档：</p> <ul><li><strong>activeDeadlineSeconds</strong>，设置Pod运行的超时时间。</li> <li><strong>backoffLimit</strong>，设置Pod的失败重试次数。</li> <li><strong>completions</strong>，Job完成需要运行多少个Pod，默认是1个。</li> <li><strong>parallelism</strong>，它与completions相关，表示允许并发运行的Pod数量，避免过多占用资源。</li></ul> <p>要注意这4个字段并不在 <code>template</code> 字段下，而是在 <code>spec</code> 字段下，所以它们是属于 Job 级别的，用来控制模板里的 Pod 对象。</p> <p>下面我再创建一个Job对象，名字叫“sleep-job”，它随机睡眠一段时间再退出，模拟运行时间较长的作业（比如MapReduce）。Job的参数设置成15秒超时，最多重试2次，总共需要运行完4个Pod，但同一时刻最多并发2个Pod：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> sleep<span class="token punctuation">-</span>job

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  activeDeadlineSeconds<span class="token punctuation">:</span> <span class="token number">15</span>
  backoffLimit<span class="token punctuation">:</span> <span class="token number">2</span>
  completions<span class="token punctuation">:</span> <span class="token number">4</span>
  parallelism<span class="token punctuation">:</span> <span class="token number">2</span>

  template<span class="token punctuation">:</span>
    spec<span class="token punctuation">:</span>
      restartPolicy<span class="token punctuation">:</span> OnFailure
      containers<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        name<span class="token punctuation">:</span> echo<span class="token punctuation">-</span>job
        imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
        command<span class="token punctuation">:</span>
          <span class="token punctuation">-</span> sh
          <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
          <span class="token punctuation">-</span> sleep $(($RANDOM % 10 + 1)) <span class="token important">&amp;&amp;</span> echo done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>使用 <code>kubectl apply</code> 创建Job之后，我们可以用 <code>kubectl get pod -w</code> 来实时观察 Pod 的状态，看到 Pod 不断被排队、创建、运行的过程。等运行完在 <code>kubectl get</code> 来看一下：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423220225.png" alt="20230423220225" style="zoom:75%;"></center> <p>就会看到Job的完成数量如同我们预期的是4，而4个Pod也都是完成状态。</p> <p>显然，“声明式”的Job对象让离线业务的描述变得非常直观，简单的几个字段就可以很好地控制作业的并行度和完成数量，不需要我们去人工监控干预，Kubernetes把这些都自动化实现了。</p> <h3 id="_3-4-cronjob"><a href="#_3-4-cronjob" class="header-anchor">#</a> 3.4 CronJob</h3> <p>我们可以直接使用 kubectl create 来创建 CronJob 的样板：</p> <blockquote><p>要注意两点：</p> <ol><li>因为 CronJob 的名字有点长，所以 Kubernetes 提供了简写 <code>cj</code>，这个简写也可以使用命令 <code>kubectl api-resources</code> 看到。</li> <li>CronJob 需要定时运行，所以我们在命令行里还需要指定参数 <code>--schedule</code>。</li></ol></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">out</span><span class="token operator">=</span><span class="token string">&quot;--dry-run=client -o yaml&quot;</span>              <span class="token comment"># 定义Shell变量</span>
kubectl create cj echo-cj --image<span class="token operator">=</span>busybox --schedule<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token variable">$out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后我们编辑这个 YAML 样板，生成 CronJob 对象：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CronJob
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> echo<span class="token punctuation">-</span>cj

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  schedule<span class="token punctuation">:</span> <span class="token string">'*/1 * * * *'</span>
  jobTemplate<span class="token punctuation">:</span>
    spec<span class="token punctuation">:</span>
      template<span class="token punctuation">:</span>
        spec<span class="token punctuation">:</span>
          restartPolicy<span class="token punctuation">:</span> OnFailure
          containers<span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
            name<span class="token punctuation">:</span> echo<span class="token punctuation">-</span>cj
            imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
            command<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/echo&quot;</span><span class="token punctuation">]</span>
            args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>我们还是重点关注它的 <code>spec</code> 字段，你会发现它居然连续有三个 <code>spec</code> 嵌套层次：</p> <ul><li>第一个 <code>spec</code> 是CronJob自己的对象规格声明</li> <li>第二个 <code>spec</code> 从属于“jobTemplate”，它定义了一个Job对象。</li> <li>第三个 <code>spec</code> 从属于“template”，它定义了Job里运行的Pod。</li></ul> <p>所以，CronJob其实是又组合了Job而生成的新对象，我还是画了一张图，方便你理解它的“套娃”结构：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423220636.png" alt="20230423220636" style="zoom:75%;"></center> <p>除了定义 Job 对象的“<strong>jobTemplate</strong>”字段之外，CronJob 还有一个新字段就是“<strong>schedule</strong>”，用来定义任务周期运行的规则。它使用的是标准的 Cron 语法。</p> <p>除了名字不同，CronJob和Job的用法几乎是一样的，使用 <code>kubectl apply</code> 创建CronJob，使用 <code>kubectl get cj</code>、 <code>kubectl get pod</code> 来查看状态：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f cronjob.yml
kubectl get cj
kubectl get pod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-5-小结"><a href="#_3-5-小结" class="header-anchor">#</a> 3.5 小结</h3> <p>这一节以面向对象的思想分析了 Kubernetes 里资源对象的设计，它强调“职责单一”和“对象组合”，简单来说就是“对象套对象”。</p> <p>通过这种嵌套方式，Kubernetes里的这些API对象就形成了一个“控制链”：CronJob使用定时规则控制Job，Job使用并发数量控制Pod，Pod再定义参数控制容器，容器再隔离控制进程，进程最终实现业务功能，层层递进的形式有点像设计模式里的Decorator（装饰模式），链条里的每个环节都各司其职，在Kubernetes的统一指挥下完成任务。</p> <p>今天学习了 Job 和 CronJob 两种对象：</p> <ul><li>Job 的关键字段是 <code>spec.template</code>，里面定义了用来运行业务的Pod模板，其他的重要字段有 <code>completions</code>、 <code>parallelism</code> 等。</li> <li>CronJob 的关键字段是 <code>spec.jobTemplate</code> 和 <code>spec.schedule</code>，分别定义了 Job 模板和定时运行的规则。</li></ul> <p>课外小贴士：</p> <ul><li>Job/CronJob 的“apiVersion”字段是“batch/v1”表示它们不属于核心对象组 (core group)，而是批处理对象组 (batch group)。</li> <li>出于节约资源的考虑，CronJob 不会无限地保留已经运行的 Job，它默认只保留 3 个最近的执行结果，但可以用字段“successfulJobsHistoryLimit”改变。</li> <li>网站 <a href="https://crontab.gu-ru/" target="_blank" rel="noopener noreferrer">crontab.guru<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 很好地解释了 cron 表达式的含义。</li></ul> <h2 id="_4-configmap-secret-怎样配置、定制我的应用"><a href="#_4-configmap-secret-怎样配置、定制我的应用" class="header-anchor">#</a> 4. ConfigMap/Secret：怎样配置、定制我的应用</h2> <p>想让业务更顺利地运行，有一个问题不容忽视，那就是应用的配置管理。比如 Nginx 的 nginx.conf、Redis 的 redis.conf 等。之前我们说管理配置文件的方式可以使用 COPY 命令打包到镜像中，或者通过 docker cp 拷贝进去。但这两种方式不太灵活，对于这个问题，Kubernetes 有自己的解决方案，就是使用 YAML 语言来定义 API 对象，再组合起来实现动态配置。</p> <p>今天讲解的专门用来管理配置信息的两种对象 ConfigMap 和 Secret 就可以实现灵活地配置我们的应用。</p> <p>应用程序中配置信息有两类：</p> <ul><li>明文配置：也就是不保密，比如 port、运行参数等</li> <li>机密配置：设计敏感信息，不能随意查看，比如 password、certificate 等</li></ul> <p><strong>ConfigMap 用来保存明文配置</strong>，<strong>Secret 用来保存机密配置</strong>。</p> <h3 id="_4-1-configmap"><a href="#_4-1-configmap" class="header-anchor">#</a> 4.1 ConfigMap</h3> <p>ConfigMap 简写名字是 <strong>cm</strong>。</p> <p>与之前的 Pod 之类的相比，ConfigMap 的 YAML 没有 spec 字段，因为 ConfigMap 存的是静态的字符串，并不是容器，也就不需要 spec 来说明运行时的规格，而是哦需要一个含义更明确的字段：<strong>data 字段</strong>。</p> <p>如下命令创建 YAML 样本文件：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">out</span><span class="token operator">=</span><span class="token string">&quot;--dry-run=client -o yaml&quot;</span>        <span class="token comment"># 定义Shell变量</span>
kubectl create cm info --from-literal<span class="token operator">=</span>k<span class="token operator">=</span>v <span class="token variable">$out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>--from-literal</code> 表示从字面值生成一些数据，而由于 ConfigMap 里的数据都是 KV 形式的，所以它的参数需要使用 <code>k=v</code> 的形式。</li></ul> <p>得到样板文件后在修改一下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> info

<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token string">'10'</span>
  <span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token string">'on'</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">'/etc/systemd'</span>
  <span class="token key atrule">greeting</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    say hello to kubernetes.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>现在可以使用 kubectl apply 来创建 ConfigMap 对象了，然后用 <code>kubectl get</code>、 <code>kubectl describe</code> 来查看状态：</p> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-bash"><code>$ kubectl apply -f cm.yml
configmap/info created

$ kubectl get cm
NAME               DATA   AGE
info               <span class="token number">4</span>      54s
kube-root-ca.crt   <span class="token number">1</span>      26h

$ kubectl describe cm info
Name:         info
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Data
<span class="token operator">==</span><span class="token operator">==</span>
debug:
----
on
greeting:
----
say hello to kubernetes.
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>你可以看到，现在 <strong>ConfigMap 的 Key-Value 信息就已经存入了 etcd 数据库，后续就可以被其他 API 对象使用</strong>。</p> <h3 id="_4-2-secret"><a href="#_4-2-secret" class="header-anchor">#</a> 4.2 Secret</h3> <p>它与 ConfigMap 很类似，不过 Secret 对象又细分出很多类，比如</p> <ul><li>访问私有镜像仓库的认证信息</li> <li>身份识别的凭证信息</li> <li>HTTPS通信的证书和私钥</li> <li>一般的机密信息（格式由用户自行解释）</li></ul> <p>这里只解释最后一种，先创建出 YAML 样板：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create secret generic user --from-literal<span class="token operator">=</span>name<span class="token operator">=</span>root <span class="token variable">$out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>得到的Secret对象大概是这个样子：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> user

<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm9vdA==  <span class="token comment"># root</span>
  <span class="token key atrule">pwd</span><span class="token punctuation">:</span> MTIzNDU2   <span class="token comment"># 123456</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span> bXlzcWw=    <span class="token comment"># mysql</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Secret 的 YAML 中保存的不再是明文，比如 data 字段下面的 name 值就是一串乱码。这串“乱码”就是Secret与ConfigMap的不同之处，不让用户直接看到原始数据，起到一定的保密作用。不过它的手法非常简单，<strong>只是做了Base64编码</strong>，根本算不上真正的加密，所以我们完全可以绕开kubectl，自己用Linux小工具“base64”来对数据编码，然后写入YAML文件，比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;123456&quot;</span> <span class="token operator">|</span> base64
MTIzNDU2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>要注意这条命令里的 <code>echo</code> ，必须要加参数 <code>-n</code> 去掉字符串里隐含的换行符，否则Base64编码出来的字符串就是错误的。</li></ul> <p>接下来的创建和查看对象操作和 ConfigMap 是一样的：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply -f secret.yml 
secret/user created

$ kubectl get secret
NAME                  TYPE                                  DATA   AGE
default-token-pvqwj   kubernetes.io/service-account-token   <span class="token number">3</span>      26h
user                  Opaque                                <span class="token number">3</span>      24s

$ kubectl describe secret user
Name:         user
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Type:  Opaque

Data
<span class="token operator">==</span><span class="token operator">==</span>
db:    <span class="token number">5</span> bytes
name:  <span class="token number">4</span> bytes
pwd:   <span class="token number">6</span> bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>这样一个存储敏感信息的 Secret 对象也就创建好了，而且因为它是保密的，使用 <code>kubectl describe</code> 不能直接看到内容，只能看到数据的大小。</p> <h3 id="_4-3-使用-configmap-secret"><a href="#_4-3-使用-configmap-secret" class="header-anchor">#</a> 4.3 使用 ConfigMap/Secret</h3> <p>因为 ConfigMap 和 Secret 只是一些存储在etcd里的字符串，所以如果想要在运行时产生效果，就必须要以某种方式“<strong>注入</strong>”到Pod里，让应用去读取。在这方面的处理上 Kubernetes 和 Docker 是一样的，也是两种途径：<strong>环境变量</strong>和<strong>加载文件</strong>。</p> <h4 id="_4-3-1-以环境变量的方式使用-configmap-secret"><a href="#_4-3-1-以环境变量的方式使用-configmap-secret" class="header-anchor">#</a> 4.3.1 以环境变量的方式使用 ConfigMap/Secret</h4> <p>在 Pod 的 YAML 中 containers 有一个 <strong>env</strong>，它定义了 Pod 里容器能够看到的环境变量。当时我们只是简单实用了 value 来写死，<strong>实际上它可以使用 valueFrom 字段来从 ConfigMap 或 Secret 对象里获取值，从而把配置信息以环境变量的形式注入进 Pod，也就是配置与应用的解耦</strong>。</p> <p>如下示例所示：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> env<span class="token punctuation">-</span>pod

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> COUNT
        valueFrom<span class="token punctuation">:</span>
          configMapKeyRef<span class="token punctuation">:</span>
            name<span class="token punctuation">:</span> info
            key<span class="token punctuation">:</span> count
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USERNAME
        valueFrom<span class="token punctuation">:</span>
          secretKeyRef<span class="token punctuation">:</span>
            name<span class="token punctuation">:</span> user
            key<span class="token punctuation">:</span> name

    image<span class="token punctuation">:</span> busybox
    name<span class="token punctuation">:</span> busy
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    command<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;300&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>如上所示，valueFrom 字段指定了 env 的来源，他可以是 configMapKeyRef 或 secretKeyRef，然后进一步指定所使用的 ConfigMap/Secret 对象的 name 和里面的 key。</p> <p>关系如下图所示：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423224934.png" alt="20230423224934" style="zoom:75%;"></center> <h4 id="_4-3-2-以-volume-的方式使用-configmap-secret"><a href="#_4-3-2-以-volume-的方式使用-configmap-secret" class="header-anchor">#</a> 4.3.2 以 Volume 的方式使用 ConfigMap/Secret</h4> <p>我们可以为 Pod “挂载（mount）”多个Volume，里面存放供 Pod 访问的数据，这种方式有点类似 <code>docker run -v</code>。</p> <p>在 Pod 里挂载 Volume 很容易，只需要在“<strong>spec</strong>”里增加一个“<strong>volumes</strong>”字段，然后再定义卷的名字和引用的 ConfigMap/Secret 就可以了。要注意的是 Volume 属于 Pod，不属于容器，所以它和字段“containers”是同级的，都属于“spec”：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  volumes<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>vol
    configMap<span class="token punctuation">:</span>
      name<span class="token punctuation">:</span> info
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sec<span class="token punctuation">-</span>vol
    secret<span class="token punctuation">:</span>
      secretName<span class="token punctuation">:</span> user
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上面定义的两个 volume 分别引用了 ConfigMap 对象和 Secret 对象。</p> <p>有了 Volume 的定义之后，就可以在容器里挂载了，这要用到“<strong>volumeMounts</strong>”字段，正如它的字面含义，可以把定义好的 Volume 挂载到容器里的某个路径下，所以需要在里面用 <strong>mountPath</strong>、<strong>name</strong> 明确地指定挂载路径和 Volume 的名字：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp/cm<span class="token punctuation">-</span>items
      name<span class="token punctuation">:</span> cm<span class="token punctuation">-</span>vol
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp/sec<span class="token punctuation">-</span>items
      name<span class="token punctuation">:</span> sec<span class="token punctuation">-</span>vol
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>以上写好后，配置信息就可以加载成文件了。这里先花了个图来表示他们的引用关系：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230423225501.png" alt="20230423225501" style="zoom:75%;"></center> <p>你可以看到，挂载 Volume 的方式和环境变量又不太相同：</p> <ul><li>环境变量是直接引用了ConfigMap/Secret</li> <li>而Volume又多加了一个环节，需要先用Volume引用ConfigMap/Secret，然后在容器里挂载Volume，有点“兜圈子”“弯弯绕”。</li></ul> <p><strong>这种方式的好处在于</strong>：以 Volume 的概念统一抽象了所有的存储，不仅现在支持ConfigMap/Secret，以后还能够支持临时卷、持久卷、动态卷、快照卷等许多形式的存储，扩展性非常好。</p> <p>现在我把Pod的完整YAML描述列出来，然后使用 <code>kubectl apply</code> 创建它：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> vol<span class="token punctuation">-</span>pod

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  volumes<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>vol
    configMap<span class="token punctuation">:</span>
      name<span class="token punctuation">:</span> info
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sec<span class="token punctuation">-</span>vol
    secret<span class="token punctuation">:</span>
      secretName<span class="token punctuation">:</span> user

  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp/cm<span class="token punctuation">-</span>items
      name<span class="token punctuation">:</span> cm<span class="token punctuation">-</span>vol
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp/sec<span class="token punctuation">-</span>items
      name<span class="token punctuation">:</span> sec<span class="token punctuation">-</span>vol

    image<span class="token punctuation">:</span> busybox
    name<span class="token punctuation">:</span> busy
    imagePullPolicy<span class="token punctuation">:</span> IfNotPresent
    command<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;300&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>创建之后，我们还是用 <code>kubectl exec</code> 进入Pod，看看配置信息被加载成了什么形式：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f vol-pod.yml
kubectl get pod
kubectl <span class="token builtin class-name">exec</span> -it vol-pod -- <span class="token function">sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/微信截图_20230423225837.png" alt="微信截图_20230423225837" style="zoom:75%;"></center> <p>你会看到，<strong>ConfigMap 和 Secret 都变成了目录的形式，而它们里面的 Key-Value 变成了一个个的文件，而文件名就是 Key</strong>。</p> <p>因为这种形式上的差异，以Volume的方式来使用ConfigMap/Secret，就和环境变量不太一样。<strong>环境变量用法简单，更适合存放简短的字符串，而Volume更适合存放大数据量的配置文件，在Pod里加载成文件后让应用直接读取使用</strong>。</p> <h3 id="_4-4-小结"><a href="#_4-4-小结" class="header-anchor">#</a> 4.4 小结</h3> <p>课外小贴士：</p> <ul><li>如果已经存在了一些配置文件，我们可以使用参数--from-fle”从文件自动创建出 ConfgMap 或Secret。</li> <li>Secret 对象默认只会以 Base64 编码的形式存储在etcd 里，而 Base64 不是加密算法，所以它通常并不是secret”，不过你可以为 Kubernetes 启用加密功能实现真正的安全。</li> <li>Linux 里对环境变量的命名有限制，不能使用 <code>-</code>、<code>.</code> 等特殊字符，所以在创建 ConfgMap/Secret 的时候要留意一下，否则会无法以环境变量的形式注入 Pod。</li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yubincloud/notebook/edit/master/docs/运维/05.云原生/18.Kubernetes入门实战课-罗剑锋/11.YAML、Pod、Job、CronJob、ConfigMap、Secret.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/04/26, 13:34:07</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/cloud-native/k8s-practice/k8s-install/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Kubernetes 的安装与基本架构</div></a> <a href="/notebook/pages/cloud-native/k8s-practice/deployment-and-other/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Deployment、Daemonset、Service、Ingress</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notebook/pages/cloud-native/k8s-practice/k8s-install/" class="prev">Kubernetes 的安装与基本架构</a></span> <span class="next"><a href="/notebook/pages/cloud-native/k8s-practice/deployment-and-other/">Deployment、Daemonset、Service、Ingress</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/notebook/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/notebook/pages/ml/lhy/drl17/"><div>
            Deep Reinforcement Learning
            <!----></div></a> <span class="date">10-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/notebook/pages/mysql/geektime/misdeletion/"><div>
            误删数据后怎么办
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/notebook/pages/mysql/geektime/multi-slaves/"><div>
            MySQL 一主多从
            <!----></div></a> <span class="date">03-22</span></dt></dl> <dl><dd></dd> <dt><a href="/notebook/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="yubin_inbuy@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/yubincloud" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>yubincloud | <a href="https://github.com/yubincloud/notebook/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/notebook/assets/js/app.2bf3b6c1.js" defer></script><script src="/notebook/assets/js/2.0ad58009.js" defer></script><script src="/notebook/assets/js/336.cf000555.js" defer></script>
  </body>
</html>
