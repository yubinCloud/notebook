<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>滚动更新、应用保障、集群管理 | notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/notebook/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="学习笔记">
    <meta name="keywords" content="全栈学习笔记">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.1b58b254.css" as="style"><link rel="preload" href="/notebook/assets/js/app.2bf3b6c1.js" as="script"><link rel="preload" href="/notebook/assets/js/2.0ad58009.js" as="script"><link rel="preload" href="/notebook/assets/js/339.92d07729.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.99522837.js"><link rel="prefetch" href="/notebook/assets/js/100.e3b56889.js"><link rel="prefetch" href="/notebook/assets/js/101.6ea1d00b.js"><link rel="prefetch" href="/notebook/assets/js/102.eca9dfbd.js"><link rel="prefetch" href="/notebook/assets/js/103.6ea477d4.js"><link rel="prefetch" href="/notebook/assets/js/104.ac820d2b.js"><link rel="prefetch" href="/notebook/assets/js/105.58b259a8.js"><link rel="prefetch" href="/notebook/assets/js/106.a86005d0.js"><link rel="prefetch" href="/notebook/assets/js/107.7a79d36f.js"><link rel="prefetch" href="/notebook/assets/js/108.64404e25.js"><link rel="prefetch" href="/notebook/assets/js/109.75f12c0a.js"><link rel="prefetch" href="/notebook/assets/js/11.d26d59e4.js"><link rel="prefetch" href="/notebook/assets/js/110.1155fe36.js"><link rel="prefetch" href="/notebook/assets/js/111.bf8b5871.js"><link rel="prefetch" href="/notebook/assets/js/112.22833ceb.js"><link rel="prefetch" href="/notebook/assets/js/113.6a080233.js"><link rel="prefetch" href="/notebook/assets/js/114.35de9701.js"><link rel="prefetch" href="/notebook/assets/js/115.f598d8c2.js"><link rel="prefetch" href="/notebook/assets/js/116.e3bd29ce.js"><link rel="prefetch" href="/notebook/assets/js/117.c3c02abc.js"><link rel="prefetch" href="/notebook/assets/js/118.136a552a.js"><link rel="prefetch" href="/notebook/assets/js/119.c124f3f8.js"><link rel="prefetch" href="/notebook/assets/js/12.dc66c4f2.js"><link rel="prefetch" href="/notebook/assets/js/120.f835d124.js"><link rel="prefetch" href="/notebook/assets/js/121.367716ae.js"><link rel="prefetch" href="/notebook/assets/js/122.752b0493.js"><link rel="prefetch" href="/notebook/assets/js/123.9f8d6026.js"><link rel="prefetch" href="/notebook/assets/js/124.e8eb61b6.js"><link rel="prefetch" href="/notebook/assets/js/125.cb081200.js"><link rel="prefetch" href="/notebook/assets/js/126.ab87d911.js"><link rel="prefetch" href="/notebook/assets/js/127.ffdbe74d.js"><link rel="prefetch" href="/notebook/assets/js/128.ec526e42.js"><link rel="prefetch" href="/notebook/assets/js/129.71839012.js"><link rel="prefetch" href="/notebook/assets/js/13.32e95b42.js"><link rel="prefetch" href="/notebook/assets/js/130.2bc0bb4d.js"><link rel="prefetch" href="/notebook/assets/js/131.5595b49b.js"><link rel="prefetch" href="/notebook/assets/js/132.4963c5c4.js"><link rel="prefetch" href="/notebook/assets/js/133.44f48cfd.js"><link rel="prefetch" href="/notebook/assets/js/134.cf25626c.js"><link rel="prefetch" href="/notebook/assets/js/135.5ee30fa9.js"><link rel="prefetch" href="/notebook/assets/js/136.bc43f8e6.js"><link rel="prefetch" href="/notebook/assets/js/137.9ab5beac.js"><link rel="prefetch" href="/notebook/assets/js/138.692a33e6.js"><link rel="prefetch" href="/notebook/assets/js/139.08e7c98d.js"><link rel="prefetch" href="/notebook/assets/js/14.c418d170.js"><link rel="prefetch" href="/notebook/assets/js/140.39a861db.js"><link rel="prefetch" href="/notebook/assets/js/141.46678413.js"><link rel="prefetch" href="/notebook/assets/js/142.f7ef5eac.js"><link rel="prefetch" href="/notebook/assets/js/143.c92cbac1.js"><link rel="prefetch" href="/notebook/assets/js/144.d9c61437.js"><link rel="prefetch" href="/notebook/assets/js/145.9f603b31.js"><link rel="prefetch" href="/notebook/assets/js/146.b875f045.js"><link rel="prefetch" href="/notebook/assets/js/147.55e7c4f8.js"><link rel="prefetch" href="/notebook/assets/js/148.4410c365.js"><link rel="prefetch" href="/notebook/assets/js/149.6096ed98.js"><link rel="prefetch" href="/notebook/assets/js/15.e0e7392a.js"><link rel="prefetch" href="/notebook/assets/js/150.24451f07.js"><link rel="prefetch" href="/notebook/assets/js/151.7cff301c.js"><link rel="prefetch" href="/notebook/assets/js/152.035fee1f.js"><link rel="prefetch" href="/notebook/assets/js/153.c61f8ec3.js"><link rel="prefetch" href="/notebook/assets/js/154.7bb549d0.js"><link rel="prefetch" href="/notebook/assets/js/155.1dc494db.js"><link rel="prefetch" href="/notebook/assets/js/156.b87eaf39.js"><link rel="prefetch" href="/notebook/assets/js/157.e3f5a5c0.js"><link rel="prefetch" href="/notebook/assets/js/158.c565c699.js"><link rel="prefetch" href="/notebook/assets/js/159.a22609ef.js"><link rel="prefetch" href="/notebook/assets/js/16.d1aef4ee.js"><link rel="prefetch" href="/notebook/assets/js/160.b29e761c.js"><link rel="prefetch" href="/notebook/assets/js/161.bee1e522.js"><link rel="prefetch" href="/notebook/assets/js/162.c49fca62.js"><link rel="prefetch" href="/notebook/assets/js/163.2cb4d37d.js"><link rel="prefetch" href="/notebook/assets/js/164.4a0dbc64.js"><link rel="prefetch" href="/notebook/assets/js/165.490d05b3.js"><link rel="prefetch" href="/notebook/assets/js/166.df5d2527.js"><link rel="prefetch" href="/notebook/assets/js/167.89a81814.js"><link rel="prefetch" href="/notebook/assets/js/168.9991702e.js"><link rel="prefetch" href="/notebook/assets/js/169.2f9a5dce.js"><link rel="prefetch" href="/notebook/assets/js/17.88ae5445.js"><link rel="prefetch" href="/notebook/assets/js/170.5f23eb3c.js"><link rel="prefetch" href="/notebook/assets/js/171.c521aaa8.js"><link rel="prefetch" href="/notebook/assets/js/172.42110b0a.js"><link rel="prefetch" href="/notebook/assets/js/173.5e36f1bf.js"><link rel="prefetch" href="/notebook/assets/js/174.f48e078a.js"><link rel="prefetch" href="/notebook/assets/js/175.775da6a5.js"><link rel="prefetch" href="/notebook/assets/js/176.9c3c55ea.js"><link rel="prefetch" href="/notebook/assets/js/177.b54d1cff.js"><link rel="prefetch" href="/notebook/assets/js/178.ff08b7f5.js"><link rel="prefetch" href="/notebook/assets/js/179.c6a1af32.js"><link rel="prefetch" href="/notebook/assets/js/18.dcb78196.js"><link rel="prefetch" href="/notebook/assets/js/180.25dd9eba.js"><link rel="prefetch" href="/notebook/assets/js/181.13e6ec84.js"><link rel="prefetch" href="/notebook/assets/js/182.f6849f0d.js"><link rel="prefetch" href="/notebook/assets/js/183.7e664874.js"><link rel="prefetch" href="/notebook/assets/js/184.e6aba86f.js"><link rel="prefetch" href="/notebook/assets/js/185.df07b919.js"><link rel="prefetch" href="/notebook/assets/js/186.02c77e75.js"><link rel="prefetch" href="/notebook/assets/js/187.e8380ed4.js"><link rel="prefetch" href="/notebook/assets/js/188.eddc8bee.js"><link rel="prefetch" href="/notebook/assets/js/189.fbc1840f.js"><link rel="prefetch" href="/notebook/assets/js/19.5997a514.js"><link rel="prefetch" href="/notebook/assets/js/190.a37bfe4c.js"><link rel="prefetch" href="/notebook/assets/js/191.e53a3d4b.js"><link rel="prefetch" href="/notebook/assets/js/192.2f5be408.js"><link rel="prefetch" href="/notebook/assets/js/193.4ca6de49.js"><link rel="prefetch" href="/notebook/assets/js/194.b8e51d9d.js"><link rel="prefetch" href="/notebook/assets/js/195.70e6b23a.js"><link rel="prefetch" href="/notebook/assets/js/196.5d5fbf2d.js"><link rel="prefetch" href="/notebook/assets/js/197.78456dab.js"><link rel="prefetch" href="/notebook/assets/js/198.4308331c.js"><link rel="prefetch" href="/notebook/assets/js/199.2e537849.js"><link rel="prefetch" href="/notebook/assets/js/20.fc057fd7.js"><link rel="prefetch" href="/notebook/assets/js/200.b3309bbf.js"><link rel="prefetch" href="/notebook/assets/js/201.4723461c.js"><link rel="prefetch" href="/notebook/assets/js/202.b15b5177.js"><link rel="prefetch" href="/notebook/assets/js/203.22c50e61.js"><link rel="prefetch" href="/notebook/assets/js/204.5b8b3b00.js"><link rel="prefetch" href="/notebook/assets/js/205.54ee7630.js"><link rel="prefetch" href="/notebook/assets/js/206.f3f20f94.js"><link rel="prefetch" href="/notebook/assets/js/207.a9608973.js"><link rel="prefetch" href="/notebook/assets/js/208.1a80a593.js"><link rel="prefetch" href="/notebook/assets/js/209.586fd293.js"><link rel="prefetch" href="/notebook/assets/js/21.cb4205ee.js"><link rel="prefetch" href="/notebook/assets/js/210.7829dd53.js"><link rel="prefetch" href="/notebook/assets/js/211.3ce139ab.js"><link rel="prefetch" href="/notebook/assets/js/212.84738a64.js"><link rel="prefetch" href="/notebook/assets/js/213.a631830d.js"><link rel="prefetch" href="/notebook/assets/js/214.9d64cf85.js"><link rel="prefetch" href="/notebook/assets/js/215.87030b6b.js"><link rel="prefetch" href="/notebook/assets/js/216.ddbe1944.js"><link rel="prefetch" href="/notebook/assets/js/217.16ae7e40.js"><link rel="prefetch" href="/notebook/assets/js/218.e7780d65.js"><link rel="prefetch" href="/notebook/assets/js/219.abae5e09.js"><link rel="prefetch" href="/notebook/assets/js/22.256014b4.js"><link rel="prefetch" href="/notebook/assets/js/220.8e3a8702.js"><link rel="prefetch" href="/notebook/assets/js/221.4c279d74.js"><link rel="prefetch" href="/notebook/assets/js/222.6c9b2595.js"><link rel="prefetch" href="/notebook/assets/js/223.cc072424.js"><link rel="prefetch" href="/notebook/assets/js/224.c663b40f.js"><link rel="prefetch" href="/notebook/assets/js/225.f3e52654.js"><link rel="prefetch" href="/notebook/assets/js/226.5e00402c.js"><link rel="prefetch" href="/notebook/assets/js/227.1c28ce97.js"><link rel="prefetch" href="/notebook/assets/js/228.42b8c305.js"><link rel="prefetch" href="/notebook/assets/js/229.df9760ec.js"><link rel="prefetch" href="/notebook/assets/js/23.a3d7d66a.js"><link rel="prefetch" href="/notebook/assets/js/230.cfe18f05.js"><link rel="prefetch" href="/notebook/assets/js/231.3a664a46.js"><link rel="prefetch" href="/notebook/assets/js/232.966ce9dc.js"><link rel="prefetch" href="/notebook/assets/js/233.fc06cb57.js"><link rel="prefetch" href="/notebook/assets/js/234.7bb9b7d4.js"><link rel="prefetch" href="/notebook/assets/js/235.b336116e.js"><link rel="prefetch" href="/notebook/assets/js/236.03a38f77.js"><link rel="prefetch" href="/notebook/assets/js/237.0dbda856.js"><link rel="prefetch" href="/notebook/assets/js/238.c1c19749.js"><link rel="prefetch" href="/notebook/assets/js/239.046875c1.js"><link rel="prefetch" href="/notebook/assets/js/24.8e5e267e.js"><link rel="prefetch" href="/notebook/assets/js/240.4bd9cdc0.js"><link rel="prefetch" href="/notebook/assets/js/241.c3dc5804.js"><link rel="prefetch" href="/notebook/assets/js/242.db0b1a91.js"><link rel="prefetch" href="/notebook/assets/js/243.4d9bd61d.js"><link rel="prefetch" href="/notebook/assets/js/244.ee57770b.js"><link rel="prefetch" href="/notebook/assets/js/245.02aab1c1.js"><link rel="prefetch" href="/notebook/assets/js/246.b76a18bb.js"><link rel="prefetch" href="/notebook/assets/js/247.75a673db.js"><link rel="prefetch" href="/notebook/assets/js/248.ad93f81d.js"><link rel="prefetch" href="/notebook/assets/js/249.fb75a938.js"><link rel="prefetch" href="/notebook/assets/js/25.b12f24fe.js"><link rel="prefetch" href="/notebook/assets/js/250.8395c0b6.js"><link rel="prefetch" href="/notebook/assets/js/251.16a6d2a4.js"><link rel="prefetch" href="/notebook/assets/js/252.ef3ee05e.js"><link rel="prefetch" href="/notebook/assets/js/253.78e3471e.js"><link rel="prefetch" href="/notebook/assets/js/254.a5783e07.js"><link rel="prefetch" href="/notebook/assets/js/255.2ab853f6.js"><link rel="prefetch" href="/notebook/assets/js/256.5430831b.js"><link rel="prefetch" href="/notebook/assets/js/257.99c8a0a4.js"><link rel="prefetch" href="/notebook/assets/js/258.4496955b.js"><link rel="prefetch" href="/notebook/assets/js/259.9152b1d2.js"><link rel="prefetch" href="/notebook/assets/js/26.0fce5172.js"><link rel="prefetch" href="/notebook/assets/js/260.072f65e6.js"><link rel="prefetch" href="/notebook/assets/js/261.0bca81af.js"><link rel="prefetch" href="/notebook/assets/js/262.9c9c5337.js"><link rel="prefetch" href="/notebook/assets/js/263.42470957.js"><link rel="prefetch" href="/notebook/assets/js/264.64b5f4fb.js"><link rel="prefetch" href="/notebook/assets/js/265.836a69c5.js"><link rel="prefetch" href="/notebook/assets/js/266.a00cdeb1.js"><link rel="prefetch" href="/notebook/assets/js/267.09dc5ae4.js"><link rel="prefetch" href="/notebook/assets/js/268.6fa6603e.js"><link rel="prefetch" href="/notebook/assets/js/269.3963ce5e.js"><link rel="prefetch" href="/notebook/assets/js/27.47ba3886.js"><link rel="prefetch" href="/notebook/assets/js/270.2826382d.js"><link rel="prefetch" href="/notebook/assets/js/271.3c746c23.js"><link rel="prefetch" href="/notebook/assets/js/272.30698dda.js"><link rel="prefetch" href="/notebook/assets/js/273.b06e3fd2.js"><link rel="prefetch" href="/notebook/assets/js/274.2016c7fa.js"><link rel="prefetch" href="/notebook/assets/js/275.f4aff624.js"><link rel="prefetch" href="/notebook/assets/js/276.e682aa74.js"><link rel="prefetch" href="/notebook/assets/js/277.0c3f41db.js"><link rel="prefetch" href="/notebook/assets/js/278.3c2d5251.js"><link rel="prefetch" href="/notebook/assets/js/279.a9af5703.js"><link rel="prefetch" href="/notebook/assets/js/28.6bac56c6.js"><link rel="prefetch" href="/notebook/assets/js/280.a5da28a3.js"><link rel="prefetch" href="/notebook/assets/js/281.8cc5a3ba.js"><link rel="prefetch" href="/notebook/assets/js/282.55227ff2.js"><link rel="prefetch" href="/notebook/assets/js/283.13f54ae9.js"><link rel="prefetch" href="/notebook/assets/js/284.88644dec.js"><link rel="prefetch" href="/notebook/assets/js/285.0670211f.js"><link rel="prefetch" href="/notebook/assets/js/286.afa43d34.js"><link rel="prefetch" href="/notebook/assets/js/287.9e98e933.js"><link rel="prefetch" href="/notebook/assets/js/288.175a8a9b.js"><link rel="prefetch" href="/notebook/assets/js/289.0d712953.js"><link rel="prefetch" href="/notebook/assets/js/29.3476ca1f.js"><link rel="prefetch" href="/notebook/assets/js/290.4b258761.js"><link rel="prefetch" href="/notebook/assets/js/291.e7ded33e.js"><link rel="prefetch" href="/notebook/assets/js/292.fcfca63e.js"><link rel="prefetch" href="/notebook/assets/js/293.4d6c0f7d.js"><link rel="prefetch" href="/notebook/assets/js/294.59b7e2de.js"><link rel="prefetch" href="/notebook/assets/js/295.0b8dc8f3.js"><link rel="prefetch" href="/notebook/assets/js/296.65434eb0.js"><link rel="prefetch" href="/notebook/assets/js/297.957ba4a7.js"><link rel="prefetch" href="/notebook/assets/js/298.dd81e487.js"><link rel="prefetch" href="/notebook/assets/js/299.eba0d36a.js"><link rel="prefetch" href="/notebook/assets/js/3.a80649d1.js"><link rel="prefetch" href="/notebook/assets/js/30.51a26022.js"><link rel="prefetch" href="/notebook/assets/js/300.23a6a024.js"><link rel="prefetch" href="/notebook/assets/js/301.eb4276c9.js"><link rel="prefetch" href="/notebook/assets/js/302.2c696c44.js"><link rel="prefetch" href="/notebook/assets/js/303.a748a576.js"><link rel="prefetch" href="/notebook/assets/js/304.95020a99.js"><link rel="prefetch" href="/notebook/assets/js/305.c4bc6072.js"><link rel="prefetch" href="/notebook/assets/js/306.74133b05.js"><link rel="prefetch" href="/notebook/assets/js/307.6ea724f3.js"><link rel="prefetch" href="/notebook/assets/js/308.fc7b065c.js"><link rel="prefetch" href="/notebook/assets/js/309.56497801.js"><link rel="prefetch" href="/notebook/assets/js/31.c351e10d.js"><link rel="prefetch" href="/notebook/assets/js/310.692379f9.js"><link rel="prefetch" href="/notebook/assets/js/311.b7393f95.js"><link rel="prefetch" href="/notebook/assets/js/312.f3eec1e1.js"><link rel="prefetch" href="/notebook/assets/js/313.9227351c.js"><link rel="prefetch" href="/notebook/assets/js/314.6960877d.js"><link rel="prefetch" href="/notebook/assets/js/315.f55a1979.js"><link rel="prefetch" href="/notebook/assets/js/316.6121039c.js"><link rel="prefetch" href="/notebook/assets/js/317.7ba118c8.js"><link rel="prefetch" href="/notebook/assets/js/318.2b71444c.js"><link rel="prefetch" href="/notebook/assets/js/319.bc0d5ccf.js"><link rel="prefetch" href="/notebook/assets/js/32.8a802a22.js"><link rel="prefetch" href="/notebook/assets/js/320.79f13ae1.js"><link rel="prefetch" href="/notebook/assets/js/321.21d3b0cf.js"><link rel="prefetch" href="/notebook/assets/js/322.87e4c143.js"><link rel="prefetch" href="/notebook/assets/js/323.4dee2eb7.js"><link rel="prefetch" href="/notebook/assets/js/324.f8c64322.js"><link rel="prefetch" href="/notebook/assets/js/325.c82057d6.js"><link rel="prefetch" href="/notebook/assets/js/326.3ea0d22b.js"><link rel="prefetch" href="/notebook/assets/js/327.90b878d9.js"><link rel="prefetch" href="/notebook/assets/js/328.59e55f0a.js"><link rel="prefetch" href="/notebook/assets/js/329.95fb2ef0.js"><link rel="prefetch" href="/notebook/assets/js/33.18cd7b09.js"><link rel="prefetch" href="/notebook/assets/js/330.ed1fb0e9.js"><link rel="prefetch" href="/notebook/assets/js/331.b84d88a9.js"><link rel="prefetch" href="/notebook/assets/js/332.20dffd14.js"><link rel="prefetch" href="/notebook/assets/js/333.d625fbd2.js"><link rel="prefetch" href="/notebook/assets/js/334.4fedc08a.js"><link rel="prefetch" href="/notebook/assets/js/335.c3b6c886.js"><link rel="prefetch" href="/notebook/assets/js/336.cf000555.js"><link rel="prefetch" href="/notebook/assets/js/337.891a7e6c.js"><link rel="prefetch" href="/notebook/assets/js/338.23da071e.js"><link rel="prefetch" href="/notebook/assets/js/34.f39f39b2.js"><link rel="prefetch" href="/notebook/assets/js/340.09cb4417.js"><link rel="prefetch" href="/notebook/assets/js/341.3591e649.js"><link rel="prefetch" href="/notebook/assets/js/342.568a9320.js"><link rel="prefetch" href="/notebook/assets/js/343.e61b523f.js"><link rel="prefetch" href="/notebook/assets/js/344.61bb135b.js"><link rel="prefetch" href="/notebook/assets/js/345.f861e5aa.js"><link rel="prefetch" href="/notebook/assets/js/346.c5c70e0f.js"><link rel="prefetch" href="/notebook/assets/js/347.9b389847.js"><link rel="prefetch" href="/notebook/assets/js/348.eb62b86e.js"><link rel="prefetch" href="/notebook/assets/js/349.d4852195.js"><link rel="prefetch" href="/notebook/assets/js/35.c31fd7ed.js"><link rel="prefetch" href="/notebook/assets/js/350.f1db6bfd.js"><link rel="prefetch" href="/notebook/assets/js/351.4d86adaf.js"><link rel="prefetch" href="/notebook/assets/js/36.624192b1.js"><link rel="prefetch" href="/notebook/assets/js/37.680f8e12.js"><link rel="prefetch" href="/notebook/assets/js/38.f9ecec66.js"><link rel="prefetch" href="/notebook/assets/js/39.afab4ce6.js"><link rel="prefetch" href="/notebook/assets/js/4.03ba6111.js"><link rel="prefetch" href="/notebook/assets/js/40.f66ecac0.js"><link rel="prefetch" href="/notebook/assets/js/41.87cdca0e.js"><link rel="prefetch" href="/notebook/assets/js/42.08461558.js"><link rel="prefetch" href="/notebook/assets/js/43.ad5cf182.js"><link rel="prefetch" href="/notebook/assets/js/44.0bb6ad3f.js"><link rel="prefetch" href="/notebook/assets/js/45.5d2af6d4.js"><link rel="prefetch" href="/notebook/assets/js/46.8a06257e.js"><link rel="prefetch" href="/notebook/assets/js/47.3e37541c.js"><link rel="prefetch" href="/notebook/assets/js/48.024eda4c.js"><link rel="prefetch" href="/notebook/assets/js/49.a0685cf7.js"><link rel="prefetch" href="/notebook/assets/js/5.1071c8dd.js"><link rel="prefetch" href="/notebook/assets/js/50.130eaac4.js"><link rel="prefetch" href="/notebook/assets/js/51.0fe4dbd0.js"><link rel="prefetch" href="/notebook/assets/js/52.9d0ae64a.js"><link rel="prefetch" href="/notebook/assets/js/53.1ca09933.js"><link rel="prefetch" href="/notebook/assets/js/54.679cd78c.js"><link rel="prefetch" href="/notebook/assets/js/55.95cbe3a2.js"><link rel="prefetch" href="/notebook/assets/js/56.a58ec2af.js"><link rel="prefetch" href="/notebook/assets/js/57.0e59339a.js"><link rel="prefetch" href="/notebook/assets/js/58.487f643f.js"><link rel="prefetch" href="/notebook/assets/js/59.a8e9a1e3.js"><link rel="prefetch" href="/notebook/assets/js/6.707a1f11.js"><link rel="prefetch" href="/notebook/assets/js/60.c3080f7a.js"><link rel="prefetch" href="/notebook/assets/js/61.7f77e449.js"><link rel="prefetch" href="/notebook/assets/js/62.a5528e33.js"><link rel="prefetch" href="/notebook/assets/js/63.a787a8ee.js"><link rel="prefetch" href="/notebook/assets/js/64.7d3edfda.js"><link rel="prefetch" href="/notebook/assets/js/65.80e083e6.js"><link rel="prefetch" href="/notebook/assets/js/66.4076f29c.js"><link rel="prefetch" href="/notebook/assets/js/67.cf46f254.js"><link rel="prefetch" href="/notebook/assets/js/68.6fc8b1fd.js"><link rel="prefetch" href="/notebook/assets/js/69.4a344d72.js"><link rel="prefetch" href="/notebook/assets/js/7.c507c0e3.js"><link rel="prefetch" href="/notebook/assets/js/70.b13eef1a.js"><link rel="prefetch" href="/notebook/assets/js/71.20ad9776.js"><link rel="prefetch" href="/notebook/assets/js/72.30f44ef6.js"><link rel="prefetch" href="/notebook/assets/js/73.857a629d.js"><link rel="prefetch" href="/notebook/assets/js/74.a2b5a703.js"><link rel="prefetch" href="/notebook/assets/js/75.252e6fc0.js"><link rel="prefetch" href="/notebook/assets/js/76.d64e4a53.js"><link rel="prefetch" href="/notebook/assets/js/77.40db9cc6.js"><link rel="prefetch" href="/notebook/assets/js/78.7a635d12.js"><link rel="prefetch" href="/notebook/assets/js/79.b2249421.js"><link rel="prefetch" href="/notebook/assets/js/8.a5f34392.js"><link rel="prefetch" href="/notebook/assets/js/80.d325f684.js"><link rel="prefetch" href="/notebook/assets/js/81.2e8d667e.js"><link rel="prefetch" href="/notebook/assets/js/82.885af8d1.js"><link rel="prefetch" href="/notebook/assets/js/83.b601bf2e.js"><link rel="prefetch" href="/notebook/assets/js/84.758d5dba.js"><link rel="prefetch" href="/notebook/assets/js/85.2e75fb85.js"><link rel="prefetch" href="/notebook/assets/js/86.6c68d815.js"><link rel="prefetch" href="/notebook/assets/js/87.8fba1553.js"><link rel="prefetch" href="/notebook/assets/js/88.e30608d9.js"><link rel="prefetch" href="/notebook/assets/js/89.be2f87c8.js"><link rel="prefetch" href="/notebook/assets/js/9.1c775f56.js"><link rel="prefetch" href="/notebook/assets/js/90.88dd69c4.js"><link rel="prefetch" href="/notebook/assets/js/91.59a69041.js"><link rel="prefetch" href="/notebook/assets/js/92.b46ca339.js"><link rel="prefetch" href="/notebook/assets/js/93.aeaec51d.js"><link rel="prefetch" href="/notebook/assets/js/94.5a852633.js"><link rel="prefetch" href="/notebook/assets/js/95.4f445663.js"><link rel="prefetch" href="/notebook/assets/js/96.6299f802.js"><link rel="prefetch" href="/notebook/assets/js/97.6cf3ba23.js"><link rel="prefetch" href="/notebook/assets/js/98.b48d73e6.js"><link rel="prefetch" href="/notebook/assets/js/99.f61a2e23.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.1b58b254.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/img/logo.png" alt="notebook" class="logo"> <span class="site-name can-hide">notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/notebook/computer-system/" class="nav-link">计算机系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-structure/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/notebook/major/" class="nav-link">计算机专业课</a></li><li class="dropdown-item"><!----> <a href="/notebook/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><!----> <span class="title" style="display:;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yubincloud.github.io/notebook-front/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/notebook/java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/" class="nav-link">Python 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/golang/" class="nav-link">Golang 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notebook/software-architecture/" class="nav-link">软件设计与架构</a></li><li class="dropdown-item"><!----> <a href="/notebook/distributed-system/" class="nav-link">大数据与分布式系统</a></li><li class="dropdown-item"><h4>常见开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据科学" class="dropdown-title"><!----> <span class="title" style="display:;">数据科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/data-science/spider/" class="nav-link">爬虫</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-science/py-data-analysis/" class="nav-link">Python 数据分析</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-warehouse/" class="nav-link">数据仓库</a></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/notebook/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notebook/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-subitem"><a href="/notebook/kafka/" class="nav-link">Kafka</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><!----> <span class="title" style="display:;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/deep-learning/" class="nav-link">深度学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/machine-learning/" class="nav-link">机器学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/kg/" class="nav-link">知识图谱</a></li><li class="dropdown-item"><!----> <a href="/notebook/gnn/" class="nav-link">图神经网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><!----> <span class="title" style="display:;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/security/application-security/" class="nav-link">应用安全</a></li><li class="dropdown-item"><!----> <a href="/notebook/security/penetration/" class="nav-link">渗透测试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/cloud-native/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><a href="/notebook/pages/interview/index/" class="nav-link">面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><!----> <span class="title" style="display:;">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/pages/my/favorite/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/notebook/pages/my/good-sentence/" class="nav-link">paper 好句</a></li></ul></div></div> <a href="https://github.com/yubincloud/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/head.jpg"> <div class="blogger-info"><h3>学习笔记</h3> <span>啦啦啦，向太阳~</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/notebook/computer-system/" class="nav-link">计算机系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-structure/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/notebook/major/" class="nav-link">计算机专业课</a></li><li class="dropdown-item"><!----> <a href="/notebook/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><!----> <span class="title" style="display:;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yubincloud.github.io/notebook-front/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/notebook/java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/" class="nav-link">Python 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/golang/" class="nav-link">Golang 开发</a></li><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notebook/software-architecture/" class="nav-link">软件设计与架构</a></li><li class="dropdown-item"><!----> <a href="/notebook/distributed-system/" class="nav-link">大数据与分布式系统</a></li><li class="dropdown-item"><h4>常见开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据科学" class="dropdown-title"><!----> <span class="title" style="display:;">数据科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/data-science/spider/" class="nav-link">爬虫</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-science/py-data-analysis/" class="nav-link">Python 数据分析</a></li><li class="dropdown-item"><!----> <a href="/notebook/data-warehouse/" class="nav-link">数据仓库</a></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/notebook/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notebook/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-subitem"><a href="/notebook/kafka/" class="nav-link">Kafka</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><!----> <span class="title" style="display:;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/deep-learning/" class="nav-link">深度学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/machine-learning/" class="nav-link">机器学习</a></li><li class="dropdown-item"><!----> <a href="/notebook/kg/" class="nav-link">知识图谱</a></li><li class="dropdown-item"><!----> <a href="/notebook/gnn/" class="nav-link">图神经网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安全" class="dropdown-title"><!----> <span class="title" style="display:;">安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/security/application-security/" class="nav-link">应用安全</a></li><li class="dropdown-item"><!----> <a href="/notebook/security/penetration/" class="nav-link">渗透测试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/cloud-native/" class="nav-link">云原生</a></li></ul></div></div><div class="nav-item"><a href="/notebook/pages/interview/index/" class="nav-link">面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><!----> <span class="title" style="display:;">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/pages/my/favorite/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/notebook/pages/my/good-sentence/" class="nav-link">paper 好句</a></li></ul></div></div> <a href="https://github.com/yubincloud/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>云原生</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>专栏-深入容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Kubernetes入门实战课-罗剑锋</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/cloud-native/k8s-practice/container-start/" class="sidebar-link">初识容器</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/k8s-install/" class="sidebar-link">Kubernetes 的安装与基本架构</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/pod-and-other/" class="sidebar-link">YAML、Pod、Job、CronJob、ConfigMap、Secret</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/deployment-and-other/" class="sidebar-link">Deployment、Daemonset、Service、Ingress</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/persistentvolume-and-other/" class="sidebar-link">PV、PVC、StorageClass、Provisioner、StatefulSet</a></li><li><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/" aria-current="page" class="active sidebar-link">滚动更新、应用保障、集群管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-滚动更新-如何做到平滑的应用升级降级" class="sidebar-link">1. 滚动更新：如何做到平滑的应用升级降级？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-1-kubernetes-如何定义应用版本" class="sidebar-link">1.1 Kubernetes 如何定义应用版本</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-2-kubernetes-如何实现应用更新" class="sidebar-link">1.2 Kubernetes 如何实现应用更新</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-3-kubernetes-如何管理应用更新" class="sidebar-link">1.3 Kubernetes 如何管理应用更新</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-4-kubernetes-如何添加更新描述" class="sidebar-link">1.4 Kubernetes 如何添加更新描述</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_1-5-小结" class="sidebar-link">1.5 小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_2-应用保障-如何让-pod-运行得更健康" class="sidebar-link">2. 应用保障：如何让 Pod 运行得更健康？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_2-1-容器资源配额" class="sidebar-link">2.1 容器资源配额</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_2-2-容器状态探针" class="sidebar-link">2.2 容器状态探针</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_2-3-如何使用容器状态探针" class="sidebar-link">2.3 如何使用容器状态探针</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_2-4-小结" class="sidebar-link">2.4 小结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-集群管理-如何用名字空间分隔系统资源" class="sidebar-link">3. 集群管理：如何用名字空间分隔系统资源？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-1-为什么要有-namespace" class="sidebar-link">3.1 为什么要有 Namespace</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-2-如何使用-namespace" class="sidebar-link">3.2 如何使用 Namespace</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-3-什么是资源配额" class="sidebar-link">3.3 什么是资源配额</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-4-如何使用资源配额" class="sidebar-link">3.4 如何使用资源配额</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-5-默认资源配额" class="sidebar-link">3.5 默认资源配额</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/cloud-native/k8s-practice/rollout-and-other/#_3-6-小结" class="sidebar-link">3.6 小结</a></li></ul></li></ul></li><li><a href="/notebook/pages/cloud-native/k8s-practice/metricssever-and-other/" class="sidebar-link">MetricsServer、Prometheus、CNI</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>深入剖析 Kubernetes-张磊</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/notebook/categories/?category=%E8%BF%90%E7%BB%B4" title="分类" data-v-06225672>运维</a></li><li data-v-06225672><a href="/notebook/categories/?category=%E4%BA%91%E5%8E%9F%E7%94%9F" title="分类" data-v-06225672>云原生</a></li><li data-v-06225672><a href="/notebook/categories/?category=Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B" title="分类" data-v-06225672>Kubernetes入门实战课-罗剑锋</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/yubincloud" target="_blank" title="作者" class="beLink" data-v-06225672>yubin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-04-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">滚动更新、应用保障、集群管理<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><blockquote><p>参考：<a href="https://time.geekbang.org/column/intro/100114501?tab=catalog" target="_blank" rel="noopener noreferrer">Kubernetes 入门实战课 | 极客时间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 第 27-29 讲</p></blockquote> <h2 id="_1-滚动更新-如何做到平滑的应用升级降级"><a href="#_1-滚动更新-如何做到平滑的应用升级降级" class="header-anchor">#</a> 1. 滚动更新：如何做到平滑的应用升级降级？</h2> <p>Deployment、DaemonSet 和 StatefulSet 让我们能够部署任意形式的应用了，但为了让应用稳定运行，还需要有持续的运维工作。之前学习的 <code>kubectl scale</code> 来调整 Deployment 或 StatefulSet 下属的 pod 数量就是一种常见的运维操作，但除了应用伸缩，我们还需要应用更新、版本回退等运维操作。</p> <p>这一章以 Deployment 为例，讲解 Kubernetes 在应用管理方面的高级操作：滚动更新，使用 <code>kubectl rollout</code> 实现用户无感知的应用升级和降级。</p> <h3 id="_1-1-kubernetes-如何定义应用版本"><a href="#_1-1-kubernetes-如何定义应用版本" class="header-anchor">#</a> 1.1 Kubernetes 如何定义应用版本</h3> <p>对一个线上运行的系统进行更新是一件棘手的事情，“给空中的飞机换引擎”，而 Kubernetes 把这个过程给抽象出来，让计算机去完成那些复杂繁琐的人工操作。</p> <p>K8s 中版本更新主要是两个命令：<strong>kubectl apply</strong> 和 <strong>kubectl rollout</strong>。</p> <p>首先我们需要知道所谓的“版本”是什么。Kubernetes 中应用都是以 Pod 来运行，而 Pod 又被 Deployment 管理，所以<strong>应用的“版本更新”实际上更新的是整个 Pod</strong>。而 Pod 其实又是 Deployment 对象中的 <code>template</code> 字段，所以 <strong>Kubernetes 中应用的版本变化就是 template 字段中 Pod 的变化</strong>。因此，哪怕 <code>template</code> 里只变动了一个字段，那也会形成一个新的版本，也算是版本变化。</p> <p>Kubernetes 使用摘要算法计算 <code>template</code> 里 Hash 值作为版本号，这虽不太方便识别，但很实用。</p> <p>我们以之前运行的 nginx 作为例子：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610194021.png" alt="20230610194021" style="zoom:75%;"></center> <p>名字中的随机数&quot;6796...&quot;就是 Pod 模板的 Hash 值，也就是 Pod 的“版本号”。如果你变动了 Deployment 下 template 中 Pod 的 YAML 任一描述，都会生成一个新的应用版本，kubectl apply 后就会重新创建 Pod：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610194221.png" alt="20230610194221" style="zoom:75%;"></center> <p>可以看到，Pod 名字中的 hash 值发生了变动，这表示 Pod 的版本更新了。</p> <h3 id="_1-2-kubernetes-如何实现应用更新"><a href="#_1-2-kubernetes-如何实现应用更新" class="header-anchor">#</a> 1.2 Kubernetes 如何实现应用更新</h3> <p>我们可以尝试进行应用更新，由于 Kubernetes 的动作太快了，为了能够观察到应用的更新过程，我们可以加一个字段 <code>minReadySeconds</code>，让 Kubernetes 在更新过程中等待一点时间，确认 Pod 没问题之后才继续其余 Pod 的创建工作：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>dep

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  minReadySeconds<span class="token punctuation">:</span> <span class="token number">15</span>      <span class="token comment"># 确认Pod就绪的等待时间</span>
  replicas<span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token punctuation">...</span> <span class="token punctuation">...</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.22<span class="token punctuation">-</span>alpine
  <span class="token punctuation">...</span> <span class="token punctuation">...</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>注意，<code>minReadySeconds</code> 这个字段不属于 Pod 模板，所以它不会影响 Pod 的版本。</p></blockquote> <p>当我们对 Deployment 对象中 template 字段下的 Pod 描述进行更改后，可以执行 <code>kubectl apply</code> 来更新应用，这个过程会触发“版本更新”，可以使用 <mark>kubectl rollout status</mark> 来查看应用更新的状态：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl apply -f ngx-v2.yml
kubectl rollout status deployment ngx-dep
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610195012.png" alt="20230610195012" style="zoom:75%;"></center> <p>更新完成之后，再去执行 <code>kubectl get pod</code> 就可以看到，Pod 已经全部替换成了新的版本号。</p> <p>仔细观察 <code>kubectl rollout status</code> 的输出信息可以发现，Kubernetes 并不是把旧的 Pod 全部销毁然后再一次性创建出来新的 Pod，而是<strong>逐个创建新 Pod，同时也在销毁旧 Pod，保证系统里始终有足够数量的 Pod 在运行，不会有“空窗期”中断服务</strong>。这就是<mark>滚动更新</mark>。</p> <p>使用命令 <code>kubectl describe</code> 可以更清楚地看到 Pod 的变化情况：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl describe deploy ngx-dep
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610200026.png" alt="20230610200026" style="zoom:75%;"></center> <ul><li>一开始的时候V1 Pod（即ngx-dep-54b865d75）的数量是4；</li> <li>当“滚动更新”开始的时候，Kubernetes创建1个 V2 Pod（即ngx-dep-d575d5776），并且把V1 Pod数量减少到3；</li> <li>接着再增加V2 Pod的数量到2，同时V1 Pod的数量变成了1；</li> <li>最后V2 Pod的数量达到预期值4，V1 Pod的数量变成了0，整个更新过程就结束了。</li></ul> <p>其实可以看出来，滚动更新的过程就是由 Deployment 控制的两个同步进行的“应用伸缩”操作，老版本缩容到 0，同时新版本扩容到指定值，是一个”此消彼长“的过程。</p> <p>这个滚动更新的过程可以参考下图：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610200244.png" alt="20230610200244" style="zoom:75%;"></center> <h3 id="_1-3-kubernetes-如何管理应用更新"><a href="#_1-3-kubernetes-如何管理应用更新" class="header-anchor">#</a> 1.3 Kubernetes 如何管理应用更新</h3> <p>当 Kubernetes 的滚动更新过程中发生了错误或者更新后发现有 Bug 该怎么办？</p> <p>要解决这两个问题，还是要用 <code>kubectl rollout</code> 命令：</p> <ul><li>在应用的更新过程中，你可以随时用 <strong>kubectl rollout pause</strong> 来暂停更新、检查和修改 Pod，或者测试验证；</li> <li>如果确认没问题，再用 <strong>kubectl rollout resume</strong> 来继续更新。</li></ul> <blockquote><p>要注意这两条命令只支持Deployment，不能用在DaemonSet、StatefulSet上（最新的1.24支持了StatefulSet的滚动更新）。</p></blockquote> <p>对于更新后出现的问题，Kubernetes为我们提供了“后悔药”，也就是<mark>更新历史</mark>，<strong>你可以查看之前的每次更新记录，并且回退到任何位置</strong>，和我们开发常用的Git等版本控制软件非常类似。</p> <p>查看更新历史使用的命令是 <strong>kubectl rollout history</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl rollout <span class="token function">history</span> deploy ngx-dep
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610200947.png" alt="20230610200947" style="zoom:75%;"></center> <p>但 <code>kubectl rollout history</code> 的列表输出的有用信息太少，你可以<strong>在命令后加上参数 <code>--revision</code> 来查看每个版本的详细信息</strong>，包括标签、镜像名、环境变量、存储卷等等，通过这些就可以大致了解每次都变动了哪些关键字段：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610201238.png" alt="20230610201238" style="zoom:75%;"></center> <p>假设我们认为刚刚更新的 <code>nginx:1.22-alpine</code> 不好，<strong>想要回退到上一个版本，就可以使用命令 <code>kubectl rollout undo</code>，也可以加上参数 <code>--to-revision</code> 回退到任意一个历史版本</strong>：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610201330.png" alt="20230610201330" style="zoom:75%;"></center> <p><code>kubectl rollout undo</code> 的操作过程其实和 <code>kubectl apply</code> 是一样的，执行的仍然是“滚动更新”，只不过使用的是旧版本Pod模板，把新版本Pod数量收缩到0，同时把老版本Pod扩展到指定值。</p> <p>这个V2到V1的“版本降级”的过程如下图，它和“版本升级”过程是完全一样的，不同的只是版本号的变化方向：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610201411.png" alt="20230610201411" style="zoom:75%;"></center> <h3 id="_1-4-kubernetes-如何添加更新描述"><a href="#_1-4-kubernetes-如何添加更新描述" class="header-anchor">#</a> 1.4 Kubernetes 如何添加更新描述</h3> <p>每次版本更新时，能不能加一个说明信息呢？</p> <p>可以，<strong>只需要在 Deployment 的 metadata 里加上一个新的字段 annotations</strong>。</p> <p><code>annotations</code> 字段的含义是“注解”“注释”，形式上和 <code>labels</code> 一样，都是Key-Value，也都是给API对象附加一些额外的信息，但是用途上区别很大：</p> <ul><li><code>annotations</code> 添加的信息一般是给Kubernetes内部的各种对象使用的，有点像是“扩展属性”；</li> <li><code>labels</code> 主要面对的是Kubernetes外部的用户，用来筛选、过滤对象的。</li></ul> <p>如果用一个简单的比喻来说呢，<strong><code>annotations</code> 就是包装盒里的产品说明书，而 <code>labels</code> 是包装盒外的标签贴纸</strong>。借助 <code>annotations</code>，Kubernetes既不破坏对象的结构，也不用新增字段，就能够给API对象添加任意的附加信息，这就是面向对象设计中典型的OCP“开闭原则”，让对象更具扩展性和灵活性。</p> <p><code>annotations</code> 里的值可以任意写，Kubernetes会自动忽略不理解的Key-Value，但要编写更新说明就需要使用特定的字段 <strong>kubernetes.io/change-cause</strong>。</p> <p>如下是 3 个版本的 nginx 应用，同时里面含有更新说明：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>dep
  annotations<span class="token punctuation">:</span>
    kubernetes.io/change<span class="token punctuation">-</span><span class="token key atrule">cause</span><span class="token punctuation">:</span> v1<span class="token punctuation">,</span> ngx=1.21
<span class="token punctuation">...</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>dep
  annotations<span class="token punctuation">:</span>
    kubernetes.io/change<span class="token punctuation">-</span><span class="token key atrule">cause</span><span class="token punctuation">:</span> update to v2<span class="token punctuation">,</span> ngx=1.22
<span class="token punctuation">...</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>dep
  annotations<span class="token punctuation">:</span>
    kubernetes.io/change<span class="token punctuation">-</span><span class="token key atrule">cause</span><span class="token punctuation">:</span> update to v3<span class="token punctuation">,</span> change name
<span class="token punctuation">...</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意以上三个版本的 metadata 部分，使用 <code>kubernetes.io/change-cause</code> 描述了版本更新的情况，这样更新版本之后，我们在使用 <code>kubectl rollout history</code> 命令就可以看到更新历史：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610201936.png" alt="20230610201936" style="zoom:75%;"></center> <p>这次显示的列表信息就好看多了，每个版本的主要变动情况列得非常清楚，和Git版本管理的感觉很像。</p> <h3 id="_1-5-小结"><a href="#_1-5-小结" class="header-anchor">#</a> 1.5 小结</h3> <p>这一章主要讲的滚动更新，小结一下要点：</p> <ol><li>Kubernetes 使用 template 的 hash 值作为版本号。</li> <li>Kubernetes 的更新过程是滚动更新，保证了在更新过程中服务的始终可用。</li> <li>管理应用更新使用的命令是 <code>kubectl rollout</code>，子命令有 <code>status</code>、 <code>history</code>、 <code>undo</code> 等。</li> <li>Kubernetes会记录应用的更新历史，可以使用 <code>history --revision</code> 查看每个版本的详细信息，也可以在每次更新时添加注解 <code>kubernetes.io/change-cause</code>。</li></ol> <p>另外，在Deployment里还有其他一些字段可以对滚动更新的过程做更细致的控制，它们都在 <code>spec.strategy.rollingUpdate</code> 里，比如 <code>maxSurge</code>、 <code>maxUnavailable</code> 等字段，分别控制最多新增Pod数和最多不可用Pod数，一般用默认值就足够了，你如果感兴趣也可以查看Kubernetes文档进一步研究。</p> <p>课外小贴士：</p> <ul><li>Deployment 在版本更新的时候实际控制的是 ReplicaSet 对象，创建不同版本的 ReplicaSet，再由 ReplicaSet 来伸缩 Pod 数量。</li> <li>除了使用 kubectl apply 来触发应用更新，你也可以使用其他任何能够修改 API 对象的方式，比如 kubectl edit、kubectl patch、kubectl set image 等命令。</li> <li>Kubernetes 不会记录所有的更新历史，默认只会保留最近的 10 次操作，但这个值可以用字段 revisionHistoryLimit 调整。</li></ul> <h2 id="_2-应用保障-如何让-pod-运行得更健康"><a href="#_2-应用保障-如何让-pod-运行得更健康" class="header-anchor">#</a> 2. 应用保障：如何让 Pod 运行得更健康？</h2> <p>作为Kubernetes里的核心概念和原子调度单位，Pod的主要职责是管理容器，以逻辑主机、容器集合、进程组的形式来代表应用，它的重要性是不言而喻的。</p> <p>这一章回过头来看看 Pod 里面的两种配置：资源配额Resources、检查探针Probe。它们能够给Pod添加各种运行保障，让应用运行得更健康。</p> <h3 id="_2-1-容器资源配额"><a href="#_2-1-容器资源配额" class="header-anchor">#</a> 2.1 容器资源配额</h3> <p>容器有三大隔离技术：namespace、cgroup、chroot。其中的 namespace 实现了独立的进程空间，chroot 实现了独立的文件系统，而 cgroup 的作用是管控CPU、内存，保证容器不会无节制地占用基础资源，进而影响到系统里的其他应用。</p> <p>但容器总是要使用CPU和内存的，该怎么处理好需求与限制这两者之间的关系呢？</p> <p>Kubernetes 的做法是，容器需要先提出一个“书面申请”，Kubernetes再依据这个“申请”决定资源是否分配和如何分配。由于 CPU、内存等是直接内置在节点系统中的，不需要像存储卷那样“外挂”，所以申请和管理的过程就简单了许多。</p> <p>具体的申请方法很简单，<strong>只要在Pod容器的描述部分添加一个新字段 <code>resources</code> 就可以了</strong>，它就相当于申请资源的 Claim。如下是一个 YAML 示例：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>resources

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx

    resources<span class="token punctuation">:</span>
      requests<span class="token punctuation">:</span>
        cpu<span class="token punctuation">:</span> 10m
        memory<span class="token punctuation">:</span> 100Mi
      limits<span class="token punctuation">:</span>
        cpu<span class="token punctuation">:</span> 20m
        memory<span class="token punctuation">:</span> 200Mi
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这个YAML文件定义了一个Nginx Pod，我们需要重点学习的是 <code>containers.resources</code>，它下面有两个字段：</p> <ul><li><strong>requests</strong>：意思是容器要申请的资源，也就是说要求Kubernetes在创建Pod的时候必须分配这里列出的资源，否则容器就无法运行。</li> <li><strong>limits</strong>：意思是容器使用资源的上限，不能超过设定值，否则就有可能被强制停止运行。</li></ul> <p>在请求 <code>cpu</code> 和 <code>memory</code> 这两种资源的时候，你需要特别注意它们的表示方式。</p> <p>内存的写法和磁盘容量一样，使用 <code>Ki</code>、 <code>Mi</code>、 <code>Gi</code> 来表示 <code>KB</code>、 <code>MB</code>、 <code>GB</code>，比如 <code>512Ki</code>、 <code>100Mi</code>、 <code>0.5Gi</code> 等。</p> <p>而CPU因为在计算机中数量有限，非常宝贵，所以Kubernetes允许容器精细分割CPU，即可以1个、2个地完整使用CPU，也可以用小数0.1、0.2的方式来部分使用CPU。这其实是效仿了UNIX“时间片”的用法，意思是进程最多可以占用多少CPU时间。</p> <p>不过CPU时间也不能无限分割，<strong>Kubernetes里CPU的最小使用单位是0.001，为了方便表示用了一个特别的单位 <code>m</code></strong>，也就是“milli”“毫”的意思，比如说500m就相当于0.5。</p> <p>现在我们再来看这个YAML，你就应该明白了，它向系统申请的是1%的CPU时间和100MB的内存，运行时的资源上限是2%CPU时间和200MB内存。<strong>有了这个申请，Kubernetes就会在集群中查找最符合这个资源要求的节点去运行Pod</strong>。</p> <p>如果 Pod 不写 <code>resources</code> 字段，那就意味着 Pod 对运行的资源要求“既没有下限，也没有上限“，Kubernetes 不用管CPU和内存是否足够，可以把 Pod 调度到任意的节点上，而且后续 Pod 运行时也可以无限制地使用 CPU 和内存。在生产环境下，为避免 Pod 因资源不足而运行缓慢或占用太多资源，应当合理评估 Pod 的资源使用情况，并尽量为 Pod 加上限制。</p> <p>那如果预估错误导致 Pod 申请的资源过多，而系统无法满足会怎么样？我们尝试让 Pod 申请 10 个 CPU，可以发现，API 对象可以创建成功，但当我们使用 <code>kubectl get pod</code> 去查看时，会发现它一直处于 &quot;Pending&quot; 状态，实际上没有被真正调度：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610204510.png" alt="20230610204510" style="zoom:75%;"></center> <p>如果我们使用命令 <code>kubectl describe</code> 来查看具体原因，会发现有这么一句提示：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610204541.png" alt="20230610204541" style="zoom:75%;"></center> <p>这就很明确地告诉我们Kubernetes调度失败，当前集群里的所有节点都无法运行这个Pod，因为它要求的CPU实在是太多了。</p> <h3 id="_2-2-容器状态探针"><a href="#_2-2-容器状态探针" class="header-anchor">#</a> 2.2 容器状态探针</h3> <p>当一个程序正常启动后，也有可能在运行时发生死锁或死循环等故障，这时在外部看进程一切正常，但在内部已经是一团糟了。所以，我们还希望Kubernetes这个“保姆”能够更细致地监控Pod的状态，除了保证崩溃重启，还必须要能够探查到Pod的内部运行状态，定时给应用做“体检”，让应用时刻保持“健康”，能够满负荷稳定工作。</p> <p>那应该用什么手段来检查应用的健康状态呢？</p> <p>由于各种程序对外界来说就是一个黑盒子，只能看到启动、执行、停止这三个基本状态，此外就没有什么好的办法来知道它内部是否正常了。所以我们必须把应用变成灰盒子，让部分内部信息对外可见，这样Kubernetes才能够探查到内部的状态。</p> <p>这里的检查过程就有点像核酸检测，Kubernetes 使用<mark>探针</mark>（Probe）在应用的检查口去提取信息，然后根据这些信息来判断应用是否健康。</p> <p>Kubernetes 为检查应用状态定义了三种探针，它们分别对应容器不同的状态：</p> <ul><li><strong>Startup</strong>，启动探针，用来检查应用是否已经启动成功，适合那些有大量初始化工作要做，启动很慢的应用。</li> <li><strong>Liveness</strong>，存活探针，用来检查应用是否正常运行，是否存在死锁、死循环。</li> <li><strong>Readiness</strong>，就绪探针，用来检查应用是否可以接收流量，是否能够对外提供服务。</li></ul> <p>你需要注意这三种探针是递进的关系：应用程序先启动，加载完配置文件等基本的初始化数据就进入了Startup状态，之后如果没有什么异常就是Liveness存活状态，但可能有一些准备工作没有完成，还不一定能对外提供服务，只有到最后的Readiness状态才是一个容器最健康可用的状态。</p> <p>这三个状态与探针的关系如下图：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610205028.png" alt="20230610205028" style="zoom:75%;"></center> <p>那 Kubernetes 具体是如何使用状态和探针来管理容器的呢？</p> <p>如果一个 Pod 里的容器配置了探针，<strong>Kubernetes 在启动容器后就会不断地调用探针来检查容器的状态</strong>：</p> <ul><li>如果Startup探针失败，Kubernetes会认为容器没有正常启动，就会尝试反复重启，当然其后面的Liveness探针和Readiness探针也不会启动。</li> <li>如果Liveness探针失败，Kubernetes就会认为容器发生了异常，也会重启容器。</li> <li>如果Readiness探针失败，Kubernetes会认为容器虽然在运行，但内部有错误，不能正常提供服务，就会把容器从Service对象的负载均衡集合中排除，不会给它分配流量。</li></ul> <p>知道了Kubernetes对这三种状态的处理方式，我们就可以在开发应用的时候编写适当的检查机制，让Kubernetes用“探针”定时为应用做“体检”了。</p> <p>下图在刚才图的基础上，又补充上了 k8s 的处理动作，从这张图就可以很好地理解容器探针的工作流程了：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610205223.png" alt="20230610205223" style="zoom:75%;"></center> <h3 id="_2-3-如何使用容器状态探针"><a href="#_2-3-如何使用容器状态探针" class="header-anchor">#</a> 2.3 如何使用容器状态探针</h3> <p>我们看看如何在 Pod 的 YAML 描述文件里定义探针。</p> <p>startupProbe、livenessProbe、readinessProbe这三种探针的配置方式都是一样的，关键字段有这么几个：</p> <ul><li><strong>periodSeconds</strong>，执行探测动作的时间间隔，默认是10秒探测一次。</li> <li><strong>timeoutSeconds</strong>，探测动作的超时时间，如果超时就认为探测失败，默认是1秒。</li> <li><strong>successThreshold</strong>，连续几次探测成功才认为是正常，对于startupProbe和livenessProbe来说它只能是1。</li> <li><strong>failureThreshold</strong>，连续探测失败几次才认为是真正发生了异常，默认是3次。</li></ul> <p>至于探测方式，Kubernetes 支持3种：Shell、TCP Socket、HTTP GET，它们也需要在探针里配置：</p> <ul><li><strong>exec</strong>，执行一个Linux命令，比如ps、cat等等，和container的command字段很类似。</li> <li><strong>tcpSocket</strong>，使用TCP协议尝试连接容器的指定端口。</li> <li><strong>httpGet</strong>，连接端口并发送HTTP GET请求。</li></ul> <p>要使用这些探针，我们必须要在开发应用时预留出“检查口”，这样Kubernetes才能调用探针获取信息。这里我还是以Nginx作为示例，用ConfigMap编写一个配置文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>conf

<span class="token key atrule">data</span><span class="token punctuation">:</span>
  default.conf<span class="token punctuation">:</span> <span class="token punctuation">|</span>
    server <span class="token punctuation">{</span>
      listen 80;
      location = /ready <span class="token punctuation">{</span>
        return 200 'I am ready';
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>在这个配置文件里，我们启用了80端口，然后用 <code>location</code> 指令定义了HTTP路径 <code>/ready</code>，它作为对外暴露的“检查口”，用来检测就绪状态，返回简单的200状态码和一个字符串表示工作正常。</li></ul> <p>现在我们来看一下Pod里三种探针的具体定义：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>probe

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  volumes<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>conf<span class="token punctuation">-</span>vol
    configMap<span class="token punctuation">:</span>
      name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>conf

  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx
    ports<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    volumeMounts<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/nginx/conf.d
      name<span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>conf<span class="token punctuation">-</span>vol

    startupProbe<span class="token punctuation">:</span>
      periodSeconds<span class="token punctuation">:</span> <span class="token number">1</span>
      exec<span class="token punctuation">:</span>
        command<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/var/run/nginx.pid&quot;</span><span class="token punctuation">]</span>

    livenessProbe<span class="token punctuation">:</span>
      periodSeconds<span class="token punctuation">:</span> <span class="token number">10</span>
      tcpSocket<span class="token punctuation">:</span>
        port<span class="token punctuation">:</span> <span class="token number">80</span>

    readinessProbe<span class="token punctuation">:</span>
      periodSeconds<span class="token punctuation">:</span> <span class="token number">5</span>
      httpGet<span class="token punctuation">:</span>
        path<span class="token punctuation">:</span> /ready
        port<span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>StartupProbe使用了Shell方式，使用 <code>cat</code> 命令检查Nginx存在磁盘上的进程号文件（/var/run/nginx.pid），如果存在就认为是启动成功，它的执行频率是每秒探测一次。</p> <p>LivenessProbe使用了TCP Socket方式，尝试连接Nginx的80端口，每10秒探测一次。</p> <p>ReadinessProbe使用的是HTTP GET方式，访问容器的 <code>/ready</code> 路径，每5秒发一次请求。</p> <p>现在我们用 <code>kubectl apply</code> 创建这个Pod，可以成功运行，之后探针的检查应该都是正常的，你可以用 <code>kubectl logs</code> 来看一下 nginx 的访问日志，里面记录了 HTTP GET 探针的执行情况：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610205659.png" alt="20230610205659" style="zoom:75%;"></center> <p>从截图中你可以看到，Kubernetes正是以大约5秒一次的频率，向URI <code>/ready</code> 发送HTTP请求，不断地检查容器是否处于就绪状态。</p> <p>如果探针探测失败且 Kubernetes 认为你的程序不健康后，便会采取处理措施。比如当 StartupProbe 探测失败的时候，Kubernetes 就会不停地重启容器，现象就是 kubectl get pod 中打印的 <code>RESTARTS</code> 次数不断增加：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610205852.png" alt="20230610205852" style="zoom:75%;"></center> <h3 id="_2-4-小结"><a href="#_2-4-小结" class="header-anchor">#</a> 2.4 小结</h3> <p>这一章讲了两种为 Pod 配置运行保障的方式：Resources 和 Probe。Resources 就是为容器加上资源限制，而 Probe 就是主动健康检查，让 Kubernetes 实时地监控应用的运行状态。</p> <p>简单小结一下今天的内容：</p> <ol><li>资源配额使用的是cgroup技术，可以限制容器使用的CPU和内存数量，让Pod合理利用系统资源，也能够让Kubernetes更容易调度Pod。</li> <li>Kubernetes定义了Startup、Liveness、Readiness三种健康探针，它们分别探测应用的启动、存活和就绪状态。</li> <li>探测状态可以使用Shell、TCP Socket、HTTP Get三种方式，还可以调整探测的频率和超时时间等参数。</li></ol> <p>课外小贴士：</p> <ul><li>现在的服务器都是多核 CPU，在 Kubernetes 里的“CPU”指的是“逻辑 CPU”，也就是操作系统里能够看到的 CPU。</li> <li>StartupProbe 和 livenessProbe 探测失败后的动作其实是由字段“restartPolicy”决定的，它的默认值“On-Failure”就是重启容器。</li> <li>探针可以配置“initialDelaySeconds”字段，表示容器启动后多久才执行探针动作，适用于某些启动比较慢的应用，它的默认值是 0。</li> <li>在容器里还可以配置 lifecycle 字段，在启动后和终止前安装两个钩子：postStart 和 preStop，执行 Shell 命令或者发送 HTTP 请求做一些初始化和收尾工作。</li></ul> <h2 id="_3-集群管理-如何用名字空间分隔系统资源"><a href="#_3-集群管理-如何用名字空间分隔系统资源" class="header-anchor">#</a> 3. 集群管理：如何用名字空间分隔系统资源？</h2> <p>之前学习了如何保障 Pod 很好地运行，那在集群层次，有没有类似的方法来为 Kubernetes 提供运行保障呢？Kubernetes 提供了很多手段来管理、控制集群的资源。</p> <h3 id="_3-1-为什么要有-namespace"><a href="#_3-1-为什么要有-namespace" class="header-anchor">#</a> 3.1 为什么要有 Namespace</h3> <p><strong>Kubernetes 中的 Namespace 并不是一个实体对象，而是一个逻辑上的概念</strong>。它可以把集群切分成一个个彼此独立的区域，然后我们把对象放到这些区域里，应用就只能在自己的 Namespace 中分配资源和运行，不会干扰到其他 Namespace 中的应用。</p> <p>Namespace 是 Kubernetes 面对大规模集群、海量节点时的一种现实考虑，因为当集群很大时，难免出现资源争抢和命名冲突等问题。所以当多团队、多项目共用 Kubernetes 时，为了避免这些问题的出现，我们就需要把集群给适当地“局部化”，为每一类用户创建出只属于它自己的“工作空间”。</p> <h3 id="_3-2-如何使用-namespace"><a href="#_3-2-如何使用-namespace" class="header-anchor">#</a> 3.2 如何使用 Namespace</h3> <p>Namespace 也是一种 API 对象，简称为 <strong>ns</strong>。</p> <p>命令 <code>kubectl create ns &lt;名称&gt;</code> 就可以很容易地创建一个名字空间：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl create ns test-ns
kubectl get ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Kubernetes 初始化集群的时候也会预设4个 Namespace：default、kube-system、kube-public、kube-node-lease。我们常用的是前两个，<code>default</code> 是用户对象默认的 Namespace，<code>kube-system</code> 是系统组件所在的 Namespace，相信你对它们已经很熟悉了。</p> <p><strong>想要把一个对象放入特定的名字空间，需要在它的 <code>metadata</code> 里添加一个 <code>namespace</code> 字段</strong>，比如我们要在“test-ns”里创建一个简单的Nginx Pod，就要这样写：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> ngx
  namespace<span class="token punctuation">:</span> test<span class="token punctuation">-</span>ns

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  containers<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    name<span class="token punctuation">:</span> ngx
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>kubectl apply</code> 创建这个对象之后，我们直接用 <code>kubectl get</code> 是看不到它的，因为默认查看的是“default”的 Namespace，<strong>想要操作其他 Namespace 的对象必须要用 <code>-n</code> 参数明确指定</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl get pod -n test-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为名字空间里的对象都从属于 Namespace，所以在删除名字空间的时候一定要小心，<strong>一旦名字空间被删除，它里面的所有对象也都会消失</strong>。</p> <p>可以执行 <code>kubectl delete ns &lt;名称&gt;</code> 来删除一个 Namespace。</p> <p>会发现删除 Namespace 后，它里面的Pod也会无影无踪了。</p> <h3 id="_3-3-什么是资源配额"><a href="#_3-3-什么是资源配额" class="header-anchor">#</a> 3.3 什么是资源配额</h3> <p>有了名字空间，我们就可以像管理容器一样，给名字空间设定配额，把整个集群的计算资源分割成不同的大小，按需分配给团队或项目使用。不过集群和单机不一样，除了限制最基本的CPU和内存，还必须限制各种对象的数量，否则对象之间也会互相挤占资源。</p> <p>名字空间的资源配额需要使用一个专门的 API 对象，叫做 <mark>ResourceQuota</mark>，简称是 <strong>quota</strong>。因为资源配额对象必须依附在某个名字空间上，所以在它的描述文件的 <code>metadata</code> 字段里必须明确写出 <code>namespace</code>（否则就会应用到default名字空间）。</p> <p>下面我们先创建一个名字空间“dev-ns”，再创建一个资源配额对象“dev-qt”：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> dev<span class="token punctuation">-</span>ns

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ResourceQuota
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> dev<span class="token punctuation">-</span>qt
  namespace<span class="token punctuation">:</span> dev<span class="token punctuation">-</span>ns

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ResourceQuota对象的使用方式比较灵活，既可以限制整个名字空间的配额，也可以只限制某些类型的对象（使用scopeSelector），今天我们看第一种，它需要在 <code>spec</code> 里使用 <code>hard</code> 字段，意思就是“<strong>硬性全局限制</strong>”。</p> <p>在 ResourceQuota 里可以设置各类资源配额，字段非常多，我简单地归了一下类，你可以课后再去官方文档上查找详细信息：</p> <ul><li>CPU和内存配额，使用 <code>request.*</code>、 <code>limits.*</code>，这是和容器资源限制是一样的。</li> <li>存储容量配额，使 <code>requests.storage</code> 限制的是PVC的存储总量，也可以用 <code>persistentvolumeclaims</code> 限制PVC的个数。</li> <li>核心对象配额，使用对象的名字（英语复数形式），比如 <code>pods</code>、 <code>configmaps</code>、 <code>secrets</code>、 <code>services</code>。</li> <li>其他API对象配额，使用 <code>count/name.group</code> 的形式，比如 <code>count/jobs.batch</code>、 <code>count/deployments.apps</code>。</li></ul> <p>下面的这个YAML就是一个比较完整的资源配额对象：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ResourceQuota
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>qt
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>ns

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  hard<span class="token punctuation">:</span>
    requests.cpu<span class="token punctuation">:</span> <span class="token number">10</span>
    requests.memory<span class="token punctuation">:</span> 10Gi
    limits.cpu<span class="token punctuation">:</span> <span class="token number">10</span>
    limits.memory<span class="token punctuation">:</span> 20Gi

    requests.storage<span class="token punctuation">:</span> 100Gi
    persistentvolumeclaims<span class="token punctuation">:</span> <span class="token number">100</span>

    pods<span class="token punctuation">:</span> <span class="token number">100</span>
    configmaps<span class="token punctuation">:</span> <span class="token number">100</span>
    secrets<span class="token punctuation">:</span> <span class="token number">100</span>
    services<span class="token punctuation">:</span> <span class="token number">10</span>

    count/jobs.batch<span class="token punctuation">:</span> <span class="token number">1</span>
    count/cronjobs.batch<span class="token punctuation">:</span> <span class="token number">1</span>
    count/deployments.apps<span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>我来稍微解释一下它为名字空间加上的全局资源配额：</p> <ul><li>所有Pod的需求总量最多是10个CPU和10GB的内存，上限总量是10个CPU和20GB的内存。</li> <li>只能创建100个PVC对象，使用100GB的持久化存储空间。</li> <li>只能创建100个Pod，100个ConfigMap，100个Secret，10个Service。</li> <li>只能创建1个Job，1个CronJob，1个Deployment。</li></ul> <p>这个YAML文件比较大，字段比较多，如果你觉得不是太容易阅读的话，也可以把它拆成几个小的YAML，分类限制资源数量，也许会更灵活一些。</p> <h3 id="_3-4-如何使用资源配额"><a href="#_3-4-如何使用资源配额" class="header-anchor">#</a> 3.4 如何使用资源配额</h3> <p>现在让我们用 <code>kubectl apply</code> 创建这个资源配额对象，然后用 <code>kubectl get</code> 查看，记得要用 <code>-n</code> 指定名字空间：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl apply -f quota-ns.yml
kubectl get <span class="token function">quota</span> -n dev-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610214610.png" alt="20230610214610" style="zoom:75%;"></center> <p>你可以看到输出了ResourceQuota的全部信息，但都挤在了一起，看起来很困难，这时可以再用命令 <code>kubectl describe</code> 来查看对象，它会给出一个清晰的表格：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610214628.png" alt="20230610214628" style="zoom:75%;"></center> <p>现在让我们尝试在这个名字空间里运行两个busybox Job，同样要加上 <code>-n</code> 参数：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl create job echo1 -n dev-ns --image<span class="token operator">=</span>busybox -- <span class="token builtin class-name">echo</span> hello
kubectl create job echo2 -n dev-ns --image<span class="token operator">=</span>busybox -- <span class="token builtin class-name">echo</span> hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610214722.png" alt="20230610214722" style="zoom:75%;"></center> <p>ResourceQuota限制了名字空间里最多只能有一个Job，所以创建第二个Job对象时会失败，提示超出了资源配额。再用命令 <code>kubectl describe</code> 来查看，也会发现Job资源已经到达了上限：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610214910.png" alt="20230610214910" style="zoom:75%;"></center> <p>只有删除掉第一个 Job，第二个 Job 才能运行。</p> <h3 id="_3-5-默认资源配额"><a href="#_3-5-默认资源配额" class="header-anchor">#</a> 3.5 默认资源配额</h3> <p>学到这里估计你也发现了，在名字空间加上了资源配额限制之后，它会有一个合理但比较“烦人”的约束：要求所有在里面运行的Pod都必须用字段 <code>resources</code> 声明资源需求，否则就无法创建。</p> <p>比如说，现在我们想用命令 <code>kubectl run</code> 创建一个Pod：<code>kubectl run ngx --image=nginx:alpine -n dev-ns</code>，你会发现会给出一个“Forbidden”的错误提示，说不满足配额要求。</p> <p>Kubernetes这样做的原因也很好理解，上一讲里我们说过，如果Pod里没有 <code>resources</code> 字段，就可以无限制地使用CPU和内存，这显然与名字空间的资源配额相冲突。<strong>为了保证名字空间的资源总量可管可控，Kubernetes就只能拒绝创建这样的Pod了</strong>。</p> <p>这个约束对于集群管理来说是好事，但对于普通用户来说却带来了一点麻烦，本来YAML文件就已经够大够复杂的了，现在还要再增加几个字段，再费心估算它的资源配额。如果有很多小应用、临时Pod要运行的话，这样做的人力成本就比较高，不是太划算。</p> <p>那么能不能让Kubernetes自动为Pod加上资源限制呢？也就是说给个默认值，这样就可以省去反复设置配额的烦心事。这个时候就要用到一个很小但很有用的辅助对象了—— <mark>LimitRange</mark>，简称是 <strong>limits</strong>，<strong>它能为API对象添加默认的资源配额限制</strong>。</p> <p>你可以用命令 <code>kubectl explain limits</code> 来查看它的YAML字段详细说明，这里说几个要点：</p> <ul><li><code>spec.limits</code> 是它的核心属性，描述了默认的资源限制。</li> <li><code>type</code> 是要限制的对象类型，可以是 <code>Container</code>、 <code>Pod</code>、 <code>PersistentVolumeClaim</code>。</li> <li><code>default</code> 是默认的资源上限，对应容器里的 <code>resources.limits</code>，只适用于 <code>Container</code>。</li> <li><code>defaultRequest</code> 默认申请的资源，对应容器里的 <code>resources.requests</code>，同样也只适用于 <code>Container</code>。</li> <li><code>max</code>、 <code>min</code> 是对象能使用的资源的最大最小值。</li></ul> <p>这个YAML就示范了一个LimitRange对象：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> LimitRange
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> dev<span class="token punctuation">-</span>limits
  namespace<span class="token punctuation">:</span> dev<span class="token punctuation">-</span>ns

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  limits<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Container
    defaultRequest<span class="token punctuation">:</span>
      cpu<span class="token punctuation">:</span> 200m
      memory<span class="token punctuation">:</span> 50Mi
    default<span class="token punctuation">:</span>
      cpu<span class="token punctuation">:</span> 500m
      memory<span class="token punctuation">:</span> 100Mi
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Pod
    max<span class="token punctuation">:</span>
      cpu<span class="token punctuation">:</span> 800m
      memory<span class="token punctuation">:</span> 200Mi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>它设置了每个容器默认申请0.2的CPU和50MB内存，容器的资源上限是0.5的CPU和100MB内存，每个Pod的最大使用量是0.8的CPU和200MB内存。</p> <p>使用 <code>kubectl apply</code> 创建LimitRange之后，再用 <code>kubectl describe</code> 就可以看到它的状态：</p> <center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20230610215426.png" alt="20230610215426" style="zoom:75%;"></center> <p>现在我们就可以不用编写 <code>resources</code> 字段直接创建Pod了，再运行之前的 <code>kubectl run</code> 命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kubectl run ngx --image<span class="token operator">=</span>nginx:alpine -n dev-ns
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有了这个默认的资源配额作为“保底”，这次就没有报错，Pod顺利创建成功，用 <code>kubectl describe</code> 查看Pod的状态，也可以看到LimitRange为它自动加上的资源配额。</p> <h3 id="_3-6-小结"><a href="#_3-6-小结" class="header-anchor">#</a> 3.6 小结</h3> <p>这一章主要讲了如何使用 Namespace 来管理 Kubernetes 的集群资源。在生产环境中，为避免某些用户过度消耗资源，就非常有必要用名字空间做好集群的资源规划了。</p> <p>简单小结一下内容：</p> <ol><li>名字空间是一个逻辑概念，没有实体，它的目标是为资源和对象划分出一个逻辑边界，避免冲突。</li> <li>ResourceQuota 对象可以为名字空间添加资源配额，限制全局的CPU、内存和API对象数量。</li> <li>LimitRange 对象可以为容器或者Pod添加默认的资源配额，简化对象的创建工作。</li></ol> <p>课外小贴士：</p> <ul><li>不是所有的 API 对象都可以划分进名字空间管理的比如 Node、PV 等这样的全局资源就不属于任何名字空间。</li> <li>因为 ResourceQuota 可以使用 scopeSelector 字段限制不同类型的对象，所以我们还可以在名字空间里设置多个不同策略的配额对象，更精细地控制资源。</li> <li>在 LimitRange 对象里设置“max”字段可以有效地防止创建意外申请超量资源的对象。</li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yubincloud/notebook/edit/master/docs/运维/05.云原生/18.Kubernetes入门实战课-罗剑锋/26.滚动更新、应用保障、集群管理.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/10, 13:58:30</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/cloud-native/k8s-practice/persistentvolume-and-other/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">PV、PVC、StorageClass、Provisioner、StatefulSet</div></a> <a href="/notebook/pages/cloud-native/k8s-practice/metricssever-and-other/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MetricsServer、Prometheus、CNI</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notebook/pages/cloud-native/k8s-practice/persistentvolume-and-other/" class="prev">PV、PVC、StorageClass、Provisioner、StatefulSet</a></span> <span class="next"><a href="/notebook/pages/cloud-native/k8s-practice/metricssever-and-other/">MetricsServer、Prometheus、CNI</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/notebook/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/notebook/pages/ml/lhy/drl17/"><div>
            Deep Reinforcement Learning
            <!----></div></a> <span class="date">10-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/notebook/pages/mysql/geektime/misdeletion/"><div>
            误删数据后怎么办
            <!----></div></a> <span class="date">04-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/notebook/pages/mysql/geektime/multi-slaves/"><div>
            MySQL 一主多从
            <!----></div></a> <span class="date">03-22</span></dt></dl> <dl><dd></dd> <dt><a href="/notebook/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="yubin_inbuy@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/yubincloud" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>yubincloud | <a href="https://github.com/yubincloud/notebook/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/notebook/assets/js/app.2bf3b6c1.js" defer></script><script src="/notebook/assets/js/2.0ad58009.js" defer></script><script src="/notebook/assets/js/339.92d07729.js" defer></script>
  </body>
</html>
